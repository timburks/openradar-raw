apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "6125120"
    labels:
        datastore_id: "4961390313865216"
data:
    classification: ""
    created: "2019-10-14T07:22:19.176963Z"
    description: "The Command Line Tools macOS 10.15 Beta SDK available via Mojave System Prefs :: Software Update (also Command_Line_Tools_for_Xcode_11_Beta.dmg from approx 3 June) does not work when compiling programs with GCC or other compilers for which __has_attribute(availability) is false. (See attached typescript.)\r\n\r\nThis is because the beta SDK's AvailabilityInternal.h has not #defined __AVAILABILITY_INTERNAL__MAC_10_10 etc in this configuration. In particular, it has no equivalent of the fallback macro definitions that are in the 10.14 AvailabilityInternal.h, as illustrated in the attached AvailabilityInternal.diff.\r\n\r\nWhen I tested GCC compiling hello.c using a thus-modified AvailabilityInternal.h, compilation was successful as expected.\r\n\r\n==== Attachment typescript\r\n\r\n$ cat hello.c\r\n#include <stdio.h>\r\n\r\nint main() {\r\n  printf(\"Hello, world!\\n\");\r\n  return 0;\r\n}\r\n\r\n$ gcc-9 -fdiagnostics-color=never -c hello.c\r\nIn file included from /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/_stdio.h:69,\r\n                 from /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/stdio.h:64,\r\n                 from hello.c:1:\r\n/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/sys/stdio.h: In function 'renameat':\r\n/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/sys/stdio.h:39:56: error: expected declaration specifiers before '__AVAILABILITY_INTERNAL__MAC_10_10'\r\n   39 | int     renameat(int, const char *, int, const char *) __OSX_AVAILABLE_STARTING(__MAC_10_10, __IPHONE_8_0);\r\n      |                                                        ^~~~~~~~~~~~~~~~~~~~~~~~\r\n\r\n[snip; complete compiler error log attached to original radar]\r\n\r\n==== Attachment AvailabilityInternal.diff\r\n\r\n--- AvailabilityInternal.h.orig\t2019-06-01 21:49:27.000000000 +0100\r\n+++ AvailabilityInternal.h\t2019-06-05 15:01:46.000000000 +0100\r\n@@ -4407,40 +4407,73 @@\r\n             #define __AVAILABILITY_INTERNAL__MAC_10_14                    __attribute__((availability(macosx,introduced=10.14)))\r\n             #define __AVAILABILITY_INTERNAL__MAC_10_14_DEP__MAC_10_14   __attribute__((availability(macosx,introduced=10.14,deprecated=10.14)))\r\n             #define __AVAILABILITY_INTERNAL__MAC_10_15                    __attribute__((availability(macosx,introduced=10.15)))\r\n \r\n             #define __AVAILABILITY_INTERNAL__MAC_NA                        __attribute__((availability(macosx,unavailable)))\r\n             #define __AVAILABILITY_INTERNAL__MAC_NA_DEP__MAC_NA            __attribute__((availability(macosx,unavailable)))\r\n             #define __AVAILABILITY_INTERNAL__MAC_NA_DEP__MAC_NA_MSG(_msg)  __attribute__((availability(macosx,unavailable)))\r\n \r\n             #define __AVAILABILITY_INTERNAL__IPHONE_NA                      __attribute__((availability(ios,unavailable)))\r\n             #define __AVAILABILITY_INTERNAL__IPHONE_NA__IPHONE_NA           __attribute__((availability(ios,unavailable)))\r\n             #define __AVAILABILITY_INTERNAL__IPHONE_NA_DEP__IPHONE_NA       __attribute__((availability(ios,unavailable)))\r\n             #define __AVAILABILITY_INTERNAL__IPHONE_NA_DEP__IPHONE_NA_MSG(_msg) __attribute__((availability(ios,unavailable)))\r\n \r\n             #ifndef __AVAILABILITY_INTERNAL__IPHONE_COMPAT_VERSION\r\n              #define __AVAILABILITY_INTERNAL__IPHONE_COMPAT_VERSION                                          __attribute__((availability(ios,unavailable)))\r\n              #define __AVAILABILITY_INTERNAL__IPHONE_COMPAT_VERSION_DEP__IPHONE_COMPAT_VERSION               __attribute__((availability(ios,unavailable)))\r\n              #define __AVAILABILITY_INTERNAL__IPHONE_COMPAT_VERSION_DEP__IPHONE_COMPAT_VERSION_MSG(_msg)     __attribute__((availability(ios,unavailable)))\r\n             #endif /* __AVAILABILITY_INTERNAL__IPHONE_COMPAT_VERSION */\r\n         #endif\r\n     #endif\r\n+\r\n+    #ifndef __AVAILABILITY_INTERNAL__MAC_10_0\r\n+        /* use old style attributes */\r\n+        #define __AVAILABILITY_INTERNAL__MAC_10_14_4        __AVAILABILITY_INTERNAL_REGULAR\r\n+        #define __AVAILABILITY_INTERNAL__MAC_10_14_1        __AVAILABILITY_INTERNAL_REGULAR\r\n+        #define __AVAILABILITY_INTERNAL__MAC_10_14        __AVAILABILITY_INTERNAL_REGULAR\r\n+        #define __AVAILABILITY_INTERNAL__MAC_10_13_4        __AVAILABILITY_INTERNAL_REGULAR\r\n+        #define __AVAILABILITY_INTERNAL__MAC_10_13_2        __AVAILABILITY_INTERNAL_REGULAR\r\n+        #define __AVAILABILITY_INTERNAL__MAC_10_13_1        __AVAILABILITY_INTERNAL_REGULAR\r\n+        #define __AVAILABILITY_INTERNAL__MAC_10_13        __AVAILABILITY_INTERNAL_REGULAR\r\n+        #define __AVAILABILITY_INTERNAL__MAC_10_12_4        __AVAILABILITY_INTERNAL_REGULAR\r\n+        #define __AVAILABILITY_INTERNAL__MAC_10_12_2        __AVAILABILITY_INTERNAL_REGULAR\r\n+        #define __AVAILABILITY_INTERNAL__MAC_10_12_1        __AVAILABILITY_INTERNAL_REGULAR\r\n+        #define __AVAILABILITY_INTERNAL__MAC_10_12        __AVAILABILITY_INTERNAL_REGULAR\r\n+        #define __AVAILABILITY_INTERNAL__MAC_10_11_4        __AVAILABILITY_INTERNAL_REGULAR\r\n+        #define __AVAILABILITY_INTERNAL__MAC_10_11_3        __AVAILABILITY_INTERNAL_REGULAR\r\n+        #define __AVAILABILITY_INTERNAL__MAC_10_11_2        __AVAILABILITY_INTERNAL_REGULAR\r\n+        #define __AVAILABILITY_INTERNAL__MAC_10_11        __AVAILABILITY_INTERNAL_REGULAR\r\n+        #define __AVAILABILITY_INTERNAL__MAC_10_10_3        __AVAILABILITY_INTERNAL_REGULAR\r\n+        #define __AVAILABILITY_INTERNAL__MAC_10_10_2        __AVAILABILITY_INTERNAL_REGULAR\r\n+        #define __AVAILABILITY_INTERNAL__MAC_10_10        __AVAILABILITY_INTERNAL_REGULAR\r\n+        #define __AVAILABILITY_INTERNAL__MAC_10_9        __AVAILABILITY_INTERNAL_REGULAR\r\n+        #define __AVAILABILITY_INTERNAL__MAC_10_8        __AVAILABILITY_INTERNAL_REGULAR\r\n+        #define __AVAILABILITY_INTERNAL__MAC_10_7        __AVAILABILITY_INTERNAL_REGULAR\r\n+        #define __AVAILABILITY_INTERNAL__MAC_10_6        __AVAILABILITY_INTERNAL_REGULAR\r\n+        #define __AVAILABILITY_INTERNAL__MAC_10_5        __AVAILABILITY_INTERNAL_REGULAR\r\n+        #define __AVAILABILITY_INTERNAL__MAC_10_4        __AVAILABILITY_INTERNAL_REGULAR\r\n+        #define __AVAILABILITY_INTERNAL__MAC_10_3        __AVAILABILITY_INTERNAL_REGULAR\r\n+        #define __AVAILABILITY_INTERNAL__MAC_10_2        __AVAILABILITY_INTERNAL_REGULAR\r\n+        #define __AVAILABILITY_INTERNAL__MAC_10_1        __AVAILABILITY_INTERNAL_REGULAR\r\n+        #define __AVAILABILITY_INTERNAL__MAC_10_0        __AVAILABILITY_INTERNAL_REGULAR\r\n+        /* etc etc */\r\n+    #endif\r\n #endif /* __ENABLE_LEGACY_MAC_AVAILABILITY */\r\n \r\n /*\r\n  Macros for defining which versions/platform a given symbol can be used.\r\n  \r\n  @see http://clang.llvm.org/docs/AttributeReference.html#availability\r\n  */\r\n \r\n #if defined(__has_feature) && defined(__has_attribute)\r\n  #if __has_attribute(availability)\r\n \r\n     \r\n     #define __API_AVAILABLE_PLATFORM_macos(x) macos,introduced=x\r\n     #define __API_AVAILABLE_PLATFORM_macosx(x) macosx,introduced=x\r\n     #define __API_AVAILABLE_PLATFORM_ios(x) ios,introduced=x\r\n     #define __API_AVAILABLE_PLATFORM_watchos(x) watchos,introduced=x\r\n     #define __API_AVAILABLE_PLATFORM_tvos(x) tvos,introduced=x\r\n     \r\n     #define __API_AVAILABLE_PLATFORM_uikitformac(x) uikitformac,introduced=x\r\n     #ifndef __API_AVAILABLE_PLATFORM_uikitformac"
    email: kiwi.john@gmail.com
    modified: "2019-10-14T07:22:19.177153Z"
    number: "6125120"
    number_intvalue: 6125120
    originated: "2019-06-06"
    parent_number: '&{NULL_VALUE}'
    product: macOS SDK
    product_version: 10.15 beta
    reproducible: ""
    resolved: ""
    status: ""
    title: macOS 10.15 Beta SDK does not work with GCC
