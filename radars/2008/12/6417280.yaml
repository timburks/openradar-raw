apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "6417280"
    labels:
        datastore_id: "322"
data:
    classification: Other Bug
    created: "2008-12-04T04:47:00.903622Z"
    description: "Summary: \r\nMy AirPort Express running the 7.3.2 firmware appears to clock its audio approximately 0.008% slow, which in turn would lead to approximately 300ms of desynchronization after one hour of use if not corrected.\r\n\r\nSteps to Reproduce:\r\nAttached to this bug is a zip file which contans an m4a file with a transmission test. This test file produces a pulse of sound exactly 10 times per second. When played with iTunes and then a microphone placed next to the speakers, a special test program (source not included, I can give it to you but it relies heavily on our internal audio libraries and as such probably wouldn't be very useful) measures the interval between each peak.\r\n\r\nI used iTunes to play through both my Mac's speakers and my AirPort Express simultaneously using the \"Multiple Speakers\" feature. I then measured both the Mac and the AirPort Express separately using the test program to determine the measured average interval between pulses.\r\n\r\nExpected Results:\r\nI expected the interval to average 100ms to within a very close margin of error on both devices.\r\n\r\nActual Results:\r\nThe average was 100ms on the Mac but closer to 100.008ms on the AirPort Express. While a very small deviation, this is roughly equal to one missing sample every quarter of a second, a playback sample rate of 44096Hz instead of the nominal 44100Hz, or over the long term roughly 300ms per hour drift.\r\n\r\nRegression:\r\nI have only tested this on my Mac Pro and on one AirPort Express. A customer of ours reported seeing it on his AirPort express as well, using a different test method involving a 1kHz square wave test tone and some audio monitoring equipment.\r\n\r\nNotes:\r\nAttached is both my test file and the output of four tests I ran. The long lists are intervals, in milliseconds, recorded during each test. It is not expected that every measured interval will equal exactly 100, as there will be random elements in the audio hardware. However it tracks surprisingly closely. On the Mac, it's usually exactly 100, and small deviations to one side tend to be rapidly corrected to the other side. One test found the long-term average interval to be very slightly over 100, and another test found it to be very slightly under 100, so overall it appears to track well.\r\n\r\nOn the AirPort Express side, the intervals are always equal to or greater than 100. Deviations are never corrected. The long-term running average differs from the expected value by a small but significant amount. I believe this may indicate a problem somewhere within the hardware or software of the device.\r\n\r\nThe test code consists of performing this analysis on incoming audio data:\r\n\r\n    unsigned i;\r\n    for( i = 0; i < frames; i++ )\r\n    {\r\n        if( data[i] >= mMinPeakThresholdSample )\r\n        {\r\n            double time = mTimeProcessed + i / buffer->fRate;\r\n            double delta = time - mLastPeakTime;\r\n            if( delta > 0.01 )\r\n            {\r\n                fprintf(stderr, \"%.3f,\", delta * 1000 );\r\n                mLastPeakTime = time;\r\n            }\r\n        }\r\n    }\r\n\t\r\n    mTimeProcessed += frames / buffer->fRate;\r\n\r\nWith of course a whole bunch of framing code to get buffers from the microphone and such. As I mentioned previously it uses our internal audio libraries extensively and so probably is not very useful in its entirety to people outside our company.\r\n\r\n\r\n01-May-2009 12:19 PM KIT CHEUNG :\r\nEngineering has determined that this issue behaves as intended based on the following information:\r\n\r\nYou need to use AirTunes 2 (which his product AirFoil supports) and have it synchronize to the iTunes machine that is playing.  Syncing to arbitrary iTunes computers that are not involved in the AirTunes session is not supported.\r\n\r\n\r\n01-May-2009 12:31 PM Michael Ash:\r\nI believe this engineer has misunderstood my bug report. The playback speed difference between the AirPort Express and iTunes is not between arbitrary machines it is *using* AirTunes 2 to play back on the AirPort Express and on my Mac simultaneously. That synchronization that you talk about is supposedly in effect, but does not prevent this discrepancy in playback speeds. Never am I measuring \"arbitrary iTunes computers that are not involved in the AirTunes session\". I am only measuring the iTunes computer that *is* involved in the AirTunes session."
    email: michael.ash@gmail.com
    modified: "2011-08-28T05:49:00.063991Z"
    number: "6417280"
    number_intvalue: 6417280
    originated: 03-Dec-2008 06:31 PM
    parent_number: '&{NULL_VALUE}'
    product: Hardware
    product_version: APX 7.3.2
    reproducible: Always
    resolved: ""
    status: Open
    title: AirPort Express 7.3.2 plays audio 0.008% slow
