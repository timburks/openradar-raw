apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "4450971"
    labels:
        datastore_id: "602"
data:
    classification: ""
    created: "2008-11-17T12:40:52.274933Z"
    description: "NB: I first submitted this in 4007861 on 15-Feb-2005. Even then, it was a known bug since it was marked as a duplicate. \r\n\r\n20-Feb-2006 06:03 AM Ian Eiloart:\r\n\r\nNote that this is a trivial bug, with a trivial fix, that has been present since the first versions of Apple Mail. There was an attempt to fix it in Leopard, but the attempt failed!\r\n\r\nSummary:\r\n\r\nApple Mail produces illegal headers when sending email to a group.\r\n\r\nSteps to reproduce:\r\n\r\nSend email to a group defined in Apple Address Book. \r\nExaming the To: header\r\nCompare result with the required format in RFC2821 (section A.1.3. Group addresses) or RFC821 (section 6.2.6)\r\n\r\nActual results:\r\nThe group name lacks the required trailing \":;\"\r\nFor example, the To: header might look like this:\r\n\r\nTo: Group Name\r\n\r\nExpected results:\r\nThe group name should include the required trailing \":;\", like this:\r\n\r\nTo: Group Name:;\r\n\r\nNote, if the group is to be expanded, the result could look like this:\r\n\r\nTo: Group Name:recpt@example.com, recpt@example.co.uk;\r\n\r\nRegression:\r\nUp to MacOSX 10.2, it was possible to name an address book group such that the header would become legal. Now in OSX 10.4, Mail warns that the (legal) address is illegal!\r\n\r\nNotes:\r\nWithout the trailing :; a mail server may interpret the group name as an unqualified email address (ie, only the local part), and attempt to expand it by adding a default domain. This will often result in an illegally formatted header - and many mail servers will reject the message on that ground. Where the expansion is legal, it will usually be incorrect - giving a misleading result.\r\n\r\nI'm the postmaster at the University of Sussex. We use OSX mail servers (with a third party smtp server application), and I'd love to be able to recommend using Apple Mail to our users, but while it contains this flaw, I can't.\r\n\r\n\r\n\r\n22-Feb-2006 02:56 AM Ian Eiloart:\r\nNo, I don't have it checked. Checking that box is a known work around, but isn't always acceptable as it reveals the recipient addresses, and hides the group name. \r\n\r\nUsing BCC is also a work-around, doesn't get the group name into a To: header. That means that recipients have no idea why they got the email.\r\n\r\nI note that there are several queries in the Apple support discussion groups, which seem to be generated by this bug.\r\n\r\n28-Jun-2006 01:19 AM Ian Eiloart:\r\nNo, I don't have \"When sending to a group, show all member addresses\" checked? If I did, the addresses would be expanded and exposed to all my recipients. The headers would be legal.\r\n\r\nThe report is about a serious failure to comply with RFC2822 part3.4:\r\n<http://rfc.net/rfc2822.html#s3.4.> see also this example\r\n   A.13: <http://rfc.net/rfc2822.html#sA.1.3.>\r\n\r\nI'm astonished to see yet another release of Mail that doesn't fix this problem.\r\n\r\n28-Jun-2006 02:36 PM Vanaja Pasumarthi:\r\nrdar://problem/4605301I have reported a bug 4450971, and can't tell whether it's marked as duplicated or closed. In fact, it's marked as both. In my list of \"My Originated Problems\", I see the bug marked as duplicated which makes me think it's on your to-do list. However, when I open the bug to see the details, it is reported as \"closed\" which makes me think you don't understand the problem. Please see the attached screen dumps.\r\n\r\nCertainly the bug should not be closed. It's a serious bug which results in failure to deliver email to many sites. It was reported first many years ago, and many Mail updates have failed to fix it.\r\n\r\n\r\n14-Dec-2006 07:38 AM Ian Eiloart:\r\nMail 3.0 (853) for OSX 10.5 Build 9a303 still has this problem, and still thinks \"Group Name:;\" is an illegal email address - it isn't!\r\n\r\n01-Nov-2007 09:15 AM Ian Eiloart:\r\nI'm pleased to see that an attempt to fix this bug has been made in Leopard. Less pleased to see that the fix actually makes things worse. Now, it's impossible to create a valid header, and the header no longer contains useful information.\r\n\r\nPreviously, the group name was inserted into the To: header, and the problem was that the name wasn't followed with \":;\".\r\n\r\nNow, the group name isn't used (which is a step backwards). Instead, this (illegal) string is used:\r\n\r\nUndisclosed-recipients: <>;\r\n\r\nClose, but still illegal. Nothing should appear between the colon and the semi-colon. What appears between the colon and semicolon should be an (optionally empty) address list. If the list isn't empty, it must contain email addresses.\r\n\r\nThere's a clear example in RFC2822 in section A1.3 (the CC line).\r\n    http://www.apps.ietf.org/rfc/rfc2822.html#sec-A.1.3\r\n\r\nA quick fix would be to use the string showed in the Cc: line in the example, exactly as quoted.\r\n\r\nA better fix would be to use the group name followed by \":;\", when the group name is legal in RFC2822. When the group name is not legal, it could be replaced with \"Undisclosed recipients\", or an approximation to the group name (replacing or encoding accented characters, colons, semicolons and other illegal characters). The code required is already in Mail, it's the code used to encode email addresses!\r\n\r\nHere's the error message generated by Exim mail server, when the \"verify = header_syntax\" option is set:\r\n\r\n2007-11-01 17:09:46 JQU7OA-0009LB-RA \r\n   H=lewes.staff.uscs.susx.ac.uk [139.184.134.43]:51122 \r\n   I=[139.184.14.82]:587 F=<iane@sussex.ac.uk> \r\n     rejected after DATA: missing or malformed local part: \r\n     failing address in \"To:\" header is: Undisclosed-recipients: <>;\r\n\r\n\r\n12-Feb-2008 03:27 AM Ian Eiloart:\r\nAmazingly, this bug - first reported three years ago - still isn't fixed in OSX 10.5.2, and was never listed as a known issue in the developer previews.\r\n\r\nCan you tell me the status of bugs 3053188 and 2456148, please?\r\n\r\nAnd, can you please make the three character code change to finally fix this, please!!!?\r\n\r\n29-May-2008 11:26 PM Ian Eiloart:\r\nCan you let me know the status of bug 3053188, please? \r\n\r\nCan you also let me know why this apparently trivial fix hasn't been made yet? Does Apple not care about Internet Standards?\r\n\r\nThe fault seems to remain present in Mail 3.3 in OSX 10.5.3\r\n\r\nI really want to recommend that Apple Mail be adopted as a supported email client at my Unversity (where I'm postmaster), but can't while it produces illegal email headers.\r\n\r\nWhen sending email to an address book group, RFC strict mail servers reject the message with, for example:\r\n\r\n rejected after DATA: missing or malformed local part: failing address in \"To:\" header is: Undisclosed-recipients: <>;\r\n\r\nThe To: header reads\r\n\r\nUndisclosed-recipients: <>;\r\n\r\nbut it should read\r\n\r\nUndisclosed-recipients:;"
    email: ian@eiloart.com
    modified: "2011-08-28T05:51:28.449504Z"
    number: "4450971"
    number_intvalue: 4450971
    originated: 15-Feb-2005
    parent_number: "3053188"
    product: Apple Mail
    product_version: All versions
    reproducible: yes - every time
    resolved: ""
    status: Duplicate/3053188
    title: Can't send mail to groups with Apple Mail
