apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "5887412"
    labels:
        datastore_id: "209"
data:
    classification: '&{NULL_VALUE}'
    created: "2008-11-16T08:14:39.912196Z"
    description: "<GMT24-Apr-2008 18:53:23GMT> Dan Sandler:\r\n\r\n* SUMMARY\r\nI am unable to successfully paste images into iChat windows. Have tried this on multiple 10.5 machines (one PPC, one Intel). Result is a 60 second freeze of the iChat UI, during which it does not spin, but neither does it respond to keystrokes or mouse clicks.\r\n\r\n[This happens when others send images to me as well by pasting; this does not occur when using \"Send File.\"  It's 100% reproducible when I paste images, however, so that's how I'm writing up the bug report.]\r\n\r\n* STEPS TO REPRODUCE\r\n1. Initiate a text chat to an AIM or Jabber user.\r\n2. Place an image on the Clipboard; cmd-ctl-shift-4 is good for this.\r\n3. Paste into input field.\r\n4. Press Enter.\r\n\r\n* RESULTS\r\nThe input field clears, but the image does not appear in the chat window. At this point, iChat freezes up; the spinning wheel cursor does NOT appear, but iChat does not respond to mouse clicks or keystrokes (except to move the windows around, of course). Menu items cannot be chosen; new text cannot be typed; text from the other side of the conversation does not appear.\r\n\r\nThis continues for about 60 seconds.\r\n\r\nAfter the timeout, all intervening input---keystrokes, locally, and chats from the other side of the conversation---occur in a single burst.  The conversation can now continue normally, with the exception that the image never showed up.\r\n\r\n* REGRESSION\r\nHave tried several different networking configurations: wired/wireless, using a SOCKS5 proxy to another host elsewhere on the Internet (that has no firewall), and so forth.  No change.\r\n\r\n* NOTES\r\nDuring the 60 second freeze, the state of iChat's threads is pretty stable.  Here are the stack traces:\r\n\r\n\t(gdb) thread apply all bt\r\n\r\n\tThread 8 (process 7531 thread 0x2a547):\r\n\t#0  0x90a459e6 in mach_msg_trap ()\r\n\t#1  0x90a4d1dc in mach_msg ()\r\n\t#2  0x9163d0de in CFRunLoopRunSpecific ()\r\n\t#3  0x9163dd18 in CFRunLoopRunInMode ()\r\n\t#4  0x9004d6cc in CFURLCacheWorkerThread ()\r\n\t#5  0x90a76c55 in _pthread_start ()\r\n\t#6  0x90a76b12 in thread_start ()\r\n\r\n\tThread 7 (process 7531 thread 0x6907):\r\n\t#0  0x90a459e6 in mach_msg_trap ()\r\n\t#1  0x90a4d1dc in mach_msg ()\r\n\t#2  0x9163d0de in CFRunLoopRunSpecific ()\r\n\t#3  0x9163dd18 in CFRunLoopRunInMode ()\r\n\t#4  0x957a4ac0 in +[NSURLConnection(NSURLConnectionReallyInternal) _resourceLoadLoop:] ()\r\n\t#5  0x957415ad in -[NSThread main] ()\r\n\t#6  0x95741154 in __NSThread__main__ ()\r\n\t#7  0x90a76c55 in _pthread_start ()\r\n\t#8  0x90a76b12 in thread_start ()\r\n\r\n\tThread 6 (process 7531 thread 0xae03):\r\n\t#0  0x90a4cbce in __semwait_signal ()\r\n\t#1  0x90a77ee6 in _pthread_cond_wait ()\r\n\t#2  0x90a778cd in pthread_cond_wait$UNIX2003 ()\r\n\t#3  0x9528a432 in glvmDoWork ()\r\n\t#4  0x90a76c55 in _pthread_start ()\r\n\t#5  0x90a76b12 in thread_start ()\r\n\r\n\tThread 5 (process 7531 thread 0x8e03):\r\n\t#0  0x90a4cbce in __semwait_signal ()\r\n\t#1  0x90a77ee6 in _pthread_cond_wait ()\r\n\t#2  0x90a778cd in pthread_cond_wait$UNIX2003 ()\r\n\t#3  0x0036af7d in CameraList_Thread ()\r\n\t#4  0x90a76c55 in _pthread_start ()\r\n\t#5  0x90a76b12 in thread_start ()\r\n\r\n\tThread 4 (process 7531 thread 0x8603):\r\n\t#0  0x00000000 in ?? ()\r\n\tCannot access memory at address 0x4\r\n\r\n\tThread 3 (process 7531 thread 0x75b7):\r\n\t#0  0x90aaf5c6 in __workq_ops ()\r\n\t#1  0x90ab0cbe in workqueue_exit ()\r\n\t#2  0x90aaf5f6 in start_wqthread ()\r\n\r\n\tThread 2 (process 7531 thread 0x2f0b):\r\n\t#0  0x90a459e6 in mach_msg_trap ()\r\n\t#1  0x90a4d1dc in mach_msg ()\r\n\t#2  0x9163d0de in CFRunLoopRunSpecific ()\r\n\t#3  0x9163dd18 in CFRunLoopRunInMode ()\r\n\t#4  0x93954dc7 in -[IMRemoteObjectBroadcaster _workerThread] ()\r\n\t#5  0x957415ad in -[NSThread main] ()\r\n\t#6  0x95741154 in __NSThread__main__ ()\r\n\t#7  0x90a76c55 in _pthread_start ()\r\n\t#8  0x90a76b12 in thread_start ()\r\n\r\n\tThread 1 (process 7531 thread 0x20b):\r\n\t#0  0x90a459e6 in mach_msg_trap ()\r\n\t#1  0x90a4d1dc in mach_msg ()\r\n\t#2  0x9163d0de in CFRunLoopRunSpecific ()\r\n\t#3  0x9163dd18 in CFRunLoopRunInMode ()\r\n\t#4  0x95b72cf1 in -[NSHTMLReader _loadUsingWebKit] ()\r\n\t#5  0x95b7241f in -[NSHTMLReader attributedString] ()\r\n\t#6  0x95b710db in _NSReadAttributedStringFromURLOrData ()\r\n\t#7  0x95b6e196 in -[NSAttributedString(NSAttributedStringKitAdditions) initWithData:options:documentAttributes:error:] ()\r\n\t#8  0x95b6e109 in -[NSAttributedString(NSAttributedStringKitAdditions) initWithHTML:options:documentAttributes:] ()\r\n\t#9  0x0086a12d in +[NSMutableAttributedString(FezExtensions) attributedStringWithHTML:defaultFont:documentAttributes:] ()\r\n\t#10 0x00869660 in +[AbstractRichTextGenerator parseHTML:resultingBGColor:resultingFontColor:defaultFont:] ()\r\n\t#11 0x0011af98 in ?? ()\r\n\t#12 0x00098eb6 in ?? ()\r\n\t#13 0x00098a21 in ?? ()\r\n\t#14 0x000988ed in ?? ()\r\n\t#15 0x0170dd10 in -[AbstractAccount(Chax) chax_handleChat:messageReceived:] ()\r\n\t#16 0x916bcb7d in __invoking___ ()\r\n\t#17 0x916bc568 in -[NSInvocation invoke] ()\r\n\t#18 0x916bc638 in -[NSInvocation invokeWithTarget:] ()\r\n\t#19 0x93955712 in -[IMLocalObject _handleInvocation:] ()\r\n\t#20 0x9577b5c3 in __NSFireMachPort ()\r\n\t#21 0x91619555 in __CFMachPortPerform ()\r\n\t#22 0x9163d921 in CFRunLoopRunSpecific ()\r\n\t#23 0x9163dd18 in CFRunLoopRunInMode ()\r\n\t#24 0x94e396a0 in RunCurrentEventLoopInMode ()\r\n\t#25 0x94e393f2 in ReceiveNextEventCommon ()\r\n\t#26 0x94e3932d in BlockUntilNextEventMatchingListInMode ()\r\n\t#27 0x959fe7d9 in _DPSNextEvent ()\r\n\t#28 0x959fe08e in -[NSApplication nextEventMatchingMask:untilDate:inMode:dequeue:] ()\r\n\t#29 0x959f70c5 in -[NSApplication run] ()\r\n\t#30 0x959c430a in NSApplicationMain ()\r\n\t#31 0x00002eb2 in ?? ()\r\n\r\nStepping through 3ms samples in Instruments I can see that the freeze is almost exactly 60 seconds, pointing to some sort of timeout. All the action seems to happen on the main thread; it sits in its run loop (as shown above) for the duration (except for periodic breaks to repaint its views).\r\n\r\nThe Instruments sample immediately *preceding* the frozen area shows the following trace on the main thread:\r\n\r\n\t 0 CoreFoundation CFStringGetCharacterAtIndex\r\n\t 1 CoreFoundation CFURLCreateStringWithFileSystemPath\r\n\t 2 CoreFoundation CFURLCreateStringWithFileSystemPath\r\n\t 3 CoreFoundation CFURLGetFileSystemRepresentation\r\n\t 4 CoreFoundation -[CFXPreferencesPropertyListSource(CFXPreferencesSPIAdditions) _backingPlistIsNewer]\r\n\t 5 CoreFoundation -[CFXPreferencesPropertyListSource synchronize]\r\n\t 6 CoreFoundation -[CFXPreferencesPropertyListSource getValueForKey:]\r\n\t 7 CoreFoundation -[CFXPreferencesSearchListSource getValueForKey:]\r\n\t 8 CoreFoundation CFPreferencesCopyAppValue\r\n\t 9 Foundation -[NSUserDefaults(NSUserDefaults) objectForKey:]\r\n\t10 WebKit -[WebPreferences _valueForKey:]\r\n\t11 WebKit -[WebPreferences _integerValueForKey:]\r\n\t12 WebKit -[WebPreferences _boolValueForKey:]\r\n\t13 WebKit -[WebPreferences(WebPrivate) _useSiteSpecificSpoofing]\r\n\t14 WebKit -[WebView(WebPrivate) _preferencesChangedNotification:]\r\n\t15 Foundation _nsnote_callback\r\n\t16 CoreFoundation __CFXNotificationPost\r\n\t17 CoreFoundation _CFXNotificationPostNotification\r\n\t18 Foundation -[NSNotificationCenter postNotificationName:object:userInfo:]\r\n\t19 WebKit -[WebPreferences(WebPrivate) _postPreferencesChangesNotification]\r\n\t20 WebKit -[WebView _commonInitializationWithFrameName:groupName:]\r\n\t21 WebKit -[WebView initWithFrame:frameName:groupName:]\r\n\t22 WebKit -[WebView initWithFrame:]\r\n\t23 AppKit -[NSHTMLReader _loadUsingWebKit]\r\n\t24 AppKit -[NSHTMLReader attributedString]\r\n\t25 AppKit _NSReadAttributedStringFromURLOrData\r\n\t26 AppKit -[NSAttributedString(NSAttributedStringKitAdditions) initWithData:options:documentAttributes:error:]\r\n\t27 AppKit -[NSAttributedString(NSAttributedStringKitAdditions) initWithHTML:options:documentAttributes:]\r\n\t28 iChatCommonGUI +[NSMutableAttributedString(FezExtensions) attributedStringWithHTML:defaultFont:documentAttributes:]\r\n\t29 iChatCommonGUI +[AbstractRichTextGenerator parseHTML:resultingBGColor:resultingFontColor:defaultFont:]\r\n\t30 iChat 0x11af98\r\n\t31 iChat 0x98eb6\r\n\t32 iChat 0x98a21\r\n\t33 iChat 0x988ed\r\n\t34 Chax_main -[AbstractAccount(Chax) chax_handleChat:messageReceived:]\r\n\t35 CoreFoundation __invoking___\r\n\t36 CoreFoundation -[NSInvocation invoke]\r\n\t37 CoreFoundation -[NSInvocation invokeWithTarget:]\r\n\t38 IMUtils -[IMLocalObject _handleInvocation:]\r\n\t39 Foundation __NSFireMachPort\r\n\t40 CoreFoundation __CFMachPortPerform\r\n\t41 CoreFoundation CFRunLoopRunSpecific\r\n\t42 CoreFoundation CFRunLoopRunInMode\r\n\t43 HIToolbox RunCurrentEventLoopInMode\r\n\t44 HIToolbox ReceiveNextEventCommon\r\n\t45 HIToolbox BlockUntilNextEventMatchingListInMode\r\n\t46 AppKit _DPSNextEvent\r\n\t47 AppKit -[NSApplication nextEventMatchingMask:untilDate:inMode:dequeue:]\r\n\t48 AppKit -[NSApplication run]\r\n\t49 AppKit NSApplicationMain\r\n\t50 iChat 0x2eb2\r\n\r\nThe Instruments sample *following* the frozen area (exactly 1 minute later) shows this main thread stack:\r\n\r\n\t 0 libSystem.B.dylib semaphore_signal_trap\r\n\t 1 CFNetwork _CFMultiplexerSourceSignal\r\n\t 2 CFNetwork CFNRunLoopMultiplexerSignal\r\n\t 3 CFNetwork _CFURLConnectionPushLoaderEvent\r\n\t 4 CFNetwork CFURLConnectionCancel\r\n\t 5 WebCore WebCore::ResourceHandle::cancel()\r\n\t 6 WebCore WebCore::ResourceLoader::didCancel(WebCore::ResourceError const&)\r\n\t 7 WebCore WebCore::SubresourceLoader::didCancel(WebCore::ResourceError const&)\r\n\t 8 WebCore WebCore::ResourceLoader::cancel(WebCore::ResourceError const&)\r\n\t 9 WebCore WebCore::ResourceLoader::cancel()\r\n\t10 WebCore WebCore::cancelAll(WTF::HashSet<WTF::RefPtr<WebCore::ResourceLoader>, WTF::PtrHash<WTF::RefPtr<WebCore::ResourceLoader> >, WTF::HashTraits<WTF::RefPtr<WebCore::ResourceLoader> > > const&)\r\n\t11 WebCore WebCore::DocumentLoader::stopLoading()\r\n\t12 WebCore WebCore::FrameLoader::stopAllLoaders()\r\n\t13 WebCore WebCore::FrameLoader::stopForUserCancel(bool)\r\n\t14 AppKit -[NSHTMLReader _loadUsingWebKit]\r\n\t15 AppKit -[NSHTMLReader attributedString]\r\n\t16 AppKit _NSReadAttributedStringFromURLOrData\r\n\t17 AppKit -[NSAttributedString(NSAttributedStringKitAdditions) initWithData:options:documentAttributes:error:]\r\n\t18 AppKit -[NSAttributedString(NSAttributedStringKitAdditions) initWithHTML:options:documentAttributes:]\r\n\t19 iChatCommonGUI +[NSMutableAttributedString(FezExtensions) attributedStringWithHTML:defaultFont:documentAttributes:]\r\n\t20 iChatCommonGUI +[AbstractRichTextGenerator parseHTML:resultingBGColor:resultingFontColor:defaultFont:]\r\n\t21 iChat 0x11af98\r\n\t22 iChat 0x98eb6\r\n\t23 iChat 0x98a21\r\n\t24 iChat 0x988ed\r\n\t25 Chax_main -[AbstractAccount(Chax) chax_handleChat:messageReceived:]\r\n\t26 CoreFoundation __invoking___\r\n\t27 CoreFoundation -[NSInvocation invoke]\r\n\t28 CoreFoundation -[NSInvocation invokeWithTarget:]\r\n\t29 IMUtils -[IMLocalObject _handleInvocation:]\r\n\t30 Foundation __NSFireMachPort\r\n\t31 CoreFoundation __CFMachPortPerform\r\n\t32 CoreFoundation CFRunLoopRunSpecific\r\n\t33 CoreFoundation CFRunLoopRunInMode\r\n\t34 HIToolbox RunCurrentEventLoopInMode\r\n\t35 HIToolbox ReceiveNextEventCommon\r\n\t36 HIToolbox BlockUntilNextEventMatchingListInMode\r\n\t37 AppKit _DPSNextEvent\r\n\t38 AppKit -[NSApplication nextEventMatchingMask:untilDate:inMode:dequeue:]\r\n\t39 AppKit -[NSApplication run]\r\n\t40 AppKit NSApplicationMain\r\n\t41 iChat 0x2eb2\r\n\r\nWithout the source to NSHTMLReader it's hard to tell, but it appears that after some timeout the NSHTMLReader is forcing WebCore to stop loading the necessary image---giving up, it seems.\r\n\r\n[As you can see in the stack traces, I am using the Chax add-on to iChat, but this problem manifests exactly the same way without Chax.]"
    email: dan.sandler@gmail.com
    modified: "2011-08-28T05:50:19.791882Z"
    number: "5887412"
    number_intvalue: 5887412
    originated: '&{NULL_VALUE}'
    parent_number: "5476021"
    product: '&{NULL_VALUE}'
    product_version: '&{NULL_VALUE}'
    reproducible: '&{NULL_VALUE}'
    resolved: '&{NULL_VALUE}'
    status: Duplicate/5476021
    title: Pasting images in iChat results in 60 second app freeze, failure to show image
