apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "29043092"
    labels:
        datastore_id: "4928890795458560"
data:
    classification: Serious
    created: "2016-11-01T13:07:17.49334Z"
    description: "Summary:\r\nSay you have a line of text in an NSTextView. You apply NSBackgroundColor of light red for a word within that text. Using RTFFromRange save it as NSData then load it back in. The attributes of the decoded RTF suddenly have a new white background color attribute added to words right after that highlighted word. Previous versions of OS X did not impose a background color and this messes up our rendering.\r\n\r\nSteps to Reproduce:\r\n1. On 10.12.1 download and launch Curio 10.3.2 (www.zengobi.com/downloads/Curio10.zip).\r\n2. Choose File > New Blank Project.\r\n3. Use the inspector to give the background a light gray coloring.\r\n4. Double-click in the idea space area to create a new text figure and type \"this is red and the rest isn't.\"\r\n5. Double-click the word red to select it.\r\n6. In the inspector bar give that word a light red background color.\r\n7. Click elsewhere in the idea space to stop editing and notice that all is rendered fine.\r\n8. Close the project and reopen it.\r\n9. Notice the text after the word \"red\" now has a white background color imposed on it.\r\n\r\nExpected Results:\r\nThe words following the highlighted word should not have a forced white background color. Indeed trying this same test in El Capitan or earlier OS X releases works just fine.\r\n\r\nActual Results:\r\nAny text after subtext colored with NSBackgroundColor is given a NSBackgroundColor of white (specifically NSBackgroundColor = \"NSCustomColorSpace Generic Gray Gamma 2.2 Profile colorspace 1 1\";)\r\n\r\nThis is a serious bug for our app because we have a lot of students that highlight words in their  text notes. Some of them have colored backgrounds and the forced-white ruins the look of their notes.\r\n\r\nDebug Notes:\r\nI also tried to force the RTF document to be transparent with documentAttributes of @{NSBackgroundColorDocumentAttribute : [NSColor clearColor]} but that didn't fix it.\r\n\r\nGiven this code snippet:\r\n\tNSData *data = [self.hiddenText RTFFromRange:NSMakeRange(0, [self.hiddenText length]) documentAttributes:nil];\r\n\tNSAttributedString *result = [[NSAttributedString alloc] initWithData:data options:@{} documentAttributes:nil error:nil];\r\n\r\nOn El Capitan (10.11.6) I see this:\r\n\r\n(lldb) po text\r\nthis is {\r\n    NSFont = \"\\\"GillSans-Italic 9.00 pt. P [] (0x115c70ed0) fobj=0x100f64800, spc=2.50\\\"\";\r\n    NSParagraphStyle = \"Alignment 0, LineSpacing 0, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0, LineBreakMode 0, Tabs (\\n    28L,\\n    56L,\\n    84L,\\n    112L,\\n    140L,\\n    168L,\\n    196L,\\n    224L,\\n    252L,\\n    280L,\\n    308L,\\n    336L\\n), DefaultTabInterval 0, Blocks (null), Lists (\\n), BaseWritingDirection -1, HyphenationFactor 0, TighteningForTruncation NO, HeaderLevel 0\";\r\n}red{\r\n    NSBackgroundColor = \"NSCalibratedRGBColorSpace 0.996078 0.643137 0.627451 1\";\r\n    NSFont = \"\\\"GillSans-Italic 9.00 pt. P [] (0x115c70ed0) fobj=0x100f64800, spc=2.50\\\"\";\r\n    NSParagraphStyle = \"Alignment 0, LineSpacing 0, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0, LineBreakMode 0, Tabs (\\n    28L,\\n    56L,\\n    84L,\\n    112L,\\n    140L,\\n    168L,\\n    196L,\\n    224L,\\n    252L,\\n    280L,\\n    308L,\\n    336L\\n), DefaultTabInterval 0, Blocks (null), Lists (\\n), BaseWritingDirection -1, HyphenationFactor 0, TighteningForTruncation NO, HeaderLevel 0\";\r\n} and the rest isn’t.{\r\n    NSFont = \"\\\"GillSans-Italic 9.00 pt. P [] (0x115c70ed0) fobj=0x100f64800, spc=2.50\\\"\";\r\n    NSParagraphStyle = \"Alignment 0, LineSpacing 0, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0, LineBreakMode 0, Tabs (\\n    28L,\\n    56L,\\n    84L,\\n    112L,\\n    140L,\\n    168L,\\n    196L,\\n    224L,\\n    252L,\\n    280L,\\n    308L,\\n    336L\\n), DefaultTabInterval 0, Blocks (null), Lists (\\n), BaseWritingDirection -1, HyphenationFactor 0, TighteningForTruncation NO, HeaderLevel 0\";\r\n}\r\n\r\n(lldb) po result\r\nthis is {\r\n    NSFont = \"\\\"GillSans-Italic 9.00 pt. P [] (0x10bf4c330) fobj=0x100f64800, spc=2.50\\\"\";\r\n    NSParagraphStyle = \"Alignment 0, LineSpacing 0, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0, LineBreakMode 0, Tabs (\\n    28L,\\n    56L,\\n    84L,\\n    112L,\\n    140L,\\n    168L,\\n    196L,\\n    224L,\\n    252L,\\n    280L,\\n    308L,\\n    336L\\n), DefaultTabInterval 0, Blocks (null), Lists (\\n), BaseWritingDirection -1, HyphenationFactor 0, TighteningForTruncation NO, HeaderLevel 0\";\r\n}red{\r\n    NSBackgroundColor = \"NSCalibratedRGBColorSpace 0.996078 0.643137 0.627451 1\";\r\n    NSFont = \"\\\"GillSans-Italic 9.00 pt. P [] (0x10bf4c330) fobj=0x100f64800, spc=2.50\\\"\";\r\n    NSParagraphStyle = \"Alignment 0, LineSpacing 0, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0, LineBreakMode 0, Tabs (\\n    28L,\\n    56L,\\n    84L,\\n    112L,\\n    140L,\\n    168L,\\n    196L,\\n    224L,\\n    252L,\\n    280L,\\n    308L,\\n    336L\\n), DefaultTabInterval 0, Blocks (null), Lists (\\n), BaseWritingDirection -1, HyphenationFactor 0, TighteningForTruncation NO, HeaderLevel 0\";\r\n} and the rest isn’t.{\r\n    NSFont = \"\\\"GillSans-Italic 9.00 pt. P [] (0x10bf4c330) fobj=0x100f64800, spc=2.50\\\"\";\r\n    NSParagraphStyle = \"Alignment 0, LineSpacing 0, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0, LineBreakMode 0, Tabs (\\n    28L,\\n    56L,\\n    84L,\\n    112L,\\n    140L,\\n    168L,\\n    196L,\\n    224L,\\n    252L,\\n    280L,\\n    308L,\\n    336L\\n), DefaultTabInterval 0, Blocks (null), Lists (\\n), BaseWritingDirection -1, HyphenationFactor 0, TighteningForTruncation NO, HeaderLevel 0\";\r\n}\r\n\r\nOn Sierra (10.12.1) I see this (notice the NSBackgroundColor added to \"and the rest isn’t\" in the results):\r\n\r\n(lldb) po text\r\nthis is {\r\n    NSColor = \"NSCustomColorSpace Generic RGB colorspace 0 0 0 1\";\r\n    NSFont = \"\\\"GillSans-Italic 9.00 pt. P [] (0x604002459b10) fobj=0x61200013fe40, spc=2.50\\\"\";\r\n    NSParagraphStyle = \"Alignment 0, LineSpacing 0, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0, LineBreakMode 0, Tabs (\\n    28L,\\n    56L,\\n    84L,\\n    112L,\\n    140L,\\n    168L,\\n    196L,\\n    224L,\\n    252L,\\n    280L,\\n    308L,\\n    336L\\n), DefaultTabInterval 0, Blocks (null), Lists (\\n), BaseWritingDirection -1, HyphenationFactor 0, TighteningForTruncation NO, HeaderLevel 0\";\r\n}red{\r\n    NSBackgroundColor = \"NSCalibratedRGBColorSpace 0.996078 0.643137 0.627451 1\";\r\n    NSColor = \"NSCustomColorSpace Generic RGB colorspace 0 0 0 1\";\r\n    NSFont = \"\\\"GillSans-Italic 9.00 pt. P [] (0x604002459b10) fobj=0x61200013fe40, spc=2.50\\\"\";\r\n    NSParagraphStyle = \"Alignment 0, LineSpacing 0, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0, LineBreakMode 0, Tabs (\\n    28L,\\n    56L,\\n    84L,\\n    112L,\\n    140L,\\n    168L,\\n    196L,\\n    224L,\\n    252L,\\n    280L,\\n    308L,\\n    336L\\n), DefaultTabInterval 0, Blocks (null), Lists (\\n), BaseWritingDirection -1, HyphenationFactor 0, TighteningForTruncation NO, HeaderLevel 0\";\r\n} and the rest isn’t{\r\n    NSColor = \"NSCustomColorSpace Generic RGB colorspace 0 0 0 1\";\r\n    NSFont = \"\\\"GillSans-Italic 9.00 pt. P [] (0x604002459b10) fobj=0x61200013fe40, spc=2.50\\\"\";\r\n    NSParagraphStyle = \"Alignment 0, LineSpacing 0, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0, LineBreakMode 0, Tabs (\\n    28L,\\n    56L,\\n    84L,\\n    112L,\\n    140L,\\n    168L,\\n    196L,\\n    224L,\\n    252L,\\n    280L,\\n    308L,\\n    336L\\n), DefaultTabInterval 0, Blocks (null), Lists (\\n), BaseWritingDirection -1, HyphenationFactor 0, TighteningForTruncation NO, HeaderLevel 0\";\r\n}\r\n\r\n(lldb) po result\r\nthis is {\r\n    NSColor = \"NSCustomColorSpace Generic RGB colorspace 0 0 0 1\";\r\n    NSFont = \"\\\"GillSans-Italic 9.00 pt. P [] (0x6040024b14d0) fobj=0x61200013fe40, spc=2.50\\\"\";\r\n    NSParagraphStyle = \"Alignment 0, LineSpacing 0, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0, LineBreakMode 0, Tabs (\\n    28L,\\n    56L,\\n    84L,\\n    112L,\\n    140L,\\n    168L,\\n    196L,\\n    224L,\\n    252L,\\n    280L,\\n    308L,\\n    336L\\n), DefaultTabInterval 0, Blocks (null), Lists (\\n), BaseWritingDirection -1, HyphenationFactor 0, TighteningForTruncation NO, HeaderLevel 0\";\r\n}red{\r\n    NSBackgroundColor = \"NSCustomColorSpace Generic RGB colorspace 0.99608 0.64314 0.62745 1\";\r\n    NSColor = \"NSCustomColorSpace Generic RGB colorspace 0 0 0 1\";\r\n    NSFont = \"\\\"GillSans-Italic 9.00 pt. P [] (0x6040024b14d0) fobj=0x61200013fe40, spc=2.50\\\"\";\r\n    NSParagraphStyle = \"Alignment 0, LineSpacing 0, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0, LineBreakMode 0, Tabs (\\n    28L,\\n    56L,\\n    84L,\\n    112L,\\n    140L,\\n    168L,\\n    196L,\\n    224L,\\n    252L,\\n    280L,\\n    308L,\\n    336L\\n), DefaultTabInterval 0, Blocks (null), Lists (\\n), BaseWritingDirection -1, HyphenationFactor 0, TighteningForTruncation NO, HeaderLevel 0\";\r\n} and the rest isn’t{\r\n    NSBackgroundColor = \"NSCustomColorSpace Generic Gray Gamma 2.2 Profile colorspace 1 1\";\r\n    NSColor = \"NSCustomColorSpace Generic RGB colorspace 0 0 0 1\";\r\n    NSFont = \"\\\"GillSans-Italic 9.00 pt. P [] (0x6040024b14d0) fobj=0x61200013fe40, spc=2.50\\\"\";\r\n    NSParagraphStyle = \"Alignment 0, LineSpacing 0, ParagraphSpacing 0, ParagraphSpacingBefore 0, HeadIndent 0, TailIndent 0, FirstLineHeadIndent 0, LineHeight 0/0, LineHeightMultiple 0, LineBreakMode 0, Tabs (\\n    28L,\\n    56L,\\n    84L,\\n    112L,\\n    140L,\\n    168L,\\n    196L,\\n    224L,\\n    252L,\\n    280L,\\n    308L,\\n    336L\\n), DefaultTabInterval 0, Blocks (null), Lists (\\n), BaseWritingDirection -1, HyphenationFactor 0, TighteningForTruncation NO, HeaderLevel 0\";\r\n}"
    email: george@zengobi.com
    modified: "2016-11-01T13:07:17.49366Z"
    number: "29043092"
    number_intvalue: 29043092
    originated: 01-Nov-2016
    parent_number: '&{NULL_VALUE}'
    product: macOS
    product_version: 10.12.1
    reproducible: Always
    resolved: ""
    status: Open
    title: A white NSBackgroundColor is forced when decoding RTF NSData
