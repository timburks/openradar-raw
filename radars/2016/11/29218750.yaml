apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "29218750"
    labels:
        datastore_id: "4960122187022336"
data:
    classification: bug
    created: "2016-11-11T15:13:06.168Z"
    description: "Boris Sotillos\r\n11-Nov-2016 04:05 PM\r\n\r\nSummary:\r\nApplication downloads ODR just fine if fresh installed. But ODR does not download if application is updated from its previous version.\r\nThe issue only happens when the update is done via TestFligh or the Store. With Xcode, the application downloads its resources just fine.\r\nAs long as you do not update the application, ODR works as expected.\r\n\r\nSteps to Reproduce:\r\n0) Uninstall our application from the device.\r\n1) Install previous version from store.\r\n2) Run it.\r\n   ODR is downloaded, while user gets to see a loading screen with a progress bar.\r\n3) Application works fine using the ODR resources.\r\n\r\n4) Install current version from store (or TestFlight).\r\n5) Run it.\r\n   In the loading screen there is no progress bar -there would be one if resources were being downloaded-.\r\n   Resources are not downloaded. Instead, they are instantly reported as available.\r\n6) Application tries to access the resources and fails because they are not there.\r\n   To the user, it looks like the application got stucked in the loading screen.\r\n\r\n7) If you let the application run. Resources are never downloaded.\r\n\r\n8) If you restart the application { GOTO step (5)}, will follow the same steps.\r\n\r\nExpected Results:\r\nWe would expect that, at step (5), the new ODR was downloaded.\r\nIt that was the case, we would get to see a loading screen w/ a progress bar, while downloading the new content. And on step (5), application would be able to access the content.\r\n\r\n\r\nActual Results:\r\nAt Step (5), the conditionallyBeginAccessingResources method invokes its completion handler, with resourcesAvailable = YES.\r\nThis is despite the fact that:\r\n- Assets from current version have different names that assets from previous version.\r\n- Tags from current version are different than tags from previous version.\r\n(Differences being forced in order to investigate the issue).\r\n\r\nFrom the device console, we see one significative log trace, appearing once per asset pack, with the following message:\r\nApple-TV XXXXXXX(CoreUI)[XXX] <Notice>: CoreUI: can't locate asset pack '<private>' for bundle '<private>' contents of asset pack will be ignored\r\n\r\nWe also know that resources are acknowledged as available from console logs added to investigate this issue.\r\n\r\nAlso, if fresh installed, the TestFlight version works fine.\r\n\r\n\r\nVersion:\r\ntvOS 10.0 (14T330) with wifi connection. model A1625 (32 GB)\r\n\r\nNotes:\r\nThis issue does not happen on tvOS 9.2 ( anything < 10.0, we presume): ODR downloads fine after update with the repro steps above in a tvOS 9.2.\r\n\r\nThis bug reminds us to the bug https://openradar.appspot.com/radar?id=4957459995164672 , \"Updating an application that uses ODR from Xcode or 'ad hoc' webserver renders ODR cached and non-updatable\", that we opened 10 months ago and has not received an answer.\r\n\r\nConfiguration:\r\ntvOS 10.0 (14T330). Xcode 8.0 -- cannot reproduce the issue on tvOS 9.2.\r\n\r\n=====================================================================================================================================\r\nBoris Sotillos 29-Nov-2016 10:00 AM\r\n\r\nI am attaching the files: - [filename redacted] : the device console output from the Xcode Devices window. - [filename redacted] : the sys diagnose report.\r\n\r\nI couldn't follow the link [redacted link] as instructions were meant for iOS devices. Instead, I followed [redacted link].\r\n\r\nRegarding profile installations, I installed the advised iOS profiles from [redacted link] , \"App Store/iTunes Store for iOS\" and \"sysdiagnose for iOS\". The only way I could install them was with the \"Apple Configurator 2\" tool.\r\n\r\nThe timings were: (match this against the repro steps) 17.20 install previous version (4.1.0) from store. 17.20 run it, allow time for initial ODR download. 17.22 install current TestFlight version (version displayed as \"4.2.0 (4.2.30)\"). 17.23 run it, allow time to download while we see the intro movie. 17.25 application crashes once intro movie finishes, as it tries to access the files that are not there.\r\n\r\nSorry that I couldn't get more accurate times.\r\n\r\nnote that: Our current TestFlight version has been modified in order to investigate this issue. In the current TF build, files are assumed to be downloaded when the ODR system tells us so, therefore it crashes after the intro movie. In the the original bug description, if files were not present, the application would retry. This is of litle importance, it's just to clarify the crash.\r\n\r\n=====================================================================================================================================\r\n\r\nApple Developer Relations 26-Nov-2016 02:45 PM\r\n\r\nEngineering has requested the following information in order to further investigate this issue:\r\n\r\nA sysdiagnose taken after reproducing the issue is definitely needed here. For store-specific issues, you can install the App Store/iTunes Store debug profile, reproduce the issue, and retrieve the additional log info with a sysdiagnose.\r\n\r\nsysdiagnose Instructions:\L[redacted link]\r\n\r\niOS App Store Logging Instructions: [redacted link]\r\n\r\niOS App Store Logging Profile: [redacted link]\r\n\r\nFor a complete list of logging instructions visit: [redacted link]"
    email: borissotillos@gmail.com
    modified: "2016-11-30T08:41:51.37391Z"
    number: "29218750"
    number_intvalue: 29218750
    originated: 11/11/2016
    parent_number: '&{NULL_VALUE}'
    product: tvos
    product_version: "10.0"
    reproducible: 100%
    resolved: no
    status: open
    title: Updating application renders ODR unusable
