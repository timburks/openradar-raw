apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "28525231"
    labels:
        datastore_id: "4941632084377600"
data:
    classification: Serious
    created: "2016-10-03T17:03:31.23961Z"
    description: "Summary:\r\nFollowing on from 28222511\r\n\r\nUltimately, I need to be able to create my own instance of NSTextStorage for use in an NSTextView created via interface builder.\r\n\r\nSteps to Reproduce:\r\nRun the attached project.\r\nType multiple lines of text.\r\nUse the arrow keys to move to the top of the document.\r\nType some more text.\r\n\r\nExpected Results:\r\nShould be able to type into the text view as normal\r\n\r\nActual Results:\r\nText in the text view is totally messed up! Please see the attached video for more details.\r\n\r\nAfter a while, the application will crash with the following stack trace.\r\n\r\nException Name: NSInternalInconsistencyException\r\nDescription: -[NSLayoutManager _fillGlyphHoleForCharacterRange:startGlyphIndex:desiredNumberOfCharacters:] *** attempted glyph generation while textStorage is editing.  It is not valid to cause the layoutManager to do glyph generation while the textStorage is editing (ie the textStorage has been sent a beginEditing message without a matching endEditing.)\r\nUser Info: (null)\r\n\r\n0   CoreFoundation                      0x00007fff9b3c052b __exceptionPreprocess + 171\r\n1   libobjc.A.dylib                     0x00007fffafa98cad objc_exception_throw + 48\r\n2   CoreFoundation                      0x00007fff9b43ea0d +[NSException raise:format:] + 205\r\n3   UIFoundation                        0x00007fffad9fa328 -[NSLayoutManager(NSPrivate) _fillGlyphHoleForCharacterRange:startGlyphIndex:desiredNumberOfCharacters:] + 492\r\n4   UIFoundation                        0x00007fffad9fcdbe _NSFastFillAllGlyphHolesForCharacterRange + 735\r\n5   UIFoundation                        0x00007fffad917359 -[NSLayoutManager glyphRangeForCharacterRange:actualCharacterRange:] + 64\r\n6   AppKit                              0x00007fff9916a54c -[NSTextView(NSPrivate) _scrollRangeToVisible:forceCenter:] + 1164\r\n7   UIFoundation                        0x00007fffada018be -[NSLayoutManager(NSPrivate) _resizeTextViewForTextContainer:] + 7247\r\n8   UIFoundation                        0x00007fffad9ffb30 -[NSLayoutManager(NSPrivate) _recalculateUsageForTextContainerAtIndex:] + 2757\r\n9   UIFoundation                        0x00007fffad90faed _enableTextViewResizing + 231\r\n10  UIFoundation                        0x00007fffad913b3c -[NSLayoutManager textStorage:edited:range:changeInLength:invalidatedRange:] + 569\r\n11  UIFoundation                        0x00007fffad913b90 -[NSLayoutManager processEditingForTextStorage:edited:range:changeInLength:invalidatedRange:] + 47\r\n12  UIFoundation                        0x00007fffad964585 -[NSTextStorage _notifyEdited:range:changeInLength:invalidatedRange:] + 178\r\n13  UIFoundation                        0x00007fffad964037 -[NSTextStorage processEditing] + 373\r\n14  UIFoundation                        0x00007fffad963c4d -[NSTextStorage endEditing] + 111\r\n15  AppKit                              0x00007fff991660b4 -[NSTextView insertText:replacementRange:] + 2996\r\n16  AppKit                              0x00007fff99165080 -[NSTextInputContext(NSInputContext_WithCompletion) insertText:replacementRange:completionHandler:] + 79\r\n17  AppKit                              0x00007fff998ff75b __55-[NSTextInputContext handleTSMEvent:completionHandler:]_block_invoke_2.225 + 108\r\n18  AppKit                              0x00007fff99165029 -[NSTextInputContext do_HandleTSMEvent_insertFixLenTextLoop:whileCondition:dispatchWorkEach:afterEachInsertText:continuation:] + 111\r\n19  AppKit                              0x00007fff998fd601 -[NSTextInputContext tryHandleTSMEvent_insertFixLenText_withContext:dispatchCondition:setupForDispatch:nestedWorkaroundCondition:nestedWorkaroundDispatchWork:loopCondition:dispatchWorkEach:afterEachInsertText:continuation:] + 387\r\n20  AppKit                              0x00007fff998ff32f __55-[NSTextInputContext handleTSMEvent:completionHandler:]_block_invoke.157 + 4105\r\n21  AppKit                              0x00007fff99164ca9 __55-[NSTextInputContext handleTSMEvent:completionHandler:]_block_invoke_2 + 80\r\n22  AppKit                              0x00007fff99164c29 -[NSTextInputContext tryHandleTSMEvent_HasMarkedText_withDispatchCondition:dispatchWork:continuation:] + 93\r\n23  AppKit                              0x00007fff99164618 -[NSTextInputContext handleTSMEvent:completionHandler:] + 2221\r\n24  AppKit                              0x00007fff99163cfd _NSTSMEventHandler + 319\r\n25  HIToolbox                           0x00007fff9a8b00d5 _ZL23DispatchEventToHandlersP14EventTargetRecP14OpaqueEventRefP14HandlerCallRec + 1708\r\n26  HIToolbox                           0x00007fff9a8af346 _ZL30SendEventToEventTargetInternalP14OpaqueEventRefP20OpaqueEventTargetRefP14HandlerCallRec + 428\r\n27  HIToolbox                           0x00007fff9a8af18f SendEventToEventTargetWithOptions + 43\r\n28  HIToolbox                           0x00007fff9a905f86 SendTSMEvent_WithCompletionHandler + 408\r\n29  HIToolbox                           0x00007fff9a906460 __SendUnicodeTextAEToUnicodeDoc_WithCompletionHandler_block_invoke + 400\r\n30  HIToolbox                           0x00007fff9a9062c1 __SendFilterTextEvent_WithCompletionHandler_block_invoke + 215\r\n31  HIToolbox                           0x00007fff9a905fd7 SendTSMEvent_WithCompletionHandler + 489\r\n32  HIToolbox                           0x00007fff9a905dc1 SendFilterTextEvent_WithCompletionHandler + 236\r\n33  HIToolbox                           0x00007fff9a905a82 SendUnicodeTextAEToUnicodeDoc_WithCompletionHandler + 284\r\n34  HIToolbox                           0x00007fff9a905838 __utDeliverTSMEvent_WithCompletionHandler_block_invoke_2 + 296\r\n35  HIToolbox                           0x00007fff9a9056de __utDeliverTSMEvent_WithCompletionHandler_block_invoke + 439\r\n36  HIToolbox                           0x00007fff9a9054a4 TSMKeyEvent_WithCompletionHandler + 632\r\n37  HIToolbox                           0x00007fff9a9051f3 __TSMProcessRawKeyEventWithOptionsAndCompletionHandler_block_invoke_4 + 251\r\n38  HIToolbox                           0x00007fff9a905020 __TSMProcessRawKeyEventWithOptionsAndCompletionHandler_block_invoke_3 + 281\r\n39  HIToolbox                           0x00007fff9a904d36 __TSMProcessRawKeyEventWithOptionsAndCompletionHandler_block_invoke_2 + 308\r\n40  HIToolbox                           0x00007fff9a904a6d __TSMProcessRawKeyEventWithOptionsAndCompletionHandler_block_invoke + 300\r\n41  HIToolbox                           0x00007fff9a903fdd TSMProcessRawKeyEventWithOptionsAndCompletionHandler + 3604\r\n42  AppKit                              0x00007fff99904f16 __61-[NSTextInputContext _handleEvent:options:completionHandler:]_block_invoke.885 + 116\r\n43  AppKit                              0x00007fff999049c5 __204-[NSTextInputContext tryTSMProcessRawKeyEvent_orSubstitution:dispatchCondition:setupForDispatch:furtherCondition:doubleSpaceSubstitutionCondition:doubleSpaceSubstitutionWork:dispatchTSMWork:continuation:]_block_invoke.817 + 121\r\n44  AppKit                              0x00007fff9990482f -[NSTextInputContext tryTSMProcessRawKeyEvent_orSubstitution:dispatchCondition:setupForDispatch:furtherCondition:doubleSpaceSubstitutionCondition:doubleSpaceSubstitutionWork:dispatchTSMWork:continuation:] + 285\r\n45  AppKit                              0x00007fff991625fb -[NSTextInputContext _handleEvent:options:completionHandler:] + 1298\r\n46  AppKit                              0x00007fff991620ae -[NSTextInputContext handleEvent:] + 109\r\n47  AppKit                              0x00007fff99161fb2 -[NSView interpretKeyEvents:] + 232\r\n48  AppKit                              0x00007fff99161dc9 -[NSTextView keyDown:] + 704\r\n49  AppKit                              0x00007fff9983d7ec -[NSWindow(NSEventRouting) _reallySendEvent:isDelayedEvent:] + 4086\r\n50  AppKit                              0x00007fff9983c42a -[NSWindow(NSEventRouting) sendEvent:] + 541\r\n51  AppKit                              0x00007fff996dda1c -[NSApplication(NSEvent) sendEvent:] + 4768\r\n52  AppKit                              0x00007fff98fc3009 -[NSApplication run] + 1002\r\n53  AppKit                              0x00007fff98f8da8a NSApplicationMain + 1237\r\n54  TextViewContainer                   0x0000000100001ea2 main + 34\r\n55  libdyld.dylib                       0x00007fffb0376255 start + 1\r\n\r\nVersion:\r\nmacOS 10.12 (16A323)\r\nXcode 8.0 (8A218a)\r\n\r\nAttachments:\r\n'TextViewContainer.zip' and 'NSTextView Crash.mov' were successfully uploaded."
    email: tom@71squared.com
    modified: "2016-10-03T17:03:31.24Z"
    number: "28525231"
    number_intvalue: 28525231
    originated: ""
    parent_number: '&{NULL_VALUE}'
    product: macOS SDK
    product_version: macOS 10.12 (16A323)
    reproducible: Always
    resolved: ""
    status: Open
    title: NSTextView is unusable
