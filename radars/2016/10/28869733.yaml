apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "28869733"
    labels:
        datastore_id: "4963103296978944"
data:
    classification: ""
    created: "2016-10-20T15:36:15.57148Z"
    description: "Summary:\r\nWhen running selenium testing with selenium 3.01 and safari 10 using web driver from Safari 10, if session creation failed, for example \"Allow Remote Automation\" is not enabled, the TCP connections created by the web driver are not closed.\r\n\r\nSteps to Reproduce:\r\n1. Set up selenium node using selenium-standalone 3.0.1 on OS X Sierra 10.12\r\n2. With Safari 10 \"Allow Remote Automation\" unchecked, try to run an automated test from a remote Node.js server by using selenium javascript client binding 3.0.0.beta\r\n3. After getting \"WARN - Exception: Could not create a session: You must enable the 'Allow Remote Automation' option in Safari's Develop menu to control Safari via WebDriver. (WARNING: The server did not provide any stacktrace information)\r\nCommand duration or timeout: 0 milliseconds\", enable \"Allow Remote Automation\" and restart Safari 10\r\n4. Try running the same test again\r\n\r\nExpected Results:\r\nThe Safari browser should be launched to execute the test.\r\n\r\nActual Results:\r\n- Got an message on the Terminal console where the selenium node was started \"Unable to start the server: another safaridriver is already running (@ localhost:27887).\".  This message is not showing up in the selenium node log.\r\n\r\n- The selenium log shows exception: \r\nCaused by: org.openqa.selenium.WebDriverException: The driver server has unexpectedly died!\r\nBuild info: version: '3.0.1', revision: '1969d75', time: '2016-10-18 09:48:19 -0700'\r\nSystem info: host: 'I.local', ip: '192.168.1.176', os.name: 'Mac OS X', os.arch: 'x86_64', os.version: '10.12', java.version: '1.8.0_60'\r\nDriver info: driver.version: SafariDriver\r\n\tat org.openqa.selenium.remote.service.DriverCommandExecutor.execute(DriverCommandExecutor.java:88)\r\n\tat org.openqa.selenium.remote.RemoteWebDriver.execute(RemoteWebDriver.java:601)\r\n\tat org.openqa.selenium.remote.RemoteWebDriver.startSession(RemoteWebDriver.java:241)\r\n\tat org.openqa.selenium.remote.RemoteWebDriver.<init>(RemoteWebDriver.java:128)\r\n\tat org.openqa.selenium.safari.SafariDriver.<init>(SafariDriver.java:62)\r\n\tat org.openqa.selenium.safari.SafariDriver.<init>(SafariDriver.java:53)\r\n\t... 14 more\r\nCaused by: org.apache.http.conn.HttpHostConnectException: Connect to localhost:9169 [localhost/127.0.0.1, localhost/0:0:0:0:0:0:0:1] failed: Connection refused\r\n\tat org.apache.http.impl.conn.DefaultHttpClientConnectionOperator.connect(DefaultHttpClientConnectionOperator.java:158)\r\n\tat org.apache.http.impl.conn.PoolingHttpClientConnectionManager.connect(PoolingHttpClientConnectionManager.java:353)\r\n\tat org.apache.http.impl.execchain.MainClientExec.establishRoute(MainClientExec.java:380)\r\n\tat org.apache.http.impl.execchain.MainClientExec.execute(MainClientExec.java:236)\r\n\tat org.apache.http.impl.execchain.ProtocolExec.execute(ProtocolExec.java:184)\r\n\tat org.apache.http.impl.execchain.RetryExec.execute(RetryExec.java:88)\r\n\tat org.apache.http.impl.execchain.RedirectExec.execute(RedirectExec.java:110)\r\n\tat org.apache.http.impl.client.InternalHttpClient.doExecute(InternalHttpClient.java:184)\r\n\tat org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:71)\r\n\tat org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:55)\r\n\tat org.openqa.selenium.remote.internal.ApacheHttpClient.fallBackExecute(ApacheHttpClient.java:142)\r\n\tat org.openqa.selenium.remote.internal.ApacheHttpClient.execute(ApacheHttpClient.java:88)\r\n\tat org.openqa.selenium.remote.ProtocolHandshake.createSession(ProtocolHandshake.java:108)\r\n\tat org.openqa.selenium.remote.ProtocolHandshake.createSession(ProtocolHandshake.java:64)\r\n\tat org.openqa.selenium.remote.HttpCommandExecutor.execute(HttpCommandExecutor.java:141)\r\n\tat org.openqa.selenium.remote.service.DriverCommandExecutor.execute(DriverCommandExecutor.java:82)\r\n\t... 19 more\r\nCaused by: java.net.ConnectException: Connection refused\r\n\tat java.net.PlainSocketImpl.socketConnect(Native Method)\r\n\tat java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:350)\r\n\tat java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206)\r\n\tat java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188)\r\n\tat java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)\r\n\tat java.net.Socket.connect(Socket.java:589)\r\n\tat org.apache.http.conn.socket.PlainConnectionSocketFactory.connectSocket(PlainConnectionSocketFactory.java:74)\r\n\tat org.apache.http.impl.conn.DefaultHttpClientConnectionOperator.connect(DefaultHttpClientConnectionOperator.java:141)\r\n\t... 34 more\r\n10:39:56.262 WARN - Exception: Connection refused\r\n\r\n\r\n\r\n\r\nVersion:\r\nOSX Sierre 10.12, Safari 10.0\r\n\r\nNotes:\r\n- Issue \"lsof -i tcp:27887\"\r\nwebdriver 13814   6u  IPv4 0x988f27712c7b8857      0t0  TCP localhost:27887 (LISTEN)\r\nwebdriver 13814   7u  IPv6 0x988f27712e05fd07      0t0  TCP localhost:27887 (LISTEN)\r\n\r\nKill the process creating the connection and run the test again, then the test will run and pass.\r\n\r\nConfiguration:\r\n\r\n\r\nAttachments:\r\n'selenium-node.log' was successfully uploaded."
    email: mzhang444@gmail.com
    modified: "2016-10-20T15:36:15.5717Z"
    number: "28869733"
    number_intvalue: 28869733
    originated: 20-Oct-2016
    parent_number: '&{NULL_VALUE}'
    product: Safari
    product_version: "10.0"
    reproducible: Always
    resolved: ""
    status: Open
    title: TCP connections created by Safari 10 web driver not closed when session creation failed
