apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: FB7633839
    labels:
        datastore_id: "4991447870734336"
data:
    classification: Bug
    created: "2020-04-05T15:49:11.040567Z"
    description: "Some applications still use libresolv for custom DNS queries. \r\n\r\nThe macOS version of libresolv still retrieves the DNS configuration from /etc/resolv.conf, which actually is a symlink to /var/run/resolv.conf and is auto generated by configd (IPMonitor plugin, ip_plugin.c) every time the key  State:/Network/Global/DNS changes in the dynamic store.\r\n\r\nFor global DNS settings, it all works as expected but as soon as split-DNS is used (\"SupplementalMatchDomains\"), this setup breaks.\r\n\r\nThe reason for that is that libresolv has support for split-DNS by looking at resolver files that are found at /etc/resolver and named after search domains, yet configd is not creating any such files.\r\n\r\nTwo very easy solutions to that problem would be possible:\r\n\r\n1) The IP Plugin also checks for split-DNS and writes resolver files to /etc/resolver (or to /var/run/resolver to that /etc/resolver could be a symlink). This would make split-DNS on macOS compatible to pretty much all existing UNIX DNS code that also supports this feature.\r\n\r\n2) The macOS version of libresolv stops using /etc/resolver and /etc/resolv.conf altogether and pulls the DNS configuration directly from the dynamic store. This is probably the better solution in the long run.\r\n\r\nThis issue affects all versions of macOS since support for \"SupplementalMatchDomains\" was added (I think 10.6) and it exists up to 10.15"
    email: m.hanauska@gmail.com
    modified: "2020-04-05T15:49:11.040744Z"
    number: FB7633839
    number_intvalue: 7633839
    originated: Mar 20, 2020
    parent_number: '&{NULL_VALUE}'
    product: macOS
    product_version: any
    reproducible: Always
    resolved: ""
    status: Open
    title: ibresolv on macOS has no split-DNS support
