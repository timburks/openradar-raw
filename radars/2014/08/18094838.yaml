apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "18094838"
    labels:
        datastore_id: "5833548464390144"
data:
    classification: ""
    created: "2014-08-21T22:23:45.12132Z"
    description: "Summary:\r\nIn iOS7, the hash implementation for UIMutableIndexPath and NSIndexPath appear to have changed. If you have a mutable and non-mutable index path with the same value, they return true for isEqual: but have differing hash values. In iOS6 the hash values would be equal.\r\n\r\nThe UITableViewDelegate method - (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath provides a UIMutableIndexPath. If, for example, the program keeps an NSSet of NSIndexPaths and checks the membership of the supplied indexPath, there will be false negatives due to the hash difference.\r\n\r\nSteps to Reproduce:\r\nRun the attached Xcode project, or:\r\n\r\nImplement the UITableViewDelegate method\r\n - (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath\r\n\r\nwith the following code (or similar):\r\n- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath\r\n{\r\n    CGFloat retVal = 50.0f;\r\n\r\n    NSIndexPath *copiedIndexPath = [NSIndexPath indexPathForRow:indexPath.row inSection:indexPath.section];\r\n\r\n    NSLog(@\"=============== heightForRowAtIndexPath: =============== \");\r\n    NSLog(@\"copiedIndexPath: '%@' indexPath: '%@'\", copiedIndexPath, indexPath);\r\n    NSLog(@\"[copiedIndexPath class]: '%@' [indexPath class]: '%@'\", [copiedIndexPath class], [indexPath class]);\r\n    NSLog(@\"isEqual: %@\", [indexPath isEqual:copiedIndexPath] ? @\"YES\" : @\"NO\");\r\n    NSLog(@\"[copiedIndexPath hash]: '%u' [indexPath hash]: '%u'\", [copiedIndexPath hash], [indexPath hash]);\r\n\r\n    if ([indexPath isEqual:copiedIndexPath] && indexPath.hash != copiedIndexPath.hash)\r\n    {\r\n        NSLog(@\"ERROR: If isEqual: evaluates to YES then both object's hash values should also be equal.\");\r\n    }\r\n    \r\n    return retVal;\r\n}\r\n\r\n\r\nExpected Results:\r\nThe if statement would never evaluate to true and no \"ERROR\" log statement would be output.\r\n\r\nActual Results:\r\nFor all indexPath's greater than [0,0] the if evaluates to true and an error was output:\r\n\r\n2014-08-21 16:06:09.369 IndexPathBug[69261:60b] =============== heightForRowAtIndexPath: =============== \r\n2014-08-21 16:06:09.370 IndexPathBug[69261:60b] copiedIndexPath: '<NSIndexPath: 0x8c7c160> {length = 2, path = 0 - 0}' indexPath: '<UIMutableIndexPath 0x8c7c050> 2 indexes [0, 0]'\r\n2014-08-21 16:06:09.370 IndexPathBug[69261:60b] [copiedIndexPath class]: 'NSIndexPath' [indexPath class]: 'UIMutableIndexPath'\r\n2014-08-21 16:06:09.370 IndexPathBug[69261:60b] isEqual: YES\r\n2014-08-21 16:06:09.371 IndexPathBug[69261:60b] [copiedIndexPath hash]: '22' [indexPath hash]: '22'\r\n2014-08-21 16:06:09.371 IndexPathBug[69261:60b] =============== heightForRowAtIndexPath: =============== \r\n2014-08-21 16:06:09.371 IndexPathBug[69261:60b] copiedIndexPath: '<NSIndexPath: 0xa5b08a0> {length = 2, path = 0 - 1}' indexPath: '<UIMutableIndexPath 0xa56abc0> 2 indexes [0, 1]'\r\n2014-08-21 16:06:09.371 IndexPathBug[69261:60b] [copiedIndexPath class]: 'NSIndexPath' [indexPath class]: 'UIMutableIndexPath'\r\n2014-08-21 16:06:09.372 IndexPathBug[69261:60b] isEqual: YES\r\n2014-08-21 16:06:09.372 IndexPathBug[69261:60b] [copiedIndexPath hash]: '16406' [indexPath hash]: '22'\r\n2014-08-21 16:06:09.372 IndexPathBug[69261:60b] ERROR: If isEqual: evaluates to YES then both object's hash values should also be equal.\r\n2014-08-21 16:06:09.373 IndexPathBug[69261:60b] =============== heightForRowAtIndexPath: =============== \r\n2014-08-21 16:06:09.373 IndexPathBug[69261:60b] copiedIndexPath: '<NSIndexPath: 0xa577d60> {length = 2, path = 0 - 2}' indexPath: '<UIMutableIndexPath 0xa56d2d0> 2 indexes [0, 2]'\r\n2014-08-21 16:06:09.373 IndexPathBug[69261:60b] [copiedIndexPath class]: 'NSIndexPath' [indexPath class]: 'UIMutableIndexPath'\r\n2014-08-21 16:06:09.373 IndexPathBug[69261:60b] isEqual: YES\r\n2014-08-21 16:06:09.373 IndexPathBug[69261:60b] [copiedIndexPath hash]: '32790' [indexPath hash]: '16406'\r\n2014-08-21 16:06:09.374 IndexPathBug[69261:60b] ERROR: If isEqual: evaluates to YES then both object's hash values should also be equal.\r\n\r\netc.\r\n\r\nInterestingly, the hashes for the mutable and non-mutable seem to be \"off by one\" (if you compare the various row values you will note that the previous row value will have the same hash...)\r\n\r\nFor instance:\r\n\r\n[0, 4]\r\nUIMutableIndexPath hash: '98326'\r\nNSIndexPath hash: '131094'\r\n[0, 5]\r\nUIMutableIndexPath hash: '131094'\r\nNSIndexPath hash: '163862'\r\n\r\nNote, the [0, 4] NSIndexPath hash is the same as the [0, 5] UIMutableIndexPath hash (both are 131094).\r\n\r\nVersion:\r\niOS SDK 7.1\r\n\r\nNotes:\r\n\r\n\r\nConfiguration:\r\nAll iOS 7 simulators.\r\n\r\nAttachments:\r\n'IndexPathBug.zip' was successfully uploaded.\r\n\r\nDupe of 15806671"
    email: levigroker@gmail.com
    modified: "2014-08-21T22:23:45.121468Z"
    number: "18094838"
    number_intvalue: 18094838
    originated: 21-Aug-2014 04:21 PM
    parent_number: '&{NULL_VALUE}'
    product: iOS SDK
    product_version: "7.1"
    reproducible: Always
    resolved: ""
    status: Open
    title: 'UIMutableIndexPath and NSIndexPath return true for isEqual: but have different hash values'
