apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "17985943"
    labels:
        datastore_id: "5885738759487488"
data:
    classification: Security
    created: "2014-08-12T02:23:17.873848Z"
    description: "Summary:\r\n\r\nThe diskutil tool found in the 10.9.4 Recovery HD partition appears to have a bug that prevents the CoreStorage volume from being properly removed when the following command is run on an unlocked FileVault 2-encrypted drive:\r\n\r\ndiskutil corestorage revert UUID_here\r\n\r\n\r\nSteps to Reproduce:\r\n\r\n1. Booting from a Mavericks Recovery HD partition (all testing done with a 10.9.4 Recovery HD partition.)\r\n\r\n2. Unlocking the encrypted drive (either using Disk Utility or diskutil corestorage -revert\r\n\r\n2. Decrypting either of the the following methods:\r\n\r\nUsing Disk Utility to decrypt the FileVault 2-encrypted boot drive. General method described here - http://derflounder.wordpress.com/2011/11/23/using-disk-utility-to-unlock-or-decrypt-your-filevault-2-encrypted-boot-drive/\r\n\r\nRunning \"diskutil corestorage -revert\" from the Terminal. General method described here - http://derflounder.wordpress.com/2014/04/27/unlocking-or-decrypting-a-filevault-2-encrypted-fusion-drive-from-the-command-line/\r\n\r\n3. Letting the drive get to \"Conversion Progress: 100%\" while booted from the Recovery HD partition. \"Conversion Progress\" status was displayed via \"diskutil corestorage list\"\r\n\r\n4. Rebooting back to the main boot drive once \"Conversion Progress:\" has reached 100%.\r\n\r\n\r\nThe end result is a locked CoreStorage volume that will not allow the boot drive to boot normally. The drive will also not unlock or mount when accessed from a Recovery HD partition. \r\n\r\nExpected Results:\r\n\r\nWhen \"Conversion Progress:\" in \"diskutil corestorage list\" had reached 100%, the expected outcome was that the CoreStorage volume would be removed and the drive be converted back to a normal HFS+ drive.\r\n\r\n\r\nActual Results:\r\n\r\nWhen \"Conversion Progress:\" in \"diskutil corestorage list\" had reached 100%, the CoreStorage volume was not removed. On booting from the Recovery HD partition to the now-decrypted drive, the Mac booted to a prohibited sign. This symbol at boot means the system has found a bootable installation of Mac OS X on the system, but there is something wrong with it.\r\n\r\nRegression:\r\n\r\nIn my testing of this problem, I identified two workarounds for this issue:\r\n\r\nA. Reboot from the Recovery HD partition before the drive fully decrypts\r\n\r\nIt appears that the issue is specific to completely finishing decryption while booted from a Mavericks Recovery HD partition. However, if you start decryption on a drive, then reboot, decryption will continue after the reboot. \r\n\r\nTo take advantage of this behavior, I tested and verified that if you start decryption while booted from the Recovery HD partition, then reboot from the Recovery HD partition to a drive running a full version of OS X 10.9.x, decryption finishes normally.\r\n\r\n\r\n\r\nB. Decrypt using the command line and run \"diskutil corestorage revert\" twice \r\n\r\n\r\nIn my testing, I verified that running diskutil corestorage revert will decrypt the drive. Running \"diskutil corestorage revert\" a second time directly after that first diskutil corestorage revert command will result in the the CoreStorage volume being removed and converting the drive back to a normal HFS+ drive. On reboot, the now-decrypted drive will boot normally.\r\n\r\nNotes:\r\n\r\nIn my testing, I did find it was possible to decrypt the drive via Disk Utility or the command line when it was attached as an external drive (via Target Disk Mode or other means) to a Mac that was booted to a full version of OS X 10.9.x. Once decrypted, I verified that the CoreStorage volume was removed. Once I had verified that, I further verified that I could now boot normally from the previously non-bootable hard drive.\r\n\r\nOne drawback to decrypting while attached to a regular 10.9.x boot drive is you would not be able to use an Institutional Recovery Key (IRK). Using that kind of recovery key for unlocking or decryption only works when booted from a Recovery HD partition or Internet Recovery. Since that's precisely where our problem exists, I investigated further to see if there were alternate workarounds for this problem (see Regression section for information on workarounds.)"
    email: rtrouton@gmail.com
    modified: "2015-01-07T10:16:47.937944Z"
    number: "17985943"
    number_intvalue: 17985943
    originated: 8-11-2014
    parent_number: '&{NULL_VALUE}'
    product: OS X
    product_version: 10.9.4 (13E28)
    reproducible: Always
    resolved: ""
    status: Closed
    title: Decrypting from the Mavericks 10.9.4 Recovery HD partition - Possible Diskutil Bug
