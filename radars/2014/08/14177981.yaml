apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "14177981"
    labels:
        datastore_id: "5231958837690368"
data:
    classification: Serious Bug
    created: "2014-08-11T11:40:10.59081Z"
    description: "Summary:\r\n\r\nI am experiencing an issue with the new UIToolbar. \r\n\r\nSteps to Reproduce:\r\n\r\n1. Create a simple UINavigationController with a simple root UIViewController and set it as the window's root view controller.\r\n2. In your UIViewController's -viewWillAppear set some toolbar items: self.toolbarItems = @[ /* any UIBarButtonItem */ ];\r\n3. Then (still in -viewWillAppear:) set a custom background image for your toolbar\r\n\r\nExpected Results:\r\n\r\nA UIToolbar with custom background image and a custom shadow image on top of it (like in iOS 6)\r\n\r\nActual Results:\r\n\r\nAlthough UIToolbar displays a custom background, it ignores the shadow I specified and displays the default 0.5pt line.\r\n\r\nThis is the UIToolbar actual view hierarchy (printed by -recursiveDescription):\r\n\r\n<UIToolbar: 0x9d9af40; frame = (0 524; 320 44); opaque = NO; autoresize = W+TM; layer = <CALayer: 0x9d7a720>>\r\n   | <_UIToolbarBackground: 0x9d7e000; frame = (0 0; 320 44); autoresize = W; userInteractionEnabled = NO; layer = <CALayer: 0x9d9a9c0>> - (null)\r\n   | <UIView: 0x9d9d360; frame = (0 -0.5; 320 0.5); autoresize = W+BM; layer = <CALayer: 0x9d82950>>\r\n   | <UIToolbarButton: 0x9da2d10; frame = (16 0; 23 44); opaque = NO; layer = <CALayer: 0x9da2880>>\r\n   |    | <_UIToolbarNavigationButton: 0x9da3680; frame = (0 0; 45 30); opaque = NO; layer = <CALayer: 0x9da3610>>\r\n   |    |    | <UIImageView: 0x9d7de50; frame = (11 3; 23 23); clipsToBounds = YES; opaque = NO; userInteractionEnabled = NO; layer = <CALayer: 0x9d7dee0>> - (null)\r\n   |    |    | <UIButtonLabel: 0x9da3ee0; frame = (0 0; 0 0); clipsToBounds = YES; hidden = YES; opaque = NO; userInteractionEnabled = NO; layer = <CALayer: 0x9da3fd0>>\r\n\r\nNotice the UIView (0x9d9d360) which is the 0.5pt (1px on Retina display) line drawn on top of UIToolbar. Additionally, there is no sign of UIImageView which would hold the shadow image.\r\n\r\nRegression:\r\n\r\nThis is a serious SDK bug and should be fixed ASAP.\r\n\r\nNotes:\r\n\r\nThe code I'm using:\r\n\r\n[self.navigationController.toolbar setBackgroundImage:[[UIImage imageNamed:@\"UIToolbarShadowImage.png\"] resizableImageWithCapInsets:UIEdgeInsetsMake(0, 0, 0, 0) resizingMode:UIImageResizingModeStretch] forToolbarPosition:UIBarPositionAny barMetrics:UIBarMetricsDefault];\r\n\r\n[self.navigationController.toolbar setShadowImage:[[UIImage imageNamed:@\"UIToolbarBackgroundImage.png\"] resizableImageWithCapInsets:UIEdgeInsetsMake(2, 0, 1, 0) resizingMode:UIImageResizingModeStretch forToolbarPosition:UIBarPositionAny];\r\n\r\n--- 17-Jun-2013 09:43 PM\r\n\r\nSteps to Reproduce:\r\n\r\n1. Create a simple UINavigationController with a simple root UIViewController and set it as the window's root view controller.\r\n2. In your UIViewController's -viewWillAppear set some toolbar items: self.toolbarItems = @[ /* any UIBarButtonItem */ ];\r\n3. In that method: self.navigationController.toolbarHidden = NO;\r\n4. Then (still in -viewWillAppear:) set a custom background image for your toolbar\r\n6. Still in that method, set a custom shadow image using -setShadowImage:forToolbarPosition:\r\n7. Put a breakpoint at the end of the method (just to do (lldb) [[[self navigationController] toolbar] recursiveDescription])\r\n\r\n--- 18-Jun-2013 01:14 AM / ADR\r\n\r\nEngineering has requested a test case/sample app in order to further investigate this issue.\r\n\r\n--- 19-Jun-2013 06:51 PM\r\n\r\nAttaching a demo project, as you requested.\r\n\r\n--- 19-Jun-2013 06:51 PM\r\n\r\n'ToolbarDemo.zip' was successfully uploaded\r\n\r\n--- 26-Jun-2013 02:48 AM / ADR\r\n\r\nEngineering has requested the following information in order to further investigate this issue:\r\n\r\nDoes this issue also occur with iOS 7 beta 2 (11A4400f)? Please verify with this release, and update your bug report with the results.\r\n\r\n--- 04-Jul-2013 12:39 PM\r\n\r\nYes, the issue is present in iOS 7 Beta 2 (11A4400f).\r\n\r\n--- 29-Jul-2013 09:45 PM\r\n\r\niOS 7 Beta 4 (11A4435d) almost fixed the issue. A UIImage is properly added to UIToolbar's hierarchy and is properly displayed, but strangely it has a background color.\r\n\r\nAfter some debugging, I found out that the backgroundColor property of UIImageView containing the shadow image is set to `UIDeviceRGBColorSpace 0 0 0 0.3`:\r\n\r\n(lldb) expr (UIToolbar *)[[self navigationController] toolbar]\r\n(UIToolbar *) $2 = 0x089946c0\r\n(lldb) po [$2 recursiveDescription]\r\n<UIToolbar: 0x89946c0; frame = (0 524; 320 44); opaque = NO; autoresize = W+TM; layer = <CALayer: 0x8994800>>\r\n   | <_UIToolbarBackground: 0x8995a10; frame = (0 0; 320 44); opaque = NO; autoresize = W; userInteractionEnabled = NO; layer = <CALayer: 0x8995b10>> - (null)\r\n   | <UIImageView: 0x8997230; frame = (0 -3; 320 3); opaque = NO; autoresize = W+BM; userInteractionEnabled = NO; layer = <CALayer: 0x8997200>> - (null)\r\n   | <UIToolbarButton: 0x89981e0; frame = (16 0; 23 44); opaque = NO; layer = <CALayer: 0x8998330>>\r\n   |    | <_UIToolbarNavigationButton: 0x8998600; frame = (0 0; 45 30); opaque = NO; layer = <CALayer: 0x8998780>>\r\n(lldb) po 0x8997230\r\n<UIImageView: 0x8997230; frame = (0 -3; 320 3); opaque = NO; autoresize = W+BM; userInteractionEnabled = NO; layer = <CALayer: 0x8997200>> - (null)\r\n(lldb) po [0x8997230 backgroundColor]\r\nUIDeviceRGBColorSpace 0 0 0 0.3\r\n\r\n--- 01-Aug-2013 01:03 AM / ADR\r\n\r\nThis bug has been closed as Duplicate. 14374501\r\n\r\n--- 13-Aug-2013 01:54 PM\r\n\r\nThe problem 14374501 appears to be closed, but the issue is STILL present in iOS Simulator with iOS 7.0 Beta 5 11A4449b  (check out my attached demo project).\r\n\r\n--- 20-Nov-2013 03:12 AM / ADR\r\n\r\nEngineering has requested the following information in order to further investigate this issue:\r\n\r\nDoes this issue also occur with iOS 7.1 beta? Please verify with this release, and update your report with the results.\r\n\r\n--- 21-Nov-2013 09:47 PM\r\n\r\nThe issue seems to be fixed in iOS 7.1 Beta (11D5099e)."
    email: adrian.kashivskyy@gmail.com
    modified: "2020-10-12T16:42:29.724062Z"
    number: "14177981"
    number_intvalue: 14177981
    originated: 17-Jun-2013 09:40 PM
    parent_number: '&{NULL_VALUE}'
    product: iOS SDK
    product_version: iOS 7.0 Beta 2 (11A4400f)
    reproducible: Always
    resolved: Yes
    status: Closed/Resolved
    title: 'UIKit: UIToolbar doesn''t display custom shadows'
