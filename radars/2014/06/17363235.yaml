apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "17363235"
    labels:
        datastore_id: "6428229367758848"
data:
    classification: Crash
    created: "2014-06-18T17:57:12.168221Z"
    description: "Summary:\r\nCalling -cancel on a MKMapSnapshotter instance randomly causes an EXC_BAD_ACCESS on a background thread\r\n\r\nThe number of iterations required for the crash to occur seems to be random, sometimes it takes a couple, other times hundreds...\r\n\r\nHaving a bad connection (or setting the Network Link Conditioner to 100% loss) seems to increase the odds of it happening.\r\n\r\nSteps to Reproduce:\r\nSample code\r\n\r\n- (void)execute\r\n{\r\n    [_snapshotter cancel];\r\n    MKMapSnapshotOptions *options = [MKMapSnapshotOptions new];\r\n    options.region = MKCoordinateRegionMakeWithDistance(CLLocationCoordinate2DMake(arc4random_uniform(90), arc4random_uniform(90)), 1000, 1000);\r\n    _snapshotter = [[MKMapSnapshotter alloc] initWithOptions:options];\r\n    [_snapshotter startWithCompletionHandler:^(MKMapSnapshot *snapshot, NSError *error) {\r\n        NSLog(@\"yeah\");\r\n    }];\r\n    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(0.2 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{\r\n        [self execute];\r\n    });\r\n}\r\n\r\nExpected Results:\r\nSnapshotter is canceled and no crash\r\n\r\nActual Results:\r\nEXC_BAD_ACCESS\r\n\r\nThread 5 Crashed:\r\n0   libsystem_kernel.dylib        \t0x39e0e1f0 __pthread_kill + 8\r\n1   libsystem_pthread.dylib       \t0x39e78792 pthread_kill + 54\r\n2   libsystem_c.dylib             \t0x39dbefd8 abort + 72\r\n3   libc++abi.dylib               \t0x390edcd2 abort_message + 70\r\n4   libc++abi.dylib               \t0x391066e0 default_terminate_handler() + 248\r\n5   libobjc.A.dylib               \t0x3984bf62 _objc_terminate() + 190\r\n6   libc++abi.dylib               \t0x391041c4 std::__terminate(void (*)()) + 76\r\n7   libc++abi.dylib               \t0x39103a18 __cxa_throw + 112\r\n8   libobjc.A.dylib               \t0x3984bd9e objc_exception_throw + 246\r\n9   CoreFoundation                \t0x2f0a0962 -[NSObject(NSObject) doesNotRecognizeSelector:] + 198\r\n10  CoreFoundation                \t0x2f09f24e ___forwarding___ + 702\r\n11  CoreFoundation                \t0x2efee7b4 _CF_forwarding_prep_0 + 20\r\n12  VectorKit                     \t0x36d7189a -[VKTileProvider changeTileForKey:toState:withMetadata:withTile:forLayer:] + 46\r\n13  VectorKit                     \t0x36dc19e0 -[VKTileProvider tileSource:invalidateKeys:] + 164\r\n14  VectorKit                     \t0x36ddf5ec -[VKTileSource didFailToLoadTileKey:error:] + 192\r\n15  GeoServices                   \t0x33d591fe ___ZN8LoadItem15deleteRequesterEP8NSStringbb_block_invoke + 86\r\n16  libdispatch.dylib             \t0x39d33830 _dispatch_call_block_and_release + 8\r\n17  libdispatch.dylib             \t0x39d33de8 _dispatch_queue_drain$VARIANT$up + 440\r\n18  libdispatch.dylib             \t0x39d34292 _dispatch_queue_invoke$VARIANT$up + 34\r\n19  libdispatch.dylib             \t0x39d4688a _dispatch_root_queue_drain + 74\r\n20  libdispatch.dylib             \t0x39d46b1c _dispatch_worker_thread2 + 52\r\n21  libsystem_pthread.dylib       \t0x39e75bd0 _pthread_wqthread + 296\r\n22  libsystem_pthread.dylib       \t0x39e75a94 start_wqthread + 4\r\n\r\n==========================\r\n\r\nThread 2 Crashed:\r\n0   libobjc.A.dylib               \t0x39855626 objc_msgSend + 6\r\n1   VectorKit                     \t0x36d7189a -[VKTileProvider changeTileForKey:toState:withMetadata:withTile:forLayer:] + 46\r\n2   VectorKit                     \t0x36dc19e0 -[VKTileProvider tileSource:invalidateKeys:] + 164\r\n3   VectorKit                     \t0x36ddf5ec -[VKTileSource didFailToLoadTileKey:error:] + 192\r\n4   GeoServices                   \t0x33d591fe ___ZN8LoadItem15deleteRequesterEP8NSStringbb_block_invoke + 86\r\n5   libdispatch.dylib             \t0x39d33830 _dispatch_call_block_and_release + 8\r\n6   libdispatch.dylib             \t0x39d33de8 _dispatch_queue_drain$VARIANT$up + 440\r\n7   libdispatch.dylib             \t0x39d34292 _dispatch_queue_invoke$VARIANT$up + 34\r\n8   libdispatch.dylib             \t0x39d4688a _dispatch_root_queue_drain + 74\r\n9   libdispatch.dylib             \t0x39d46b1c _dispatch_worker_thread2 + 52\r\n10  libsystem_pthread.dylib       \t0x39e75bd0 _pthread_wqthread + 296\r\n11  libsystem_pthread.dylib       \t0x39e75a94 start_wqthread + 4"
    email: exsephiroth87@gmail.com
    modified: "2014-06-23T09:24:28.77623Z"
    number: "17363235"
    number_intvalue: 17363235
    originated: 18/06/2014
    parent_number: '&{NULL_VALUE}'
    product: iOS SDK
    product_version: Any iOS7
    reproducible: Always
    resolved: ""
    status: Duplicate
    title: Cancelling a MKMapSnapshotter randomly crash application
