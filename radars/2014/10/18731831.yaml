apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "18731831"
    labels:
        datastore_id: "5065529593167872"
data:
    classification: Serious Bug
    created: "2014-10-22T02:44:24.176019Z"
    description: "Summary:\r\nIn order to run an app on a device it's necessary to have both an appropriate signing certificate and provisioning profile on the development Mac. In principle this is a straightforward though somewhat cumbersome process. In practice it's a steaming pile of shit that's prone to breaking for no readily apparent reason, accompanied by meaningless, confusing, or just plain incorrect error messages. Occasionally it also resumes working, also for no readily apparent reason.\r\n\r\nFor whatever it's worth, I've been developing iOS apps since early 2008 and I regard the code signing process as conceptually straightforward. In practice though, it's flaky and unreliable. More than six years in and I still routinely lose a day to trying to get code signing working again.\r\n\r\nThis happened last month:\r\n\r\nI had been building and debugging an app on a couple of devices for a few weeks when one day Xcode informed me that no valid provisioning profiles could be found. I found that the same profile I had been using all along was in fact still present and unchanged.\r\n\r\nI consulted with other team members, who informed me that device builds worked for them.\r\n\r\nDigging through the project I found that the code signing identity was set to \"automatic\". Although this worked for everyone else, I made sure to explicitly configure it to use the correct identity. No luck.\r\n\r\nNext, the provisioning profile. In most places the provisioning profile was set to \"automatic\" (the project has multiple targets, some of which depend on one or more of the others). Although \"automatic\" worked for everyone else, I changed the setting in several places to explicitly use the already-present and known good provisioning profile.\r\n\r\nAfter a while I was able to get a successful build. Hooray!\r\n\r\nBut then I tried to run the app on a device. Xcode informed me that the entitlements requested in the app's entitlements file did not match those on the provisioning profile. So, the app could not run. Sadly Xcode did not give any useful hints as to which entitlement(s) were incorrect.\r\n\r\nSo I took the liberty of examining both the provisioning profile and the app settings. I opened the provisioning profile in BBEdit to review the embedded property list. The certificate was... well, who knows? There's nothing there that I can correlate to anything in Keychain Access. The entitlements clearly matched. The device I was using was included. Basically, everything I could make sense of was correct.\r\n\r\nBy this time my project changes had gotten somewhat confused, so I told git to reset to the latest commit so I could start over.\r\n\r\nBUT FIRST, I decided to try building and running on the device. It worked.\r\n\r\nLet me be clear: Device builds wouldn't work. I made a bunch of changes but couldn't fix it. So I went back to where I had been at the start, only now device builds DID work. Net result: No lessons learned, nothing that I could potentially apply in future situations, just an unexplained change in behavior.\r\n\r\nSteps to Reproduce:\r\n1. Create an app that requires code signing (basically any iOS app)\r\n2. Attempt to build and run this code on any iOS-based device\r\n\r\nExpected Results:\r\nAssuming the presence of a valid certificate and provisioning profile,\r\n\r\n1. The app would install on a device and run\r\n2. This process would continue to work until the certificate expired or the certificate and/or profile were changed in some way.\r\n\r\nActual Results:\r\n[continued from \"Description\" section]\r\n\r\nSo I settled into an uneasy peace with device builds for a while. But then I had to travel for a couple of weeks, leaving my beloved iMac at home. When I finally returned, device builds were broken again. Symptoms were exactly as they had been before.\r\n\r\nI looked at the same issues at before-- certificates, provisions, entitlements. I got as far as Xcode claiming that entitlements were not correct again. I tried for about three hours without success before switching to the simulator and hoping for the best. This random screwing around in Xcode is fun and all, but I needed to get some work done.\r\n\r\nLooking at it again today, nothing had changed. There's no reason I should have expected it to change, except that last time it started working again with no explanation.\r\n\r\nDesperate to get a device build, I tried switching to another Mac. To be clear: This other Mac has\r\n\r\n1. The same developer accounts configured in Xcode\r\n2. The same certificates in Keychain access\r\n3. The same provisioning profiles\r\n4. The same project\r\n\r\nAnd it worked! AND I HAVE NO IDEA WHY.\r\n\r\nSo to recap:\r\n\r\n1. Code signing broke, but started working after changing a bunch of related project settings AND THEN REVERTING ALL OF THOSE CHANGES.\r\n\r\n2. Code signing broke again, with identical symptoms, but so far has not responded to the \"screw around for a while and then revert changes\" approach that worked before. However on an apparently-identical Mac, everything is fine.\r\n\r\nIn summary: Code signing works or doesn't work for incomprehensible reasons. Getting signing working again does not result in learning any useful skills that can be applied to future attempts.\r\n\r\n\r\nVersion:\r\nXcode 6.0 and Xcode 6.1 currently, but this kind of problem has existed for years.\r\n\r\nNotes:\r\nA couple of images are attached:\r\n\r\nprovisioning.png : error message from Xcode incorrectly claiming that there is a problem with the provisioning profile. [For Open Radar: see http://cl.ly/image/2s3b0P2S0523 ]\r\n\r\nentitlements.png : error message from Xcode incorrectly claiming that there is a problem with the app entitlements. [For Open Radar: see http://cl.ly/image/232y3f0N0W1c ]\r\n\r\nConfiguration:\r\n\r\n\r\nAttachments:\r\n'Archive.zip' was successfully uploaded."
    email: atomicbird@gmail.com
    modified: "2014-10-22T16:16:29.766938Z"
    number: "18731831"
    number_intvalue: 18731831
    originated: 21-Oct-2014 08:41 PM
    parent_number: '&{NULL_VALUE}'
    product: Developer Tools
    product_version: "6.1"
    reproducible: Sometimes
    resolved: ""
    status: Open
    title: Code signing is flaky and unreliable
