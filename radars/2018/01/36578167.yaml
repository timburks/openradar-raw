apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "36578167"
    labels:
        datastore_id: "6107666950651904"
data:
    classification: Other Bug
    created: "2018-01-17T10:37:42.42001Z"
    description: "Summary:\r\nWhen a hardware keyboard is connected and the keyboard is active, then a view controller is pushed on the navigation controller, the `UIKeyboardAssistantBar` deep within UIKit can have its height set to zero. However it has subviews specifying constraints that require a certain amount of height. This leads to logging in the console about ‘Unable to simultaneously satisfy constraints’. Also if people have a breakpoint set on `UIViewAlertForUnsatisfiableConstraints` it will be triggered.\n\nI’ve seen two slightly different situations leading to this but the underlying problem seems to be the same.\n\nThe unsatisfiable constraints are within the `UIRemoteKeyboardWindow`, in the bar with undo/redo etc (the only visible part of the keyboard when a hardware keyboard is connected). Here’s a snippet of the view hierarchy in that window:\n\n```\n<UIKeyboardImpl: 0x14e07b800; frame = (0 0; 1366 471); layer = <CALayer: 0x1c003fb40>>\n   | <UIKeyboardAssistantBar: 0x14deabf00; frame = (0 0; 1366 0); tintColor = UIExtendedGrayColorSpace 0 1; animations = { position=<CABasicAnimation: 0x1c46237e0>; bounds.origin=<CABasicAnimation: 0x1c46238a0>; bounds.size=<CABasicAnimation: 0x1c46238c0>; }; layer = <CALayer: 0x1c423dec0>>\n   |    | <_UIButtonBarStackView: 0x14deacf80; frame = (0 0; 187 55); clipsToBounds = YES; layer = <CALayer: 0x1c423df40>>\n   |    |    | <_UIButtonBarButton: 0x14ddd8520; frame = (19 10; 41 36); layer = <CALayer: 0x1c0435860>>\n```\n\nThere are unsatisfiable constraints for each button in the bar. They’re all like this:\n\n`NSAutoresizingMaskLayoutConstraint:0x1c0484470 h=--& v=--& UIKeyboardAssistantBar:0x14deabf00.height == 0   (active)`\n\n`V:|-(0)-[_UIButtonBarStackView]-(0)-|`\n(superview is `UIKeyboardAssistantBar`)\n\n`V:|-(10)-[_UIButtonBarButton]-(9)-|`\n(superview is `_UIButtonBarStackView`)\n\nSo the buttons needs 10 points above and 9 below but can’t have that because the height of the containing bar is manually set to zero.\r\n\r\nSteps to Reproduce:\r\n0. Run the attached sample project on iPad 10.5\" (or any size of iPad). Device and Simulator both work.\n\n1. Attach a hardware keyboard. (With a freshly launched Simulator I need to toggle the Connect Hardware Keyboard command off then on again to get into this state.)\n\n2. Tap in the text field. You should see just the bar at the bottom with undo/redo etc, not the whole keyboard because a hardware keyboard is attached.\n\n3. Tap the button to push a view controller.\r\n\r\nExpected Results:\r\nThe keyboard assistant bar should smoothly animate down off screen and there should be no unsatisfiable constraints so no logging in the console.\n\nThis can probably be achieved if UIKit either never sets the height of the `UIKeyboardAssistantBar` to zero, or hacks around these sorts of problems by setting up the constraints such that they are not required, typically by changing the priority of one constraint to 999.\r\n\r\nActual Results:\r\nThe keyboard assistant bar disappears without animation and this stuff is logged: (stack trace below)\n\n2018-01-17 10:02:40.301460+0000 Unsatisfied[1100:161150] [LayoutConstraints] Unable to simultaneously satisfy constraints.\r\n\tProbably at least one of the constraints in the following list is one you don't want. \r\n\tTry this: \r\n\t\t(1) look at each constraint and try to figure out which you don't expect; \r\n\t\t(2) find the code that added the unwanted constraint or constraints and fix it. \r\n\t(Note: If you're seeing NSAutoresizingMaskLayoutConstraints that you don't understand, refer to the documentation for the UIView property translatesAutoresizingMaskIntoConstraints) \r\n(\r\n    \"<NSAutoresizingMaskLayoutConstraint:0x1c0281310 h=--& v=--& UIKeyboardAssistantBar:0x151e1f280.height == 0   (active)>\",\r\n    \"<NSLayoutConstraint:0x1c4094eb0 V:|-(0)-[_UIButtonBarStackView:0x151d277e0]   (active, names: '|':UIKeyboardAssistantBar:0x151e1f280 )>\",\r\n    \"<NSLayoutConstraint:0x1c4094f00 V:[_UIButtonBarStackView:0x151d277e0]-(0)-|   (active, names: '|':UIKeyboardAssistantBar:0x151e1f280 )>\",\r\n    \"<NSLayoutConstraint:0x1c0280dc0 'UIButtonBar.maximumAlignmentSize' UIView:0x151e0c9d0.height == UILayoutGuide:0x1c01be140'UIViewLayoutMarginsGuide'.height   (active)>\",\r\n    \"<NSLayoutConstraint:0x1c008ce40 'UIView-bottomMargin-guide-constraint' V:[UILayoutGuide:0x1c01be140'UIViewLayoutMarginsGuide']-(9)-|   (active, names: '|':_UIButtonBarStackView:0x151d277e0 )>\",\r\n    \"<NSLayoutConstraint:0x1c008c710 'UIView-topMargin-guide-constraint' V:|-(10)-[UILayoutGuide:0x1c01be140'UIViewLayoutMarginsGuide']   (active, names: '|':_UIButtonBarStackView:0x151d277e0 )>\"\r\n)\r\n\r\nWill attempt to recover by breaking constraint \r\n<NSLayoutConstraint:0x1c008ce40 'UIView-bottomMargin-guide-constraint' V:[UILayoutGuide:0x1c01be140'UIViewLayoutMarginsGuide']-(9)-|   (active, names: '|':_UIButtonBarStackView:0x151d277e0 )>\r\n\r\nMake a symbolic breakpoint at UIViewAlertForUnsatisfiableConstraints to catch this in the debugger.\r\nThe methods in the UIConstraintBasedLayoutDebugging category on UIView listed in <UIKit/UIView.h> may also be helpful.\r\n2018-01-17 10:02:40.315803+0000 Unsatisfied[1100:161150] [LayoutConstraints] Unable to simultaneously satisfy constraints.\r\n\tProbably at least one of the constraints in the following list is one you don't want. \r\n\tTry this: \r\n\t\t(1) look at each constraint and try to figure out which you don't expect; \r\n\t\t(2) find the code that added the unwanted constraint or constraints and fix it. \r\n\t(Note: If you're seeing NSAutoresizingMaskLayoutConstraints that you don't understand, refer to the documentation for the UIView property translatesAutoresizingMaskIntoConstraints) \r\n(\r\n    \"<NSAutoresizingMaskLayoutConstraint:0x1c0281310 h=--& v=--& UIKeyboardAssistantBar:0x151e1f280.height == 0   (active)>\",\r\n    \"<NSLayoutConstraint:0x1c4094dc0 V:|-(0)-[_UIButtonBarStackView:0x151e1f560]   (active, names: '|':UIKeyboardAssistantBar:0x151e1f280 )>\",\r\n    \"<NSLayoutConstraint:0x1c4094f50 V:[_UIButtonBarStackView:0x151e1f560]-(0)-|   (active, names: '|':UIKeyboardAssistantBar:0x151e1f280 )>\",\r\n    \"<NSLayoutConstraint:0x1c0095e50 'UISV-canvas-connection' UILayoutGuide:0x1c01be3e0'UIViewLayoutMarginsGuide'.top == _UILayoutSpacer:0x1c01dd880'UISV-alignment-spanner'.top   (active)>\",\r\n    \"<NSLayoutConstraint:0x1c0095b80 'UISV-canvas-connection' UILayoutGuide:0x1c01be3e0'UIViewLayoutMarginsGuide'.bottom == _UILayoutSpacer:0x1c01dd880'UISV-alignment-spanner'.bottom   (active)>\",\r\n    \"<NSLayoutConstraint:0x1c40932e0 'UIView-bottomMargin-guide-constraint' V:[UILayoutGuide:0x1c01be3e0'UIViewLayoutMarginsGuide']-(9)-|   (active, names: '|':_UIButtonBarStackView:0x151e1f560 )>\",\r\n    \"<NSLayoutConstraint:0x1c4093330 'UIView-topMargin-guide-constraint' V:|-(10)-[UILayoutGuide:0x1c01be3e0'UIViewLayoutMarginsGuide']   (active, names: '|':_UIButtonBarStackView:0x151e1f560 )>\"\r\n)\r\n\r\nWill attempt to recover by breaking constraint \r\n<NSLayoutConstraint:0x1c0095b80 'UISV-canvas-connection' UILayoutGuide:0x1c01be3e0'UIViewLayoutMarginsGuide'.bottom == _UILayoutSpacer:0x1c01dd880'UISV-alignment-spanner'.bottom   (active)>\r\n\r\nMake a symbolic breakpoint at UIViewAlertForUnsatisfiableConstraints to catch this in the debugger.\r\nThe methods in the UIConstraintBasedLayoutDebugging category on UIView listed in <UIKit/UIView.h> may also be helpful.\r\n2018-01-17 10:02:40.327275+0000 Unsatisfied[1100:161150] [LayoutConstraints] Unable to simultaneously satisfy constraints.\r\n\tProbably at least one of the constraints in the following list is one you don't want. \r\n\tTry this: \r\n\t\t(1) look at each constraint and try to figure out which you don't expect; \r\n\t\t(2) find the code that added the unwanted constraint or constraints and fix it. \r\n\t(Note: If you're seeing NSAutoresizingMaskLayoutConstraints that you don't understand, refer to the documentation for the UIView property translatesAutoresizingMaskIntoConstraints) \r\n(\r\n    \"<NSAutoresizingMaskLayoutConstraint:0x1c0281310 h=--& v=--& UIKeyboardAssistantBar:0x151e1f280.height == 0   (active)>\",\r\n    \"<NSLayoutConstraint:0x1c4094e10 V:|-(0)-[_UIButtonBarStackView:0x151e05970]   (active, names: '|':UIKeyboardAssistantBar:0x151e1f280 )>\",\r\n    \"<NSLayoutConstraint:0x1c4094e60 V:[_UIButtonBarStackView:0x151e05970]-(0)-|   (active, names: '|':UIKeyboardAssistantBar:0x151e1f280 )>\",\r\n    \"<NSLayoutConstraint:0x1c02802d0 'UIButtonBar.maximumAlignmentSize' _UIButtonBarButton:0x151e46500.height == UILayoutGuide:0x1c41be4c0'UIViewLayoutMarginsGuide'.height   (active)>\",\r\n    \"<NSLayoutConstraint:0x1c4090ae0 'UIView-bottomMargin-guide-constraint' V:[UILayoutGuide:0x1c41be4c0'UIViewLayoutMarginsGuide']-(9)-|   (active, names: '|':_UIButtonBarStackView:0x151e05970 )>\",\r\n    \"<NSLayoutConstraint:0x1c4090540 'UIView-topMargin-guide-constraint' V:|-(10)-[UILayoutGuide:0x1c41be4c0'UIViewLayoutMarginsGuide']   (active, names: '|':_UIButtonBarStackView:0x151e05970 )>\"\r\n)\r\n\r\nWill attempt to recover by breaking constraint \r\n<NSLayoutConstraint:0x1c4090ae0 'UIView-bottomMargin-guide-constraint' V:[UILayoutGuide:0x1c41be4c0'UIViewLayoutMarginsGuide']-(9)-|   (active, names: '|':_UIButtonBarStackView:0x151e05970 )>\r\n\r\nMake a symbolic breakpoint at UIViewAlertForUnsatisfiableConstraints to catch this in the debugger.\r\nThe methods in the UIConstraintBasedLayoutDebugging category on UIView listed in <UIKit/UIView.h> may also be helpful.\r\n2018-01-17 10:02:40.336392+0000 Unsatisfied[1100:161150] [LayoutConstraints] Unable to simultaneously satisfy constraints.\r\n\tProbably at least one of the constraints in the following list is one you don't want. \r\n\tTry this: \r\n\t\t(1) look at each constraint and try to figure out which you don't expect; \r\n\t\t(2) find the code that added the unwanted constraint or constraints and fix it. \r\n\t(Note: If you're seeing NSAutoresizingMaskLayoutConstraints that you don't understand, refer to the documentation for the UIView property translatesAutoresizingMaskIntoConstraints) \r\n(\r\n    \"<NSAutoresizingMaskLayoutConstraint:0x1c0281310 h=--& v=--& UIKeyboardAssistantBar:0x151e1f280.height == 0   (active)>\",\r\n    \"<NSLayoutConstraint:0x1c4094dc0 V:|-(0)-[_UIButtonBarStackView:0x151e1f560]   (active, names: '|':UIKeyboardAssistantBar:0x151e1f280 )>\",\r\n    \"<NSLayoutConstraint:0x1c4094f50 V:[_UIButtonBarStackView:0x151e1f560]-(0)-|   (active, names: '|':UIKeyboardAssistantBar:0x151e1f280 )>\",\r\n    \"<NSLayoutConstraint:0x1c0096cb0 'UISV-alignment' UIImageView:0x151e1f770.centerY == UIView:0x151d54950.centerY   (active)>\",\r\n    \"<NSLayoutConstraint:0x1c0095e50 'UISV-canvas-connection' UILayoutGuide:0x1c01be3e0'UIViewLayoutMarginsGuide'.top == _UILayoutSpacer:0x1c01dd880'UISV-alignment-spanner'.top   (active)>\",\r\n    \"<NSLayoutConstraint:0x1c0095b30 'UISV-canvas-connection' UILayoutGuide:0x1c01be3e0'UIViewLayoutMarginsGuide'.centerY == UIImageView:0x151e1f770.centerY   (active)>\",\r\n    \"<NSLayoutConstraint:0x1c0094dc0 'UISV-spanning-boundary' _UILayoutSpacer:0x1c01dd880'UISV-alignment-spanner'.top <= UIView:0x151d54950.top   (active)>\",\r\n    \"<NSLayoutConstraint:0x1c40932e0 'UIView-bottomMargin-guide-constraint' V:[UILayoutGuide:0x1c01be3e0'UIViewLayoutMarginsGuide']-(9)-|   (active, names: '|':_UIButtonBarStackView:0x151e1f560 )>\",\r\n    \"<NSLayoutConstraint:0x1c4093330 'UIView-topMargin-guide-constraint' V:|-(10)-[UILayoutGuide:0x1c01be3e0'UIViewLayoutMarginsGuide']   (active, names: '|':_UIButtonBarStackView:0x151e1f560 )>\"\r\n)\r\n\r\nWill attempt to recover by breaking constraint \r\n<NSLayoutConstraint:0x1c0094dc0 'UISV-spanning-boundary' _UILayoutSpacer:0x1c01dd880'UISV-alignment-spanner'.top <= UIView:0x151d54950.top   (active)>\r\n\r\nMake a symbolic breakpoint at UIViewAlertForUnsatisfiableConstraints to catch this in the debugger.\r\nThe methods in the UIConstraintBasedLayoutDebugging category on UIView listed in <UIKit/UIView.h> may also be helpful.\r\n2018-01-17 10:02:40.342616+0000 Unsatisfied[1100:161150] [LayoutConstraints] Unable to simultaneously satisfy constraints.\r\n\tProbably at least one of the constraints in the following list is one you don't want. \r\n\tTry this: \r\n\t\t(1) look at each constraint and try to figure out which you don't expect; \r\n\t\t(2) find the code that added the unwanted constraint or constraints and fix it. \r\n\t(Note: If you're seeing NSAutoresizingMaskLayoutConstraints that you don't understand, refer to the documentation for the UIView property translatesAutoresizingMaskIntoConstraints) \r\n(\r\n    \"<NSAutoresizingMaskLayoutConstraint:0x1c0281310 h=--& v=--& UIKeyboardAssistantBar:0x151e1f280.height == 0   (active)>\",\r\n    \"<NSLayoutConstraint:0x1c4094dc0 V:|-(0)-[_UIButtonBarStackView:0x151e1f560]   (active, names: '|':UIKeyboardAssistantBar:0x151e1f280 )>\",\r\n    \"<NSLayoutConstraint:0x1c4094f50 V:[_UIButtonBarStackView:0x151e1f560]-(0)-|   (active, names: '|':UIKeyboardAssistantBar:0x151e1f280 )>\",\r\n    \"<NSLayoutConstraint:0x1c00947d0 'UIButtonBar.maximumAlignmentSize' _UIButtonBarButton:0x151d5ace0.height == UILayoutGuide:0x1c01be3e0'UIViewLayoutMarginsGuide'.height   (active)>\",\r\n    \"<NSLayoutConstraint:0x1c40932e0 'UIView-bottomMargin-guide-constraint' V:[UILayoutGuide:0x1c01be3e0'UIViewLayoutMarginsGuide']-(9)-|   (active, names: '|':_UIButtonBarStackView:0x151e1f560 )>\",\r\n    \"<NSLayoutConstraint:0x1c4093330 'UIView-topMargin-guide-constraint' V:|-(10)-[UILayoutGuide:0x1c01be3e0'UIViewLayoutMarginsGuide']   (active, names: '|':_UIButtonBarStackView:0x151e1f560 )>\"\r\n)\r\n\r\nWill attempt to recover by breaking constraint \r\n<NSLayoutConstraint:0x1c40932e0 'UIView-bottomMargin-guide-constraint' V:[UILayoutGuide:0x1c01be3e0'UIViewLayoutMarginsGuide']-(9)-|   (active, names: '|':_UIButtonBarStackView:0x151e1f560 )>\r\n\r\nMake a symbolic breakpoint at UIViewAlertForUnsatisfiableConstraints to catch this in the debugger.\r\nThe methods in the UIConstraintBasedLayoutDebugging category on UIView listed in <UIKit/UIView.h> may also be helpful.\n\n---\n\nThis is the stack trace:\n\n* thread #1, queue = 'com.apple.main-thread', stop reason = breakpoint 2.1\n  * frame #0: 0x000000018f422140 UIKit`UIViewAlertForUnsatisfiableConstraints\n    frame #1: 0x0000000185cc0be8 Foundation`-[NSISEngine handleUnsatisfiableRowWithHead:body:usingInfeasibilityHandlingBehavior:mutuallyExclusiveConstraints:] + 460\n    frame #2: 0x0000000185c9efbc Foundation`-[NSISEngine fixUpValueRestrictionViolationsWithInfeasibilityHandlingBehavior:] + 576\n    frame #3: 0x0000000185e6f000 Foundation`-[NSISEngine _optimizeWithoutRebuilding] + 288\n    frame #4: 0x0000000185c9ece0 Foundation`-[NSISEngine optimize] + 132\n    frame #5: 0x0000000185e6d034 Foundation`-[NSISEngine performPendingChangeNotifications] + 112\n    frame #6: 0x000000018e926b98 UIKit`-[UIView(Hierarchy) layoutBelowIfNeeded] + 240\n    frame #7: 0x000000018e949a68 UIKit`+[UIView(UIViewAnimationWithBlocks) _setupAnimationWithDuration:delay:view:options:factory:animations:start:animationStateGenerator:completion:] + 620\n    frame #8: 0x000000018e960470 UIKit`+[UIView(UIViewAnimationWithBlocks) animateWithDuration:delay:options:animations:completion:] + 108\n    frame #9: 0x000000018f66e904 UIKit`-[UIKeyboardAssistantBar setShow:] + 996\n    frame #10: 0x000000018ed77448 UIKit`-[UIKeyboardImpl updateAssistantBar] + 508\n    frame #11: 0x000000018e940f14 UIKit`-[UIKeyboardImpl setDelegate:force:] + 1192\n    frame #12: 0x000000018e93a6dc UIKit`-[UIPeripheralHost(UIKitInternal) _reloadInputViewsForResponder:] + 1544\n    frame #13: 0x000000018ebfa644 UIKit`+[UIView(Internal) _performBlockDelayingTriggeringResponderEvents:] + 516\n    frame #14: 0x000000018ead9e80 UIKit`-[_UINavigationParallaxTransition animateTransition:] + 1112\n    frame #15: 0x000000018ea98414 UIKit`-[UINavigationController _startCustomTransition:] + 3444\n    frame #16: 0x000000018e9bac4c UIKit`-[UINavigationController _startDeferredTransitionIfNeeded:] + 712\n    frame #17: 0x000000018e9ba890 UIKit`-[UINavigationController __viewWillLayoutSubviews] + 164\n    frame #18: 0x000000018e9ba790 UIKit`-[UILayoutContainerView layoutSubviews] + 188\n    frame #19: 0x000000018e911f00 UIKit`-[UIView(CALayerDelegate) layoutSublayersOfLayer:] + 1276\n    frame #20: 0x00000001893a1998 QuartzCore`-[CALayer layoutSublayers] + 184\n    frame #21: 0x00000001893a5b20 QuartzCore`CA::Layer::layout_if_needed(CA::Transaction*) + 332\n    frame #22: 0x000000018931236c QuartzCore`CA::Context::commit_transaction(CA::Transaction*) + 336\n    frame #23: 0x0000000189339b90 QuartzCore`CA::Transaction::commit() + 540\n    frame #24: 0x000000018933a9d0 QuartzCore`CA::Transaction::observer_callback(__CFRunLoopObserver*, unsigned long, void*) + 92\n    frame #25: 0x0000000185305edc CoreFoundation`__CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__ + 32\n    frame #26: 0x0000000185303894 CoreFoundation`__CFRunLoopDoObservers + 412\n    frame #27: 0x0000000185303e50 CoreFoundation`__CFRunLoopRun + 1292\n    frame #28: 0x0000000185223e58 CoreFoundation`CFRunLoopRunSpecific + 436\n    frame #29: 0x00000001870d0f84 GraphicsServices`GSEventRunModal + 100\n    frame #30: 0x000000018e97867c UIKit`UIApplicationMain + 236\n    frame #31: 0x0000000100c22b80 Unsatisfied`main(argc=1, argv=0x000000016f1e39f0) at main.m:12\n    frame #32: 0x0000000184d4056c libdyld.dylib`start + 4\r\n\r\nVersion:\r\niOS 11.2 Xcode 9.2\r\n\r\nNotes:\r\nIn our project, this only happens when the view controller being pushed returns YES to canBecomeFirstResponder, which is needs to do for shake to undo support. The problem occurs with a different stack trace but both paths lead into an animation block in -[UIKeyboardAssistantBar setShow:].\n\nOur workaround is to make sure we return NO to this method when the navigation controller tries to make the incoming view controller first responder, then after that change our response to YES and call becomeFirstResponder ourselves (which we have to do anyway in case the VC is not pushed but shown some other way)."
    email: douglashill@douglashill.co
    modified: "2018-01-17T10:37:42.42025Z"
    number: "36578167"
    number_intvalue: 36578167
    originated: 17-Jan-2018 10:37 am
    parent_number: '&{NULL_VALUE}'
    product: iOS + SDK
    product_version: iOS 11.2 Xcode 9.2
    reproducible: Always
    resolved: ""
    status: Open
    title: UIKeyboardAssistantBar tries to layout with a height of zero leading to unsatisfiable constraints
