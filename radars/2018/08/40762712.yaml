apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "40762712"
    labels:
        datastore_id: "5018494248681472"
data:
    classification: Bug
    created: "2018-08-03T06:21:20.45715Z"
    description: "Area: Foundation\r\n\r\nSummary:   When Language implies Decimal Comma and Region implies Decimal Period, the Locale is set incorrectly to reflect the region but not the language.  A Decimal Pad will come up with a Decimal Comma.  But a NumberFormatter() will be expecting a Decimal Period and will not recognize numeric input from Decimal Pad with a Decimal Comma.  \r\n\r\nSteps to Reproduce:   Happens with any combination of Language that implies a Decimal Comma and Region that implies a Decimal Period.  For example, in Settings choose Language to be French, and Region to be US.  On iPhone in a Text Field configured for Decimal Pad, the Decimal Pad will come up with a Decimal Comma for the decimal separator.  But a NumberFormatter() with no explicit configuration with fail to recognize the comma in the text field.   Inspection shows that Locale.autoupdatingCurrent.identifier is en_US.  \r\n\r\nIf a NumberFormatter() is explicitly configured with the proper Locale:\r\n\r\n        let LocaleString = \"fr_US\"\r\n        formatterComma = NumberFormatter()\r\n        formatterComma?.locale = Locale(identifier: LocaleString)\r\n\r\nit works just fine - it will recognize input in a Text Field from a Decimal Pad that comes up with a Decimal Comma and inserts comma as the decimal separator.   In trying various Language/Region combinations in Settings I have never seen the Locale identifier returned by the framework to be anything other than en_xx where xx is determined by the Region.   Locale appears to ignore the Language setting. The default configuration for NumberFormatter() also appears to ignore the Language setting.  \r\n\r\nThe problem does not appear to be in NumberFormatter(), but rather that the Language portion of the Language/Region combination is informing the Decimal Pad to use a Comma, but it is not correctly informing what Locale reports or what NumberFormatter() uses as its locale.   \r\n\r\nExpected Results:   Decimal Pad and NumberFormatter() and Locale and any other parts of the system that change behavior based on the Language and Region in Settings must all behave in a consistent manner as regards whether a Decimal Comma or a Decimal Period is the convention.   In terms of correct localization the convention should be chosen to make sense according to the combination.  But in terms of program correctness it just has to be consistent.   As it stands, correctness is impossible. \r\n\r\nActual Results:  When Language/Region is set to French/US or any combination of Language using a Decimal Comma and Region using a Decimal Period, Decimal Pad shows a comma but NumberFormatter() expects a period and Locale reports the wrong identifier.\r\n\r\nVersion/Build:  iOS 11.4\r\n\r\nConfiguration:  iPhone X\r\n\r\nDemonstration Project: https://github.com/WB2ISS/FormatTester\r\n\r\n\r\nUpdate/Closed 4/28/19\r\n\r\nIn iOS 12.2 this problem has been addressed.  It appears that the decimal separator that is now shown in the Decimal Pad and the convention expected on input by NumberFormater() both follow the convention for the Region in a consistent way so that if the Decimal Pad shows a comma as a decimal separator the NumberFormater() will recognize it, and if the Decimal Pad shows a period as a decimal separator, the NumberFormater() will recognize that.   \r\n\r\nThis is sufficient to allow use of the NumberFormater()  for correctly recognizing input, which was not possible before.\r\n\r\nHowever, it appears that the convention in use is not entirely consistent with that of the rest of the system. \r\nFor example, set the Language to French and the Region to US.  The Decimal Pad shows period for the decimal separator and NumberFormater() recognizes the period, so it will work correctly.   But the following issues remain:\r\n\r\n(1) The examples shown in Settings show comma as the decimal separator.\r\n\r\n(2) The components of Locale.autoupdatingCurrent show English as the language (it should be French), US as the region (that is correct), and comma as the group separator (consistent with what is shown in Settings, not consistent with what is shown in the Decimal Pad or expected by NumberFormatter()).\r\n\r\nBut these remaining issues might be considered to be different problems than the problem related to the Decimal Pad and the NumberFormatter() which now work in a consistent manner and can be considered to be fixed."
    email: sdr-receiver@transitiontechnologyventures.com
    modified: "2019-04-28T22:57:45.655056Z"
    number: "40762712"
    number_intvalue: 40762712
    originated: 6/3/18
    parent_number: '&{NULL_VALUE}'
    product: iOS
    product_version: "11.4"
    reproducible: Yes
    resolved: iOS 12.2 fixes the NumberFormater() part of this problem
    status: Closed
    title: Decimal Comma languages not handled correctly by Locale or NumberFormatter()
