apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "42811113"
    labels:
        datastore_id: "5066537643802624"
data:
    classification: Serious Bug
    created: "2018-08-01T13:00:09.20581Z"
    description: "Summary:\r\nThis is a duplicate of radar #42808310 (see this for example)\n\nSetting up subviews of a UITableViewCell’s contentView with constraints to the cell’s layoutMarginsGuide produces unexpected results. The layout constraints fail to specify a height.\n\nIt is desirable to use the cell’s margins, not the contentView’s margins in order to match the appearance of UITableViewCell’s built-in layout of its built-in subviews (e.g. textLabel).\n\nThe difference between these margins is that the top and bottom margins on the cell increase as the system content size category increases, while the contentView’s margins remain constant. Using the contentView margins results in content looking cramped at large text sizes.\n\r\n\r\nSteps to Reproduce:\r\n1. Set up a UITableViewCell with custom subviews and layout.\n2. Specify layout constraints to specify a height for self-sizing cells that keeps the content within the cells’s layoutMarginsGuide.\n\nYou can see this in action in the attached sample project. It sets up a table view that alternates between a cell with standard layout and a custom cell. The interesting code is in CustomCell.m\r\n\r\nExpected Results:\r\nThe custom cells should look identical to the standard cells.\r\n\r\nActual Results:\r\nThe custom cells do no use multiple lines of text and all use a standard fixed height, so text gets truncated or even disappears entirely at large content size categories. From the debugger, the constrains added involving the cell’s layoutMarginsGuide don’t seem to exist at all when the cell appears.\n\nThis message is logged in the console:\n\n[Warning] Warning once only: Detected a case where constraints ambiguously suggest a height of zero for a tableview cell's content view. We're considering the collapse unintentional and using standard height instead.\n\nAdditionally at very large accessibility content size categories, this is logged in the console:\n\n[LayoutConstraints] Unable to simultaneously satisfy constraints.\n\tProbably at least one of the constraints in the following list is one you don't want. \n\tTry this: \n\t\t(1) look at each constraint and try to figure out which you don't expect; \n\t\t(2) find the code that added the unwanted constraint or constraints and fix it. \n(\n    \"<NSLayoutConstraint:0x6000024d2ad0 UILabel:0x7fc6ffd19f20'twelve million three hund...'.top == UILayoutGuide:0x600003ebaa00'UIViewLayoutMarginsGuide'.top   (active)>\",\n    \"<NSLayoutConstraint:0x6000024d3a70 UILayoutGuide:0x600003ebaa00'UIViewLayoutMarginsGuide'.bottom == UILabel:0x7fc6ffd19f20'twelve million three hund...'.bottom   (active)>\",\n    \"<NSLayoutConstraint:0x6000024d2710 'UIView-bottomMargin-guide-constraint' V:[UILayoutGuide:0x600003ebaa00'UIViewLayoutMarginsGuide']-(32)-|   (active, names: '|':CustomCell:0x7fc701046600'custom' )>\",\n    \"<NSLayoutConstraint:0x6000024c8780 'UIView-Encapsulated-Layout-Height' CustomCell:0x7fc701046600'custom'.height == 44   (active)>\",\n    \"<NSLayoutConstraint:0x6000024d2530 'UIView-topMargin-guide-constraint' V:|-(32)-[UILayoutGuide:0x600003ebaa00'UIViewLayoutMarginsGuide']   (active, names: '|':CustomCell:0x7fc701046600'custom' )>\"\n)\n\nIt appears UITableView forces the cell to layout with a height of 44, but the margins alone are already 32 + 32 which is greater than 44.\r\n\r\nVersion:\r\n12.0 dev beta 5\r\n\r\nNotes:\r\nThis is not a new problem. It happens on iOS 11 too.\n\nThis problem can be worked around by sizing the cell using sizeThatFits and layoutSubviews instead of constraints. You can see this in action by changing this line in CustomCell.m\n\n#define USE_CONSTRAINTS 1\n\nto\n\n#define USE_CONSTRAINTS 0\n\nWhen doing this, there are no warnings in the console and the custom cells perfectly mimic the built-in cells.\n\nAn alternative for implementations already using constraints is to accept sub-optimal margins that don’t match the built-in cell layout, by using the contentView layout margins instead. You can see this by changing\n\nlet container = self.layoutMarginsGuide;\n\nto\n\nlet container = self.contentView.layoutMarginsGuide;\n\nNote that the vertical margins on the custom cell then differ from the standard cells."
    email: steipete@gmail.com
    modified: "2018-08-01T13:00:09.20607Z"
    number: "42811113"
    number_intvalue: 42811113
    originated: 01-Aug-2018 03:00 PM
    parent_number: '&{NULL_VALUE}'
    product: iOS + SDK
    product_version: 12.0 dev beta 5
    reproducible: Always
    resolved: ""
    status: Open
    title: Constraints to UITableViewCell layoutMarginsGuide do not work
