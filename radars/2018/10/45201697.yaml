apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "45201697"
    labels:
        datastore_id: "4939563713691648"
data:
    classification: ""
    created: "2018-10-11T20:04:28.251852Z"
    description: "Summary:\r\nOn iOS 12, the AASA file cannot be downloaded with 5 minutes after rebooting the phone. If we leave the phone open for 5 minutes, the problem will go away. \r\n\r\nI saw logs like:\r\n{name: ThunderingHerdPolicy, policyWeight: 1.000, response: {Decision: Must Not Proceed, Score: 0.00, Rationale: [{timeSinceThunderingHerdTriggerEvent < 300}]}}\r\n\r\nIt seems the ThunderingHerdPolicy is blocking the task to download the AASA file. (Actually, the log shows ThunderingHerdPolicy was blocking a lot of other tasks)\r\n\r\nThis is NOT reproducible on iOS11.\r\n\r\nSteps to Reproduce:\r\nI will use the Youtube app as an example:\r\n1. Delete Youtube app from the phone\r\n2. Reboot the iPhone.\r\n3. Go to the App store to download the Youtube app.\r\n4. Go to https://m.youtube.com and try to open the app through the universal link\r\nIf you finish step 3 and 4 within 5minutes after reboot, iOS won't be able to detect the installed Youtube app.\r\n\r\nExpected Results:\r\nAASA file and the universal link should work right after rebooting the iPhone.\r\n\r\nActual Results:\r\nUsers have to wait for about 5 minutes after reboot for universal links to work.\r\n{name: ThunderingHerdPolicy, policyWeight: 1.000, response: {Decision: Must Not Proceed, Score: 0.00, Rationale: [{timeSinceThunderingHerdTriggerEvent < 300}]}}\r\n\r\nVersion/Build:\r\niOS 12. Tried on 12.0, 12.0.1, 12.1 Beta3\r\n\r\nSome device logs filtered by \"swcd\":\r\ndefault\t14:41:43.830014 -0400\tswcd\tAdded service 'applinks', appID 'EQHXZ8M8AV.com.google.ios.youtube', domain 'www.youtube.com'\r\ndefault\t14:41:43.831630 -0400\tswcd\tStarting NSURLSession com.apple.SharedWebCredentials-94C51D34-5792-4408-880C-A542E1536145, Discretionary yes\r\ndefault\t14:41:44.356799 -0400\tswcd\tbackground session setup will wait for reply: session <private> with identifier <private>\r\ndefault\t14:41:44.365005 -0400\tswcd\tbackground session setup reply received: session <private> with identifier <private>\r\ndefault\t14:41:44.644823 -0400\tswcd\tTask <0099DDD7-15D4-4338-A3C6-410A5711AF47>.<1> resuming, QOS(0x15)\r\ndefault\t14:41:44.646168 -0400\tswcd\tStarted request for domain 'www.youtube.com', URL 'https://www.youtube.com/.well-known/apple-app-site-association'\r\ndefault\t14:41:44.646287 -0400\tswcd\tAdded service 'applinks', appID 'EQHXZ8M8AV.com.google.ios.youtube', domain 'youtu.be'\r\ndefault\t14:41:44.876103 -0400\tdasd\tSubmitted Activity: com.apple.CFNetwork-cc-90-23-Task <0099DDD7-15D4-4338-A3C6-410A5711AF47>.<com.apple.swcd>.<com.apple.SharedWebCredentials-94C51D34-5792-4408-880C-A542E1536145>.<1>:1D9EC9 <private>\r\ndefault\t14:41:44.878622 -0400\tdasd\tcom.apple.CFNetwork-cc-90-23-Task <0099DDD7-15D4-4338-A3C6-410A5711AF47>.<com.apple.swcd>.<com.apple.SharedWebCredentials-94C51D34-5792-4408-880C-A542E1536145>.<1>:1D9EC9:[\r\n\t{name: CPUUsagePolicy, policyWeight: 5.000, response: {Decision: Must Not Proceed, Score: 0.00, Rationale: [{[Max allowed CPU Usage level]: Required:50.00, Observed:90.00},]}}\r\n\t{name: ThunderingHerdPolicy, policyWeight: 1.000, response: {Decision: Must Not Proceed, Score: 0.00, Rationale: [{timeSinceThunderingHerdTriggerEvent < 300}]}}\r\n ], FinalDecision: Must Not Proceed}\r\ndefault\t14:41:44.879632 -0400\tswcd\tTask <09160EAB-137A-43CB-A135-2BFBDD470339>.<2> resuming, QOS(0x15)\r\ndefault\t14:41:44.892592 -0400\tdasd\tSubmitted Activity: com.apple.CFNetwork-cc-90-24-Task <09160EAB-137A-43CB-A135-2BFBDD470339>.<com.apple.swcd>.<com.apple.SharedWebCredentials-94C51D34-5792-4408-880C-A542E1536145>.<2>:62E775 <private>\r\ndefault\t14:41:44.892888 -0400\tdasd\tcom.apple.CFNetwork-cc-90-24-Task <09160EAB-137A-43CB-A135-2BFBDD470339>.<com.apple.swcd>.<com.apple.SharedWebCredentials-94C51D34-5792-4408-880C-A542E1536145>.<2>:62E775:[\r\n\t{name: CPUUsagePolicy, policyWeight: 5.000, response: {Decision: Must Not Proceed, Score: 0.00, Rationale: [{[Max allowed CPU Usage level]: Required:50.00, Observed:90.00},]}}\r\n\t{name: ThunderingHerdPolicy, policyWeight: 1.000, response: {Decision: Must Not Proceed, Score: 0.00, Rationale: [{timeSinceThunderingHerdTriggerEvent < 300}]}}\r\n ], FinalDecision: Must Not Proceed}\r\ndefault\t14:41:44.898352 -0400\tswcd\tStarted request for domain 'youtu.be', URL 'https://youtu.be/.well-known/apple-app-site-association'\r\ndefault\t14:41:45.020024 -0400\tswcd\tAdded service 'applinks', appID 'EQHXZ8M8AV.com.google.ios.youtube', domain 'youtube.com'\r\ndefault\t14:41:45.027501 -0400\tswcd\tTask <AD83657C-2135-4920-84BE-BE260CCBEC6D>.<3> resuming, QOS(0x15)\r\ndefault\t14:41:45.062140 -0400\tswcd\tStarted request for domain 'youtube.com', URL 'https://youtube.com/.well-known/apple-app-site-association'\r\ndefault\t14:41:45.064186 -0400\tswcd\tAdded service 'applinks', appID 'EQHXZ8M8AV.com.google.ios.youtube', domain 'm.youtube.com'\r\ndefault\t14:41:45.140982 -0400\tswcd\tTask <C733170D-876C-4AA1-B3DF-B626254626BC>.<4> resuming, QOS(0x15)\r\ndefault\t14:41:45.141052 -0400\tswcd\tStarted request for domain 'm.youtube.com', URL 'https://m.youtube.com/.well-known/apple-app-site-association'\r\ndefault\t14:41:45.141120 -0400\tswcd\tSave database\r\ndefault\t14:41:45.146448 -0400\tdasd\tSubmitted Activity: com.apple.CFNetwork-cc-90-25-Task <AD83657C-2135-4920-84BE-BE260CCBEC6D>.<com.apple.swcd>.<com.apple.SharedWebCredentials-94C51D34-5792-4408-880C-A542E1536145>.<3>:B05126 <private>\r\ndefault\t14:41:45.149232 -0400\tdasd\tcom.apple.CFNetwork-cc-90-25-Task <AD83657C-2135-4920-84BE-BE260CCBEC6D>.<com.apple.swcd>.<com.apple.SharedWebCredentials-94C51D34-5792-4408-880C-A542E1536145>.<3>:B05126:[\r\n\t{name: CPUUsagePolicy, policyWeight: 5.000, response: {Decision: Must Not Proceed, Score: 0.00, Rationale: [{[Max allowed CPU Usage level]: Required:50.00, Observed:90.00},]}}\r\n\t{name: ThunderingHerdPolicy, policyWeight: 1.000, response: {Decision: Must Not Proceed, Score: 0.00, Rationale: [{timeSinceThunderingHerdTriggerEvent < 300}]}}\r\n ], FinalDecision: Must Not Proceed}\r\ndefault\t14:41:45.151047 -0400\tdasd\tSubmitted Activity: com.apple.CFNetwork-cc-90-26-Task <C733170D-876C-4AA1-B3DF-B626254626BC>.<com.apple.swcd>.<com.apple.SharedWebCredentials-94C51D34-5792-4408-880C-A542E1536145>.<4>:F5D562 <private>\r\ndefault\t14:41:45.151314 -0400\tdasd\tcom.apple.CFNetwork-cc-90-26-Task <C733170D-876C-4AA1-B3DF-B626254626BC>.<com.apple.swcd>.<com.apple.SharedWebCredentials-94C51D34-5792-4408-880C-A542E1536145>.<4>:F5D562:[\r\n\t{name: CPUUsagePolicy, policyWeight: 5.000, response: {Decision: Must Not Proceed, Score: 0.00, Rationale: [{[Max allowed CPU Usage level]: Required:50.00, Observed:90.00},]}}\r\n\t{name: ThunderingHerdPolicy, policyWeight: 1.000, response: {Decision: Must Not Proceed, Score: 0.00, Rationale: [{timeSinceThunderingHerdTriggerEvent < 300}]}}\r\n ], FinalDecision: Must Not Proceed}\r\ndefault\t14:41:50.035631 -0400\tswcd\tGet info for service 'applinks', app ID 'NULL', domain 'm.yo...'\r\ndefault\t14:41:51.486913 -0400\tdasd\tcom.apple.CFNetwork-cc-90-24-Task <09160EAB-137A-43CB-A135-2BFBDD470339>.<com.apple.swcd>.<com.apple.SharedWebCredentials-94C51D34-5792-4408-880C-A542E1536145>.<2>:62E775:[\r\n\t{name: CPUUsagePolicy, policyWeight: 5.000, response: {Decision: Must Not Proceed, Score: 0.00, Rationale: [{[Max allowed CPU Usage level]: Required:50.00, Observed:90.00},]}}\r\n\t{name: ThunderingHerdPolicy, policyWeight: 1.000, response: {Decision: Must Not Proceed, Score: 0.00, Rationale: [{timeSinceThunderingHerdTriggerEvent < 300}]}}\r\n ], FinalDecision: Must Not Proceed}\r\n.\r\n.\r\n.\r\ndefault\t14:42:52.295405 -0400\tdasd\tcom.apple.CFNetwork-cc-90-26-Task <C733170D-876C-4AA1-B3DF-B626254626BC>.<com.apple.swcd>.<com.apple.SharedWebCredentials-94C51D34-5792-4408-880C-A542E1536145>.<4>:F5D562:[\r\n\t{name: ThunderingHerdPolicy, policyWeight: 1.000, response: {Decision: Must Not Proceed, Score: 0.00, Rationale: [{deviceInUse == 1 AND timeSinceThunderingHerdTriggerEvent < 900}]}}\r\n ], FinalDecision: Must Not Proceed}\r\ndefault\t14:43:58.143163 -0400\tdasd\tcom.apple.CFNetwork-cc-90-23-Task <0099DDD7-15D4-4338-A3C6-410A5711AF47>.<com.apple.swcd>.<com.apple.SharedWebCredentials-94C51D34-5792-4408-880C-A542E1536145>.<1>:1D9EC9:[\r\n\t{name: ApplicationPolicy, policyWeight: 5.000, response: {Decision: Can Proceed, Score: 0.10}}\r\n ] sumScores:60.410000, denominator:64.910000, FinalDecision: Can Proceed FinalScore: 0.930673}\r\ndefault\t14:43:58.143212 -0400\tdasd\t'com.apple.CFNetwork-cc-90-23-Task <0099DDD7-15D4-4338-A3C6-410A5711AF47>.<com.apple.swcd>.<com.apple.SharedWebCredentials-94C51D34-5792-4408-880C-A542E1536145>.<1>:1D9EC9' has compatibility score of 1.000000 with 'com.apple.CFNetwork-cc-90-1:2E33B7'. Relaxing scores.\r\ndefault\t14:43:58.143284 -0400\tdasd\t'com.apple.CFNetwork-cc-90-23-Task <0099DDD7-15D4-4338-A3C6-410A5711AF47>.<com.apple.swcd>.<com.apple.SharedWebCredentials-94C51D34-5792-4408-880C-A542E1536145>.<1>:1D9EC9' CurrentScore: 0.930673, ThresholdScore: 0.580686 DecisionToRun:1\r\ndefault\t14:43:58.147422 -0400\tnsurlsessiond\t[C26 Hostname#1f4a45b8:443 tcp, bundle id: com.apple.swcd, url: https://www.youtube.com/.well-known/apple-app-site-association, traffic class: 100, tls, indefinite] start\r\ndefault\t14:43:58.503821 -0400\tswcd\tCompleting request for 'https://www.youtube.com/.well-known/apple-app-site-association', status 0/0x0 noErr\r\ndefault\t14:43:58.506661 -0400\tswcd\tUpdated app ID 'EQHXZ8M8AV.com.google.ios.youtube', domain 'www.youtube.com', flags 0x0 < > -> 0x2 < SiteApproved > on check\r\ndefault\t14:43:59.897878 -0400\tnsurlsessiond\t[C26 Hostname#1f4a45b8:443 tcp, bundle id: com.apple.swcd, url: https://www.youtube.com/.well-known/apple-app-site-association, traffic class: 100, tls, indefinite] cancel\r\ndefault\t14:43:59.897965 -0400\tnsurlsessiond\t[C26 Hostname#1f4a45b8:443 tcp, bundle id: com.apple.swcd, url: https://www.youtube.com/.well-known/apple-app-site-association, traffic class: 100, tls, indefinite] cancelled\r\n\t[C26.1 <private> 192.168.2.14:56827<->IPv4#3b2ff364:443]\r\n\tConnected Path: satisfied (Path is satisfied), interface: en0, ipv4, dns\r\n\tDuration: 1.743s, DNS @0.001s took 0.060s, TCP @0.068s took 0.050s, TLS took 0.156s\r\n\tbytes in/out: 4756/556, packets in/out: 5/3, rtt: 0.047s, retransmitted packets: 0, out-of-order packets: 0\r\ndefault\t14:43:59.903604 -0400\tdasd\tCOMPLETED com.apple.CFNetwork-cc-90-23-Task <0099DDD7-15D4-4338-A3C6-410A5711AF47>.<com.apple.swcd>.<com.apple.SharedWebCredentials-94C51D34-5792-4408-880C-A542E1536145>.<1>:1D9EC9 <private>!"
    email: guangyu.wangg@yahoo.com
    modified: "2018-10-11T20:06:34.329781Z"
    number: "45201697"
    number_intvalue: 45201697
    originated: 2018/10/11
    parent_number: '&{NULL_VALUE}'
    product: iOS
    product_version: 12+
    reproducible: Yes
    resolved: No
    status: OPEN
    title: iOS 12 cannot fetch AASA file within 5 minutes after rebooting the phone
