apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: FB9745180
    labels:
        datastore_id: "4957351970865152"
data:
    classification: ""
    created: "2021-11-08T12:05:09.12434Z"
    description: "Please describe the issue:\r\nI recently got a new MacBook Pro M1 Pro 14-inch. I connected it to an external display (initially through a Thunderbolt hub but I also tried connecting it directly) and noticed that after putting my Mac to sleep, it wakes up the external display for a fraction of a second roughly once per minute.\r\n\r\nI went looking for the cause of it and ran the following command after putting macOS to sleep when Simulator is open:\r\n\r\npmset -g log | grep -i \"wake from\"\r\n\r\nAnd got:\r\n\r\n2021-11-07 16:41:16 +0100 Wake                \tDarkWake to FullWake from Deep Idle [CDNVA] : due to HID Activity Using AC (Charge:100%)           \r\n2021-11-07 16:43:34 +0100 DarkWake            \tDarkWake from Deep Idle [CDN] : due to SMC.OutboxNotEmpty smc.70070000 wifibt bluetooth-pcie/ Using AC (Charge:100%) 45 secs   \r\n2021-11-07 16:44:23 +0100 DarkWake            \tDarkWake from Deep Idle [CDN] : due to SMC.OutboxNotEmpty smc.70070000 wifibt bluetooth-pcie/ Using AC (Charge:100%) 45 secs   \r\n2021-11-07 16:45:11 +0100 DarkWake            \tDarkWake from Deep Idle [CDN] : due to SMC.OutboxNotEmpty smc.70070000 wifibt bluetooth-pcie/ Using AC (Charge:100%) 45 secs   \r\n2021-11-07 16:46:03 +0100 DarkWake            \tDarkWake from Deep Idle [CDN] : due to SMC.OutboxNotEmpty smc.70070000 wifibt bluetooth-pcie/ Using AC (Charge:100%) 45 secs   \r\n2021-11-07 16:46:56 +0100 DarkWake            \tDarkWake from Deep Idle [CDN] : due to SMC.OutboxNotEmpty smc.70070000 wifibt bluetooth-pcie/ Using AC (Charge:100%) 45 secs   \r\n2021-11-07 16:47:48 +0100 DarkWake            \tDarkWake from Deep Idle [CDN] : due to SMC.OutboxNotEmpty smc.70070000 wifibt bluetooth-pcie/ Using AC (Charge:100%) 45 secs   \r\n2021-11-07 16:48:41 +0100 DarkWake            \tDarkWake from Deep Idle [CDN] : due to SMC.OutboxNotEmpty smc.70070000 wifibt bluetooth-pcie/ Using AC (Charge:100%) 45 secs   \r\n2021-11-07 16:49:33 +0100 DarkWake            \tDarkWake from Deep Idle [CDN] : due to SMC.OutboxNotEmpty smc.70070000 wifibt bluetooth-pcie/ Using AC (Charge:100%) 45 secs   \r\n\r\nTimes of those dark wakes match the times when my external display waked up. Then I confirmed that the same happens when no Thunderbolt device is connected to my MacBook Pro (it was only connected to power).\r\n\r\nI checked if disabling additional wake reasons would help by running:\r\nsudo pmset -a tcpkeepalive 0\r\nsudo pmset -a powernap 0\r\nsudo pmset -a ttyskeepawake 0\r\n\r\nBut MacBook Pro continues to wake up from sleep roughly each minute. It doesn’t do this when I quit the Simulator before putting it to sleep. In that case it wakes up only roughly once per hour which makes more sense (I assume it does some maintenance due to PowerNap).\r\n\r\nI’m attaching the following files:\r\n- sysdiagnose_2021.11.07_16-50-35+0100_839_macOS_MacBookPro18-3_21A559 - it was taken after I put my Mac to sleep for ~5 minutes; Simulator was open before sleep started \r\n- sysdiagnose_2021.11.07_17-06-51+0100_548_macOS_MacBookPro18-3_21A559 - it was taken after Mac slept for ~10 minutes; I quit Simulator before putting Mac to sleep;\r\n- pmset_log.txt - logs from `pmset -g log` in the period when Mac should be sleeping;\r\n\r\nThis didn’t happen on my previous Intel MacBook Pro, so assume it’s somehow related to the new SoC or changes in macOS Monterey.\r\n\r\n\r\nPlease list the steps you took to reproduce the issue:\r\n1. Run macOS Monterey 12.0.1 on a new MacBook Pro 14\" with M1 Pro chip.\r\n2. Open Xcode 13.1.\r\n3. Open Simulator by right clicking on Xcode icon in the dock and choosing Open Developer Tools > Simulator.\r\n4. Click on Apple icon in menu bar, click Sleep.\r\n5. Wait for a few minutes.\r\n6. Wake up macOS.\r\n7. Run pmset -g log | grep -i \"wake from\" from the terminal and see that macOS kept waking up roughly once per minute.\r\n\r\n\r\nWhat did you expect to happen?\r\nI expect my Mac to not wake up each minute when Simulator is open before I put my Mac to sleep.\r\n\r\n\r\nWhat actually happened?\r\nMac either keeps waking up roughly every minute or doesn't sleep at all (I'm not sure from just looking at logs)."
    email: arkadiusz.holko@gmail.com
    modified: "2021-11-08T12:32:04.552825Z"
    number: FB9745180
    number_intvalue: 9745180
    originated: Nov 7, 2021
    parent_number: '&{NULL_VALUE}'
    product: Simulator/Xcode
    product_version: "13.1"
    reproducible: ""
    resolved: ""
    status: Open
    title: Simulator causes MacBook Pro M1 Pro to wake from sleep every minute
