apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "9190612"
    labels:
        datastore_id: "4966861665992704"
data:
    classification: ""
    created: "2021-12-10T10:03:49.688474Z"
    description: "Hello!\r\n\r\nSimple setup like:\r\n\r\nAppTarget -> (links) Static framework -> (links) Any SPM package + ObjC linker flag\r\n\r\ncan't be compiled with 'duplicated symbols' error.\r\n\r\nThis issue also discussed here: https://forums.swift.org/t/objc-flag-causes-duplicate-symbols-with-swift-packages/27926/16\r\n\r\n\r\nAs SPM package in sample project I will use https://github.com/tonyarnold/Differ.\r\n\r\nIn logs we see that Differ.o linked twice: one from FileList and one from command line argument:\r\n\r\n```\r\nLibtool /Users/me/Library/Developer/Xcode/DerivedData/SomeProj-gngyoxsieckidgcorslbncolmgcc/Build/Products/Debug-iphonesimulator/SharedCode.framework/SharedCode normal (in target 'SharedCode' from project 'SomeProj')\r\n    cd /Users/me/dev/other/SomeProj\r\n    export IPHONEOS_DEPLOYMENT_TARGET\\=14.5\r\n    /Applications/Xcode-12.5.0-Release.Candidate.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/libtool -static -arch_only x86_64 -D -syslibroot /Applications/Xcode-12.5.0-Release.Candidate.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator14.5.sdk -L/Users/me/Library/Developer/Xcode/DerivedData/SomeProj-gngyoxsieckidgcorslbncolmgcc/Build/Products/Debug-iphonesimulator -filelist /Users/me/Library/Developer/Xcode/DerivedData/SomeProj-gngyoxsieckidgcorslbncolmgcc/Build/Intermediates.noindex/SomeProj.build/Debug-iphonesimulator/SharedCode.build/Objects-normal/x86_64/SharedCode.LinkFileList /Users/me/Library/Developer/Xcode/DerivedData/SomeProj-gngyoxsieckidgcorslbncolmgcc/Build/Products/Debug-iphonesimulator/Differ.o -dependency_info /Users/me/Library/Developer/Xcode/DerivedData/SomeProj-gngyoxsieckidgcorslbncolmgcc/Build/Intermediates.noindex/SomeProj.build/Debug-iphonesimulator/SharedCode.build/Objects-normal/x86_64/SharedCode_libtool_dependency_info.dat -o /Users/me/Library/Developer/Xcode/DerivedData/SomeProj-gngyoxsieckidgcorslbncolmgcc/Build/Products/Debug-iphonesimulator/SharedCode.framework/SharedCode\r\n```\r\n\r\nHere is warning about it:\r\n```\r\n/Applications/Xcode-12.5.0-Release.Candidate.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/libtool: warning same member name (Differ.o) in output file used for input files: /Users/me/Library/Developer/Xcode/DerivedData/SomeProj-gngyoxsieckidgcorslbncolmgcc/Build/Products/Debug-iphonesimulator/Differ.o and: /Users/me/Library/Developer/Xcode/DerivedData/SomeProj-gngyoxsieckidgcorslbncolmgcc/Build/Products/Debug-iphonesimulator/Differ.o (due to use of basename, truncation, blank padding or duplicate input files)\r\n```\r\n\r\n\r\nIn result Differ.o presented in SharedCode twice:\r\n\r\n```\r\n$ otool -v -s __TEXT __objc_methname SharedCode\r\nArchive : SharedCode\r\nSharedCode(SharedCode_vers.o):\r\nSharedCode(Differ.o):\r\nContents of (__TEXT,__objc_methname) section\r\n0000000000030494  beginUpdates\r\n00000000000304a1  deleteRowsAtIndexPaths:withRowAnimation:\r\n00000000000304ca  insertRowsAtIndexPaths:withRowAnimation:\r\n00000000000304f3  endUpdates\r\n00000000000304fe  deleteSections:withRowAnimation:\r\n000000000003051f  insertSections:withRowAnimation:\r\n0000000000030540  performBatchUpdates:completion:\r\n0000000000030560  insertSections:\r\n0000000000030570  deleteSections:\r\n0000000000030580  deleteItemsAtIndexPaths:\r\n0000000000030599  insertItemsAtIndexPaths:\r\n00000000000305b2  moveItemAtIndexPath:toIndexPath:\r\n00000000000305d3  moveSection:toSection:\r\n00000000000305ea  moveRowAtIndexPath:toIndexPath:\r\nSharedCode(Differ.o):\r\nContents of (__TEXT,__objc_methname) section\r\n0000000000030494  beginUpdates\r\n00000000000304a1  deleteRowsAtIndexPaths:withRowAnimation:\r\n00000000000304ca  insertRowsAtIndexPaths:withRowAnimation:\r\n00000000000304f3  endUpdates\r\n00000000000304fe  deleteSections:withRowAnimation:\r\n000000000003051f  insertSections:withRowAnimation:\r\n0000000000030540  performBatchUpdates:completion:\r\n0000000000030560  insertSections:\r\n0000000000030570  deleteSections:\r\n0000000000030580  deleteItemsAtIndexPaths:\r\n0000000000030599  insertItemsAtIndexPaths:\r\n00000000000305b2  moveItemAtIndexPath:toIndexPath:\r\n00000000000305d3  moveSection:toSection:\r\n00000000000305ea  moveRowAtIndexPath:toIndexPath:\r\n```\r\n\r\n-ObjC flag forces loading all category methods which results to duplicated symbols error.\r\n\r\nSteps to reproduce:\r\n1. Open the attached sample project\r\n2. Build SomeProj target\r\n\r\nWhat did you expect to happen:\r\nSuccess build\r\n\r\nWhat actually happened:\r\n342 duplicate symbols for architecture x86_64"
    email: gvr.oleg@gmail.com
    modified: "2021-12-10T10:05:17.903548Z"
    number: "9190612"
    number_intvalue: 9190612
    originated: 18 June 2021
    parent_number: '&{NULL_VALUE}'
    product: Xcode
    product_version: Version 12.5 (12E262)
    reproducible: ""
    resolved: ""
    status: Open
    title: Xcode build error with SPM + static framework + ObjC flag
