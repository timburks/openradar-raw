apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "8817703"
    labels:
        datastore_id: "1003401"
data:
    classification: Serious Bug
    created: "2011-01-04T17:45:46.216118Z"
    description: "Summary:\r\n\r\nWe're running Mac OS X 10.6.5 Server for Open Directory Master, Mac OS X 10.6.4 Server for our AFP server, and Mac OS X 10.6.4 on clients bound to the OD Master. Workstations are bound to the OD Master for authentication & managed preferences (by user & group, none by machine) and users have mobile home folders.\r\n\r\nWe only white-list specific applications (by a single group) which users can run and generally do NOT sign them in Workgroup Manager as security doesn't need to be that tight (and it makes upgrades easier). However, a few applications (all stored in either /Applications or ~/Applications) are signed by the developer and users get the \"You don't have permission to use the application\" error when attempting to launch those applications. Applications which are NOT signed by the developer (and not signed in WGM) work correctly.\r\n\r\nPutting the signed-by-the-developer application in a subdirectory and whitelisting that directory in WGM still does not allow the application to be run.\r\n\r\nSteps to Reproduce:\r\n\r\n1) Install an application which has been signed by the developer (in our case, we used FileMaker Pro 5.5 & Parallels Desktop 6) in /Applications on the client workstation.\r\n\r\n2) Launch WGM and select a user or group which has application managed prefs.\r\n\r\n3) Click the Preferences button in toolbar, select the Overview tab (it should be selected by default), then click the Applications icon.\r\n\r\n4) Select the Applications tab (it should be selected by default) and ensure that the Always radio button is selected for Manage and the \"Restrict which applications are allowed to launch\" checkbox is checked (after all, this was supposed to be a user/group with managed applications).\r\n\r\n5) Select the Applications tab (yes, the other; it should also be selected by default), click the '+' button, select the application you installed in Step 1, and click Add button.\r\n\r\n6) In the dialog that pops up, click the \"Don't Sign\" button.\r\n\r\n7) Click the \"Apply Now\" button to save the settings.\r\n\r\n8) Log into the workstation w/the user (or a user in the group) for which you've just allowed the application in Steps 2-7.\r\n\r\n9) Attempt to launch said application.\r\n\r\n-- OR --\r\n\r\nReplace Steps 5 & 6 with the following:\r\n\r\n5) Select the Folders tab, click the '+' button next to the \"Allow applications within these folders\" list.\r\n\r\n6) Select the folder containing the application installed in Step 1 (e.g. \"/Applications/FileMaker Pro 5.5 folder\" for FileMaker Pro 5.5) and click the Add button.\r\n\r\nExpected Results:\r\n\r\nThe newly installed application which was signed by the developer (not by WGM) should be allowed to be run by the user (or user in the group).\r\n\r\nActual Results:\r\n\r\nThe newly installed application which was signed by the developer (not by WGM) will fail to launch with a \"You don't have permission to use the application\" error. In /var/log/system.log you'll find errors like the following (for FileMaker Pro 5.5, in this case):\r\n\r\nDec 22 17:36:24 hostname parentalcontrolsd[43221]: -[ActivityTracker checkApp:csFlags:] [954:username] -- *** Incoming app appears to be masquerading as white listed app and failed signature validation: /Users/username/Applications/FileMaker Pro 5.5/FileMaker Pro.app/Contents/MacOS/FileMaker Pro. Note: This may be a valid app of a different version than what was whitelisted (on a different volume?)\r\nDec 22 17:36:24 hostname [0x0-0xa42a42].com.filemaker.filemakerpro[43304]: launch of /Users/username/Applications/FileMaker Pro 5.5/FileMaker Pro.app/Contents/MacOS/FileMaker Pro was blocked\r\nDec 22 17:36:24 hostname com.apple.launchd.peruser.1340[6375] ([0x0-0xa42a42].com.filemaker.filemakerpro[43304]): Exited with exit code: 255\r\nDec 22 17:36:24 hostname parentalcontrolsd[43221]: -[ActivityTracker(Private) _removeAppFromWhiteList:] [1362:username] -- *** Couldn't find local user record\r\n\r\nRegression:\r\n\r\nNotes:\r\n\r\nWe've verified that the applications were signed by the developer by running `codesign -dv /path/to/application` after a fresh install of the application (having uninstalled/deleted the previously installed version).\r\n\r\nFor FileMaker Pro, the result of `codesign -dv /Users/user/Applications/FileMaker\\ Pro\\ 5.5/FileMaker\\ Pro.app` was:\r\n\r\nExecutable=/Users/user/Applications/FileMaker Pro 5.5/FileMaker Pro.app/Contents/MacOS/FileMaker Pro\r\nIdentifier=com.filemaker.filemakerpro\r\nFormat=bundle with CFM/PEF binary\r\nCodeDirectory v=20100 size=29615 flags=0x2(adhoc) hashes=1474+3 location=system\r\nSignature=adhoc\r\nInfo.plist entries=13\r\nSealed Resources rules=4 files=12\r\nInternal requirements count=1 size=72\r\n\r\nAnd for Parallels Desktop 6, the result of `codesign -dv /Applications/Parallels\\ Desktop.app` was:\r\n\r\nExecutable=/Applications/Parallels Desktop.app/Contents/MacOS/prl_client_app\r\nIdentifier=com.parallels.desktop.console\r\nFormat=bundle with Mach-O thin (i386)\r\nCodeDirectory v=20001 size=203534 flags=0x0(none) hashes=10170+3 location=embedded\r\nSignature size=3668\r\nSigned Time=Nov 2, 2010 9:36:55 AM\r\nInfo.plist entries=21\r\nSealed Resources rules=4 files=1\r\nInternal requirements count=0 size=12\r\n\r\nWe've found that we can work around the issue by installing the application, signing it in WGM, and then making sure we copy _that specific signed copy_ over installations of the same version on other workstations, but the fact that one cannot white-list it WITHOUT signing (or even whitelist by folder) is shocking, counterintuitive,  and a major problem for our workflow, esp. as more & more developers sign their applications."
    email: morgan.aldridge@gmail.com
    modified: "2011-08-28T05:38:32.694958Z"
    number: "8817703"
    number_intvalue: 8817703
    originated: 04-Jan-2011 12:43 PM
    parent_number: '&{NULL_VALUE}'
    product: Mac OS X
    product_version: 10.6.4
    reproducible: Yes
    resolved: ""
    status: Open
    title: Cannot whitelist app signed by developer in managed prefs w/o signing w/WGM
