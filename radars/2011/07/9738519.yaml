apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "9738519"
    labels:
        datastore_id: "1235407"
data:
    classification: Bug
    created: "2011-07-07T19:59:22.668565Z"
    description: "Summary:\r\n\r\nSteps to Reproduce:\r\nRun the attached app under valgrind:\r\nvalgrind TrashTest <file_folder_to delete>\r\n\r\nExpected Results:\r\nNo Errors reported from valgrind\r\n\r\nActual Results:\r\n\r\n==30388== Memcheck, a memory error detector\r\n==30388== Copyright (C) 2002-2010, and GNU GPL'd, by Julian Seward et al.\r\n==30388== Using Valgrind-3.7.0.SVN and LibVEX; rerun with -h for copyright info\r\n==30388== Command: /Users/dmaclach/Desktop/TrashTest/build/Debug/TrashTest /Users/dmaclach/Desktop/V8\\ Test\r\n==30388== \r\n--30388-- /Users/dmaclach/Desktop/TrashTest/build/Debug/TrashTest:\r\n--30388-- dSYM directory is missing; consider using --dsymutil=yes\r\n==30388== Syscall param access_extended(entries) points to uninitialised byte(s)\r\n==30388==    at 0x10014616E: accessx_np (in /usr/lib/libSystem.B.dylib)\r\n==30388==    by 0x100376FA8: _FSGetExtendedUserAccess (in /System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/CarbonCore.framework/Versions/A/CarbonCore)\r\n==30388==    by 0x101EA4A5B: TFSInfo::GetExtendedUserAccess(unsigned int, unsigned int, unsigned int&) const (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101EA4977: TFSInfo::FetchExtendedUserAccess() (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101EA48AA: TFSInfo::Initialize(FSRef const&, FSRef const&, TUString const&, TFSCatalogInfo const&, unsigned int) (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101EA453C: TFSInfo::Initialize(FSRef const&, unsigned int) (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101EB7817: TFSInfo::Initialize(__CFURL const*) (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101F08AE2: TFSCopyOperation::DoMoveToTrash(TCountedPtr<TCFURLInfo> const&) (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101EFE655: _NodeOperation (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x1003DEFCD: _FSOperateOnObjectSync (in /System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/CarbonCore.framework/Versions/A/CarbonCore)\r\n==30388==    by 0x100000D86: main (in /Users/dmaclach/Desktop/TrashTest/build/Debug/TrashTest)\r\n==30388==  Address 0x7fff5fbfd5c8 is on thread 1's stack\r\n==30388== \r\n==30388== Mismatched free() / delete / delete []\r\n==30388==    at 0x1000117D2: operator delete[](void*) (vg_replace_malloc.c:409)\r\n==30388==    by 0x101ECF548: TPropertyStream::SetLength(int) (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101ECC6B9: TPropertyStream::WriteData(unsigned char const*, int) (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101ECC639: TPropertyStream::Write(unsigned int, unsigned char const*, unsigned int) (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101EC022A: IAStoreStream::MaybeFlushBuffer() (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101ECCB26: Page::Write(IAStorage*, IAStoreStream*) (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101ECC996: BTree::Flush() (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101ECE88C: TPropertyInfo::FlushChanges(TCountedPtr<TFSInfo> const&, TCountedPtr<TPropertyInfoList> const&, bool) (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101ECE579: TPropertyInfo::FlushChanges(TCountedPtr<TCFURLInfo> const&, TCountedPtr<TPropertyInfoList> const&, bool) (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101ECE3B1: THFSPlusPropertyStore::FlushChanges() (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101F08468: TFSCopyOperation::MoveProperties(THFSPlusExtendedPropertyIterator&, TCountedPtr<TCFURLInfo>&, TUString const&) (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101F08D05: TFSCopyOperation::DoMoveToTrash(TCountedPtr<TCFURLInfo> const&) (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==  Address 0x101b124a0 is 0 bytes inside a block of size 4,096 alloc'd\r\n==30388==    at 0x100011553: calloc (vg_replace_malloc.c:467)\r\n==30388==    by 0x101ECE73D: TPropertyInfo::FlushChanges(TCountedPtr<TFSInfo> const&, TCountedPtr<TPropertyInfoList> const&, bool) (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101ECE579: TPropertyInfo::FlushChanges(TCountedPtr<TCFURLInfo> const&, TCountedPtr<TPropertyInfoList> const&, bool) (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101ECE3B1: THFSPlusPropertyStore::FlushChanges() (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101F08468: TFSCopyOperation::MoveProperties(THFSPlusExtendedPropertyIterator&, TCountedPtr<TCFURLInfo>&, TUString const&) (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101F08D05: TFSCopyOperation::DoMoveToTrash(TCountedPtr<TCFURLInfo> const&) (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101EFE655: _NodeOperation (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x1003DEFCD: _FSOperateOnObjectSync (in /System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/CarbonCore.framework/Versions/A/CarbonCore)\r\n==30388==    by 0x100000D86: main (in /Users/dmaclach/Desktop/TrashTest/build/Debug/TrashTest)\r\n==30388== \r\n==30388== Mismatched free() / delete / delete []\r\n==30388==    at 0x1000117D2: operator delete[](void*) (vg_replace_malloc.c:409)\r\n==30388==    by 0x101EC2833: TPropertyStream::~TPropertyStream() (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101EC27E7: IAStorage::~IAStorage() (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101EC26A0: BuddyStorage::~BuddyStorage() (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101ECE95C: TPropertyInfo::FlushChanges(TCountedPtr<TFSInfo> const&, TCountedPtr<TPropertyInfoList> const&, bool) (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101ECE579: TPropertyInfo::FlushChanges(TCountedPtr<TCFURLInfo> const&, TCountedPtr<TPropertyInfoList> const&, bool) (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101ECE3B1: THFSPlusPropertyStore::FlushChanges() (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101F08468: TFSCopyOperation::MoveProperties(THFSPlusExtendedPropertyIterator&, TCountedPtr<TCFURLInfo>&, TUString const&) (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101F08D05: TFSCopyOperation::DoMoveToTrash(TCountedPtr<TCFURLInfo> const&) (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101EFE655: _NodeOperation (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x1003DEFCD: _FSOperateOnObjectSync (in /System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/CarbonCore.framework/Versions/A/CarbonCore)\r\n==30388==    by 0x100000D86: main (in /Users/dmaclach/Desktop/TrashTest/build/Debug/TrashTest)\r\n==30388==  Address 0x101b3cc20 is 0 bytes inside a block of size 24,576 alloc'd\r\n==30388==    at 0x100011553: calloc (vg_replace_malloc.c:467)\r\n==30388==    by 0x101ECF522: TPropertyStream::SetLength(int) (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101ECC6B9: TPropertyStream::WriteData(unsigned char const*, int) (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101ECC639: TPropertyStream::Write(unsigned int, unsigned char const*, unsigned int) (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101EC022A: IAStoreStream::MaybeFlushBuffer() (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101ECCB26: Page::Write(IAStorage*, IAStoreStream*) (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101ECC996: BTree::Flush() (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101ECE88C: TPropertyInfo::FlushChanges(TCountedPtr<TFSInfo> const&, TCountedPtr<TPropertyInfoList> const&, bool) (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101ECE579: TPropertyInfo::FlushChanges(TCountedPtr<TCFURLInfo> const&, TCountedPtr<TPropertyInfoList> const&, bool) (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101ECE3B1: THFSPlusPropertyStore::FlushChanges() (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101F08468: TFSCopyOperation::MoveProperties(THFSPlusExtendedPropertyIterator&, TCountedPtr<TCFURLInfo>&, TUString const&) (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388==    by 0x101F08D05: TFSCopyOperation::DoMoveToTrash(TCountedPtr<TCFURLInfo> const&) (in /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv)\r\n==30388== \r\n==30388== \r\n==30388== HEAP SUMMARY:\r\n==30388==     in use at exit: 532,809 bytes in 2,778 blocks\r\n==30388==   total heap usage: 6,822 allocs, 4,044 frees, 1,153,372 bytes allocated\r\n==30388== \r\n==30388== LEAK SUMMARY:\r\n==30388==    definitely lost: 0 bytes in 0 blocks\r\n==30388==    indirectly lost: 0 bytes in 0 blocks\r\n==30388==      possibly lost: 0 bytes in 0 blocks\r\n==30388==    still reachable: 532,809 bytes in 2,778 blocks\r\n==30388==         suppressed: 0 bytes in 0 blocks\r\n==30388== Rerun with --leak-check=full to see details of leaked memory\r\n==30388== \r\n==30388== For counts of detected and suppressed errors, rerun with: -v\r\n==30388== Use --track-origins=yes to see where uninitialised values come from\r\n==30388== ERROR SUMMARY: 15 errors from 3 contexts (suppressed: 0 from 0)\r\n\r\nRegression:\r\n\r\nNotes:\r\nOn Chrome we also see\r\nMismatchedFree\r\nMismatched free() / delete / delete []\r\n  operator delete(void*) (mp/valgrind-src/valgrind-memcheck/valgrind/coregrind/m_replacemalloc/vg_replace_malloc.c:387)\r\n  THFSPlusCatalog::~THFSPlusCatalog()\r\n  TNode::SetCatalog(THFSPlusCatalog*)\r\n  TMountPointList::AddVolume(short, bool)\r\n  TMountPointList::Find(short, TNode::StPopulating*)\r\n  TMountPointList::SupportsInvisibleBit(short, TNode::StPopulating*, bool)\r\n  THFSPlusPropertyStore::Open(bool, bool) const\r\n  THFSPlusPropertyStore::GetProperties(bool) const\r\n  TFSCopyOperation::GetSourcePropertyStore(THFSPlusRef const&)\r\n  TFSCopyOperation::DoMoveToTrash(THFSPlusRef const&)\r\n  TFSCopyOperation::Run()\r\n  _FSOperation\r\n  _FSOperateOnObjectSync\r\n  FSMoveObjectToTrashSync\r\n ...\r\nAddress 0x13541630 is 0 bytes inside a block of size 14 alloc'd\r\n  operator new[](unsigned long) (mp/valgrind-src/valgrind-memcheck/valgrind/coregrind/m_replacemalloc/vg_replace_malloc.c:305)\r\n  NewHFSUniStr255(__CFString const*)\r\n  THFSPlusCatalog::SystemBuildVersion()\r\n  THFSPlusCatalog::THFSPlusCatalog(TNode*, short, FSVolumeInfo const&)\r\n  TMountPointList::AddVolume(short, bool)\r\n  TMountPointList::Find(short, TNode::StPopulating*)\r\n  TMountPointList::SupportsInvisibleBit(short, TNode::StPopulating*, bool)\r\n  THFSPlusPropertyStore::Open(bool, bool) const\r\n  THFSPlusPropertyStore::GetProperties(bool) const\r\n  TFSCopyOperation::GetSourcePropertyStore(THFSPlusRef const&)\r\n  TFSCopyOperation::DoMoveToTrash(THFSPlusRef const&)\r\n  TFSCopyOperation::Run()\r\n  _FSOperation\r\n  _FSOperateOnObjectSync\r\n  FSMoveObjectToTrashSync\r\n..."
    email: dmaclach@gmail.com
    modified: "2011-08-28T05:35:50.209229Z"
    number: "9738519"
    number_intvalue: 9738519
    originated: July 7, 2011
    parent_number: '&{NULL_VALUE}'
    product: Mac OS X
    product_version: 10.6.8
    reproducible: Always
    resolved: ""
    status: Open
    title: FSMoveObjectToTrashSync has mismatched new/delete calls in its bowels
