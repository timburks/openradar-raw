apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "10508829"
    labels:
        datastore_id: "1454403"
data:
    classification: Other Bug
    created: "2011-12-01T04:02:07.323654Z"
    description: "Summary:\r\n\r\nTo save you time, this is a duplicate of bug 9948362. This is a regression bug (introduced in iOS 5.)\r\n\r\nThis bug causes a 1 to 5 second freeze calling AudioQueueStart to do audio recording. From my experiments, I believe it related to changing the AudioSession category between recording->playback->recording. If I record, playback the recording, and do a recording, all subsequent recordings exhibit the delay.  Changing our AudioSession category to PlaybackAndRecord at startup and never changing the category seems to avoid the problem which makes me believe this is related to the changing the audio session category.\r\n\r\nI believe this is a regression bug that was introduced in iOS 5.0. It is still present in 5.1 beta 1. It only appears reliably on some devices though. I reproduced the problem on a 4th gen iPod touch with 5.1 beta 1 and reproduced it on an iPhone 4 with 5.0.1. I also have a pretty reliable tester telling me it happens with iOS 5.0 on a 3GS. I am having problems reproducing it reliably on an iPad 2 running 5.0.1. I have seen it appear twice on an iPad 2, but it is not consistent. But it is always consistent with the iPhone 4 and iPod touch.\r\n\r\n\r\nIt seems that others have also found this problem, e.g.:\r\nhttp://stackoverflow.com/questions/7757739/in-ios-5-after-the-category-changed-audioqueuestart-used-3-5-seconds-to-st\r\n\r\nWe are doing this in the Corona SDK which is used by many developers. I have several developers complaining about this problem. Unfortunately, the workaround of changing the audio session category to PlaybackAndRecord is not something I can put into Corona because it will negatively impact all our users not doing audio recording.\r\n\r\nSo to me, I interpreted Apple's docs to claim that for best performance and best interoperability with other apps that might be running in the background, you should pick the audio session category sparingly to use audio only when you need it. On the performance side, Record vs. PlaybackAndRecord was much better (at least with earlier hardware/os's) because the PlaybackAndRecord couldn't utilize the hardware decoder for playback or recording.\r\n\r\nIf I recall, Apple's own recording example used to change the category between Record(only) and some playback mode when recording a sample and playing it back. Our demo app does something similar. I believe Apple's sample also disabled and enabled the AudioSessionSetActive when needed. Presumably this could allow background apps (iPod) to play until you actually needed the audio service. And we don't set PlaybackAndRecord because of efficiency issues (we still support 3.1 devices) and our demo doesn't need simultaneous playback/record.\r\n\r\n\r\n\r\nSteps to Reproduce:\r\n\r\nSince this bug is a duplicate, I really hope you already have a reproducible test case. My code is closed source and huge so I can't easily submit it. If you need a binary, you can download the Corona SDK and build for iOS using our SimpleAudioRecorder sample project that comes with the download. I would be happy to provide a test account and more detailed instructions. (I can also supply the binary without you needing to get Corona.)\r\n\r\nBut basically, my code does:\r\nSet the audio session category to record.\r\nRecord via Audio Queue Services\r\nStop recording\r\nChange audio session category to playback (soloambient I think)\r\nPlay back the recording (via OpenAL)\r\nStop playback.\r\nRepeat sequence and the delay appears on the start recording for all subsequent repeats.\r\n\r\n\r\nExpected Results:\r\nShould not freeze/delay when starting a recording via AudioQueueStart.\r\n\r\n\r\nActual Results:\r\n1-5 second freeze/delay when starting a recording via AudioQueueStart.\r\n\r\n\r\nRegression:\r\nThis first appeared in 5.0 and is still present in 5.1 beta 1. \r\n\r\nHowever, I recall there was a bug very similar to this in iOS 3.1. I never filed a bug report because 3.2 or 4.0 had already fixed it by the time I discovered it. I believe it affected only the slower devices of that era at the time.\r\n\r\n\r\n\r\nNotes:\r\n\r\nIf you can suggest an alternative workaround, I would appreciate it. Currently, I think I can make my users put a workaround into their own apps which might be sufficient, but they also need to do the iOS 5 version checks until it gets fixed which is hard to support from a Q/A standpoint.\r\n\r\n\r\n\r\nAlso one of my users has filed bug id: 10501739"
    email: ewmailing@gmail.com
    modified: "2011-12-01T04:02:07.324113Z"
    number: "10508829"
    number_intvalue: 10508829
    originated: "2011-11-30"
    parent_number: '&{NULL_VALUE}'
    product: iPhone SDK
    product_version: "5.0"
    reproducible: Always
    resolved: ""
    status: Open
    title: Audio Recording AudioQueueStart freeze/delay (w/changing Audio Session category)
