apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "6511209"
    labels:
        datastore_id: "3209"
data:
    classification: Severe
    created: "2009-01-29T16:35:17.643814Z"
    description: "Originally posted to Bug Reports January 20, 2009\r\n\r\nThe same problem existed in 10.4.?  (From some time ago but was not pursued at that time because \"It will be fixed in Leopard.\"  Obviously it wasn't.)\r\n\r\n20-Jan-2009 02:04 PM Joe Pyrdek:\r\nLaptop systems, using the Active Directory Plug in, freeze and prevent computer use if there is a network connection (Airport or Wired) that does not directly connect to the AD server.  Managed mobile accounts will not revert to cached credentials and local accounts (admin or standard) will not be allowed to login in.  System is only recoverable by using a forced (power button 8-10 seconds) shutdown.  Removing the network connection prior to login attempt or very soon after login starts (unplugging a wired network connection or turning off the wireless router) WILL allow login to continue using cached or local credentials.  Having Airport turned off at power up does allow a normal (cached credentials pr local account) login.  Turning Airport on or plugging in an Ethernet connection after login will allow normal network use.  \r\n\r\nThis problem occurs in MacBookPros running OS 10.5.6 (and probably earlier versions).  I do not have other non-laptop systems available to see if it also occurs in the Mini, IMac or Power Mac series.  A similar problem, never resolved, also occurred in 10.4.x MacBookPros previously.  System is current with all Apple and other updates installed.\r\n\r\nWaiting as long as twenty hours resulted in the frozen computer status remaining frozen the entire time.\r\n\r\nChecking the problem:\r\n\r\nI beleive a \"Green Dot\" does appear in the Directory Utility Directory Servers menu but I will have to confirm this when I try again out of range of the Edinboro Wireless network.\r\n \r\nCheckbox Settings \r\nServices Menu\r\n\"Create mobile account at login\"...Checked\r\n\"Require Confirmation..\"  NOT Checked\r\n\"Use UNC path from AD...\" Checked or Not Checked no change either mode\r\n\"Default user shell\" Checked (/bin/bash)\r\n\r\nMappings Menu\r\nAll Checkboxes NOT checked\r\n\r\nAdministrative Menu\r\n\"Prefer this domain server\" Checked (with AD server IP entered) or NOT checked, No difference\r\nAllow Administration by:  Checked (assorted EUP|accounts that function normally with other systems.)\r\n\"Allow authentication from any domain in forest\" Checked or Not checked  No difference.\r\n\r\n\r\nNormally the system freezes at the log in window but on a few occasions using the same settings as when the freeze happens, login may proceed to start the boot up but even if it proceeds as far as the desktop appearing, the system will either be frozen or will become frozen very soon (a second or two) later.  This later condition only happens once maybe every 50 or 75 login attempts and I have not found a way to make that particular condition repeatable.\r\n\r\nConditions that will cause the problem:\r\n\r\n1.  With computer connected to network (wired), login in as local admin, then  activate AD plugin in Directory Utility.\r\n2.  Bind the computer to the Active Directory.  \r\n3.  When a successful bind has been completed, close the Directory utility and log off.\r\n4.  Login in to the computer using an AD authorized account to create a Managed Mobile user. (Requiring or not requiring the user to authorize creating a home directory does not appear to change the problem.)\r\n5.  Turn airport off, unplug ethernet connection (if used) and Shutdown the computer.\r\n \r\nThe following steps are based on using a wireless signal.  Modify if using a wired ethernet connection.\r\n\r\n6.  Go to a location where the network with the AD domain controller is not available but some other network is available.\r\n7.  Power up and Log in to the computer using the previously created and cached Managed Mobile account.   Turn Airport on and let it discover the new wireless network.  Allow the computer to use the network.\r\n8.  Verify normal network activity is allowed.\r\n9.  LEAVE AIRPORT ON and restart the computer\r\n10. Attempt to login using the Active Directory account. \r\n\r\nNormally  the cached credentials should allow login BUT the computer freezes.  Trying the same procedure using a local admin account also results in a freeze.  Turning the Airport signal off (or going out of range of the wireless signal) will allow login to proceed, possibly with a longer period of time till login happens.\r\n\r\nThis problem first surfaced in OS 10.4 but I was told that 10.5 resolved all the AD issues.  Obviously in my case it did not.\r\n\r\nThe only safe way to log in when not connected to the AD network is to insure that all network connections are severed BEFORE shutting down or going to sleep.\r\n\r\n\r\n23-Jan-2009 10:44 AM Joe Pyrdek:\r\nAfter logging in without having an active network connection, and then connecting a network, there is a \"Green Dot\" and message that the directory server is operating normally.\r\n\r\n2-06-2009\r\nI tried some follow-up.  Here is my report.\r\n\r\nGoing to Terminal and running the DSCL -read/Config/Kerberos/eup.edinboro.edu resulted in\r\n\"Cannot open remote host, error: DS OpenDirServiceErr\"\r\n\r\nI then removed all of the Admin groups, and even unchecked the box for that in the AD plugin panel.\r\n\r\nThen I tried a local admin (Admin) account with airport off.  Operation was normal.  Did a Shutdown and manual Start (not Restart)  (I will abbreviate that to SD in the following text.\r\n\r\nLoged In (abbrv LI) as Admin.  Turned Airport on.  Checked Directory Utility.  Green Dot \"This server is responding normally.  This server is not in your Authentication search policy.\"\r\nAuthentication  window showed\r\n\"/Local/Default\r\n/BSD/Local\r\n/Active Directory/ eup.edinboro.edu\r\n\r\nI then added /Active Directory/Edinboro.edu  as it was the only additional entry in the \"+\" window.\r\n\r\nApple update popped up.  Installed four updates (Cmera Raw, Safari, and I can not recall the other two but neither was an 10.5 upgrade.  System was alredy at 10.5.6 before this entire process started.\r\n\r\nRestart\r\n\r\nAdmin LI FREEZE at login window.  LI was allowed after I killed the wireless router.\r\n\r\nSD\r\n\r\nAdmin LI OK (at least for the first few seconds.  I did not leave it up longer but when you get farther in the report I will report on the results.)\r\n\r\nSD\r\n\r\nAdmin LI normal\r\n\r\nSD\r\n\r\nTried LI with a valid AD username/password (Abbrv JP)(This account was NOT already established as a Managed Mobile account.)  Twelve seconds later the \"head shake\" and a \"Contact your administrator\" note.  This is what I would have expected.  Tried logging in as the Admin.  Beachball freeze.\r\n\r\nSD\r\n\r\nAdmin LI resulted in freeze at login window\r\n\r\nFORCED SD  (Power button 10 seconds)\r\n\r\nSingle User Mode boot and then run Applejack auto restart (to clear caches, repair permissions etc.)\r\n\r\nAutomatic restart\r\nAdmin LI ok and Airport was on.\r\n\r\nSD\r\n\r\nAdmin LI normal but Airport was NOT on.  I did not shut it off but somehow it got turned off.  Turned Airport On.\r\n\r\nSD\r\n\r\nAdmin LI normal  Airport remained on.\r\n\r\nTried LI as JP.  Headshake a few seconds later.\r\n\r\nTried LI as JP again.  Freeze at login window.\r\n\r\nFORCED SD (Power button 10 seconds.)\r\n\r\nLI as Admin.  Operation started normal but a minute or two later partial freeze.  Mouse would move.  Applications would seem to start but then nothing more would happen.\r\n\r\nForced SD\r\n\r\nAdmin LI Started normal but in a minute or two, mouse would move, applications would seem to start when double clicked but never got to open.  Activity Monitor was not able to be opened to see what might be happening.  Airport COULD be turned off.  Turned Airport OFF and a few seconds later the previously unable to open applications started opening (there were a number I tried and all start to open normally).  Activity Monitor now showed no abnormal indications.\r\n\r\nSD\r\n\r\nAdmin LI.  Turned Airport on.  AD showed Green Dot.  then Mouse moved but no applications opened (same as previous try.)  Turned Airport off.  Applications previously tried to open now began opening.\r\n\r\nUNCHECKED Active Directory plug in.  Airport remained on.  System continued to work normally for remainder of test time (approx 20 minutes till I shut the computer off.)\r\n\r\nSD\r\n\r\nAdmin LI normal  (AD remained off but Airport remained on)  operation normal all night (as near as I could tell.  I went to bed and system was still responding normally when I woke up several hours later). \r\n\r\nSD and terminated all testing.\r\n\r\nMy analysis:\r\n\r\nIf no managed mobile account exists, system will try to open it but finding no account stored on computer will \"headshake\" in about ten seconds and revert back to login window after giving notice of failure.  A repeat try will result in freeze at log in window and require a forced shut down to regain computer.\r\n\r\nThe first failed login attempt via AD seems to set some flag or perhaps some overflow (?) that remains cached in the system for at least several hours.  Clearing caches etc. via Applejack seems to remove this blockage.  \r\n\r\n(One failed AD attempt did allow the computer to respond normally to an Admin login approximately 10 hours after the failed attempt.  This was noted but not tested.  During this time the computer was moved several miles and all wireless connections would have been broken.  Relevance of this happening is unknown to me.)\r\n\r\nEven when a local Admin account opens normally it will exhibit a \"semi-frozen\" condition in a few minutes (mouse can move, applications can be clicked on and will dim but not open, airport can be turned off)   until shortly (10-15 seconds?) after airport is turned off.  When airport IS turned off operation returns to normal.\r\n\r\nTurning the AD plugin OFF even with Airport ON, eliminates all freezing at login (at least wih local accounts) and \"semi-frozen\" problems and allows normal operation for at least several hours.\r\n\r\nMy conclusion:\r\n\r\nActive Directory, when turned on, even with only a local admin account being logged in, appears to capture almost all of the computers resources leaving only mouse movement and restricted (Airport OFF) actions, after some short period of operation.  It is almost as if it is trying to \"Phone Home\" (the AD server) but failing to make the connection and locking up either an IRQ or some other resource that effectively shuts down almost all of the computer's operations involving, at the minimum, the GUI.  There are probably more internal operations blocked but I can not tell what they may be.\r\n\r\nMy short term workaround will be to have users create their managed mobile account while plugged in to the campus network and then disable the AD plug in.  This is NOT a permanent fix.\r\n\r\nI will also be entering this report into the Bug Report I filed about this problem.  So far there has been no indication of any action from the bug report people."
    email: pyrdek@edinboro.edu
    modified: "2011-08-28T05:48:24.349041Z"
    number: "6511209"
    number_intvalue: 6511209
    originated: 1-28-2009
    parent_number: '&{NULL_VALUE}'
    product: OS 10.5 (and 10.4)
    product_version: 10.5.6
    reproducible: Yes
    resolved: No
    status: Open
    title: Active Directory - Freeze at Login
