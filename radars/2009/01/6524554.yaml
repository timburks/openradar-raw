apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "6524554"
    labels:
        datastore_id: "2645"
data:
    classification: Other Bug
    created: "2009-01-24T15:30:43.364098Z"
    description: "24-Jan-2009 07:09 AM Andrew Thompson:\r\nSummary:\r\n\r\nCocoa's NSSpeechSynthesizer provides an API to query synthesizer properties. '– objectForProperty:error: '. Unfortunately, 2 of the properties do not seem to work: NSSpeechErrorsProperty and NSSpeechRecentSyncProperty.\r\n\r\nSteps to Reproduce:\r\n\r\nRun the attached Xcode project, or paste and run the sample code below.\r\n\r\nExpected Results:\r\n\r\nThere appear to be multiple error and sync related problems with NSSpeechSynthesizer, as demonstrated by this simple code:\r\n\r\n@implementation DemoSynthProblem\r\n-(IBAction) doIt: (id) sender {\r\n\r\n   NSSpeechSynthesizer *synth = [[NSSpeechSynthesizer alloc] initWithVoice: [NSSpeechSynthesizer defaultVoice]];\r\n   [synth setDelegate: self];\r\n   [synth startSpeakingString: @\"Hello [[sync 0x41]] World [[XXXX]] Again\"];\r\n\r\n   NSError *err;\r\n   NSNumber *syncProp = (NSNumber*) [synth objectForProperty: NSSpeechRecentSyncProperty error: &err];\r\n   NSLog(@\"Recent synch, is of class %@, value %d\", [syncProp class], [syncProp intValue]);\r\n   NSLog(@\"Error? %@\", err);\r\n\r\n   NSDictionary *errorDict = (NSDictionary*) [synth objectForProperty:NSSpeechErrorsProperty error: &err];\r\n   NSLog(@\"Speech Errors: %@\", errorDict);\r\n   NSLog(@\"Error? %@\", err);\r\n\r\n}\r\n\r\n- (void)speechSynthesizer:(NSSpeechSynthesizer *)sender didEncounterErrorAtIndex:(NSUInteger)characterIndex ofString:(NSString *)text message:(NSString *)errorMessage {\r\n   NSLog(@\"In callback got error %@ at index %d\", errorMessage, characterIndex);\r\n\r\n}\r\n\r\n- (void)speechSynthesizer:(NSSpeechSynthesizer *)sender didEncounterSyncMessage:(NSString *)errorMessage {\r\n   NSLog(@\"In callback got synch: %@\", errorMessage);\r\n}\r\n\r\n@end\r\n\r\n1. In - (void)speechSynthesizer:(NSSpeechSynthesizer *)sender didEncounterSyncMessage:(NSString *)errorMessage\r\n\r\n\"errorMessage\" is misnamed - clearly you intend this to be the synch message, as shown by it returning 'A' in the example above for the sync command [[sync 0x41]]\r\n\r\n2. In the same function, didEncounterSyncMessage:(NSString *)errorMessage should surely be (NSNumber *) ?\r\n\r\nThe definition of sync given here (http://developer.apple.com/documentation/UserExperience/Conceptual/SpeechSynthesisProgrammingGuide/FineTuning/chapter_4_section_3.html) is 'sync <32BitValue>'.\r\n\r\nHow is that 32Bit value to be converted to NSString? It is trivial for single byte characters like 0x41 -> 'A' above, but what happens when the number exceeds 1 or 2 bytes? Clearly 4 arbitrary bytes are not necessarily a valid unicode code point (or points) and in any case, what encoding would we assume? UTF-8, UTF-16, UCS-2 or UCS-4? MacRoman?\r\n\r\n3. The documentation of NSSpeechRecentSyncProperty in NSSpeechSynthesizer.h is wrong\r\n\r\nAPPKIT_EXTERN NSString *const NSSpeechRecentSyncProperty AVAILABLE_MAC_OS_X_VERSION_10_5_AND_LATER;  // NSString\r\n\r\nIt actually returns NSCFNumber, as the code above demonstrates (and the property isn't documented at all in the NSSpeechSynthesizer HTML docs).\r\nOf course, this is consistent with point 2. above.\r\n\r\n4. NSSpeechRecentSyncProperty doesn't work... when the code above is run, the following 3 lines are printed:\r\n\r\n2009-01-24 09:09:09.684 SpeechProblemDemo[51239:10b] Recent synch, is of class NSCFNumber, value 0\r\n2009-01-24 09:09:09.704 SpeechProblemDemo[51239:10b] Error? Error Domain=NSOSStatusErrorDomain Code=0 \"Operation could not be completed. (OSStatus error 0.)\" (Call succeeded with no error)\r\n2009-01-24 09:09:10.076 SpeechProblemDemo[51239:10b] In callback got synch: A\r\n\r\nAs you can clearly see, the sync delegate method works - printing 'A' - but the attempt to query the recent sync fails, returning '0'\r\n\r\n5. Similarly NSSpeechErrorsProperty does not work either\r\n\r\n009-01-24 09:09:09.713 SpeechProblemDemo[51239:10b] Speech Errors: {\r\n   Count = 0;\r\n   NewestCharacterOffset = 0;\r\n   NewestCode = 0;\r\n   OldestCharacterOffset = 0;\r\n   OldestCode = 0;\r\n}\r\n2009-01-24 09:09:09.720 SpeechProblemDemo[51239:10b] Error? Error Domain=NSOSStatusErrorDomain Code=0 \"Operation could not be completed. (OSStatus error 0.)\" (Call succeeded with no error)\r\n2009-01-24 09:09:09.738 SpeechProblemDemo[51239:10b] In callback got error Operation could not be completed. (OSStatus error -50.) at index 32\r\n\r\nThe inclusion of a bad speech command [[XXXX]] correctly calls the delegate method to flag the error, but the attempt to query NSSpeechErrorsProperty incorrectly returns no errors.\r\n\r\nIt should be noted the above remains true even if the call '[synth setDelegate: self];' is commented out... so the problem is not the delegate mechanism consuming the data.\r\n\r\nActual Results:\r\n\r\nProperty values are 0 when they should be populated.\r\n\r\nRegression:\r\n\r\nNew features in 10.5.\r\n\r\nNotes:\r\n\r\n\r\n\r\n'SpeechProblemDemo.zip' was successfully uploaded"
    email: lordpixel@mac.com
    modified: "2011-08-28T05:48:21.213557Z"
    number: "6524554"
    number_intvalue: 6524554
    originated: 01/24/2009
    parent_number: '&{NULL_VALUE}'
    product: Mac OS X
    product_version: "10.5"
    reproducible: Always
    resolved: ""
    status: Open
    title: 'NSSpeechSynthesizer some properties for – objectForProperty:error: don''t work'
