apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "7192544"
    labels:
        datastore_id: "72403"
data:
    classification: Serious Bug
    created: "2009-09-02T23:10:43.1458Z"
    description: "The following is quoted from my query on the CocoaDev mailing list.  You can read the thread here:\r\n\r\n<http://www.cocoabuilder.com/archive/message/cocoa/2009/8/29/243835>\r\n\r\nAnd a demo project can be downloaded here:\r\n\r\n<http://www.dejal.com/files/2009/snowycoredatademo.zip>\r\n\r\nOn running this app, it will automatically open a bundled document  \r\nthat demos the exceptions.  You can create a new document to show that  \r\nbasic document creation works fine.  Saving also works.  It's loading  \r\ndocuments that fails (loading documents from previous versions (with  \r\nno model changes) or from this version both fail.\r\n\r\n----\r\n\r\nIn a Core Data-based app that works fine in 10.5.x, I now get an\r\nexception as follows in 10.6 when opening a document.  It targets\r\n10.5, and the same exception occurs when rebuilding on 10.6 (still\r\ntargeting 10.5, but also when targeting 10.6).\r\n\r\nI don't register or unregister any observers myself, and the exception\r\noccurs without touching any of my code.  What's going on?\r\n\r\n\r\nNSRangeException: Cannot remove an observer <NSKeyValueObservance\r\n0x15476c0> for the key path \"richText\" from <TextEntity 0x1546380>\r\nbecause it is not registered as an observer.\r\n      1    +[NSException raise:format:arguments:] (in CoreFoundation)  \r\n+ 136\r\n      2    +[NSException raise:format:] (in CoreFoundation) + 58\r\n      3    -[NSObject(NSKeyValueObserverRegistration)\r\n_removeObserver:forProperty:] (in Foundation) + 765\r\n      4    -[NSObject(NSKeyValueObserverRegistration)\r\nremoveObserver:forKeyPath:] (in Foundation) + 176\r\n      5    -[NSKeyValueNestedProperty\r\nobject:didRemoveObservance:recurse:] (in Foundation) + 544\r\n      6    -[NSObject(NSKeyValueObserverRegistration)\r\n_removeObserver:forProperty:] (in Foundation) + 453\r\n      7    -[NSObject(NSKeyValueObserverRegistration)\r\nremoveObserver:forKeyPath:] (in Foundation) + 176\r\n      8    -[_NSModelObservingTracker\r\n_registerOrUnregister:observerNotificationsForModelObject:] (in\r\nAppKit) + 228\r\n      9    -[_NSModelObservingTracker clearAllModelObjectObserving] (in\r\nAppKit) + 341\r\n    10    -[_NSModelObservingTracker\r\nsetIndexReferenceModelObjectArray:clearAllModelObjectObserving:] (in\r\nAppKit) + 51\r\n    11    -[NSArrayController _setObjects:] (in AppKit) + 196\r\n    12    -[NSArrayController\r\n_arrangeObjectsWithSelectedObjects:avoidsEmptySelection:operationsMask:useBasis\r\n:] (in AppKit) + 510\r\n    13    -[NSArrayController rearrangeObjects] (in AppKit) + 133\r\n    14    -[NSArrayController\r\nobserveValueForKeyPath:ofObject:change:context:] (in AppKit) + 338\r\n    15    NSKeyValueDidChange (in Foundation) + 377\r\n    16    -[NSObject(NSKeyValueObservingPrivate)\r\n_didChangeValuesForKeys:] (in Foundation) + 565\r\n    17    _PFFaultHandlerFulfillFault (in CoreData) + 1921\r\n    18    _PFFaultHandlerLookupRow (in CoreData) + 1573\r\n    19    -[NSFaultHandler fulfillFault:withContext:] (in CoreData) +  \r\n39\r\n    20    _PF_FulfillDeferredFault (in CoreData) + 193\r\n    21    _sharedIMPL_pvfk_core (in CoreData) + 65\r\n    22    -[NSManagedObject(_PFDynamicAccessorsAndPropertySupport)\r\n_genericValueForKey:withIndex:flags:] (in CoreData) + 79\r\n    23    -[NSManagedObject valueForKey:] (in CoreData) + 244\r\n    24    -[NSKeyValueNestedProperty object:didAddObservance:recurse:]\r\n(in Foundation) + 240\r\n    25    -[NSObject(NSKeyValueObserverRegistration)\r\n_addObserver:forProperty:options:context:] (in Foundation) + 812\r\n    26    -[NSObject(NSKeyValueObserverRegistration)\r\naddObserver:forKeyPath:options:context:] (in Foundation) + 565\r\n    27    -[_NSModelObservingTracker\r\n_registerOrUnregister:observerNotificationsForKeyPath:ofModelObject:]\r\n(in AppKit) + 134\r\n    28    -[_NSModelObservingTracker\r\n_registerOrUnregister:observerNotificationsForModelObject:] (in\r\nAppKit) + 228\r\n    29    -[_NSModelObservingTracker _startObservingModelObject:] (in\r\nAppKit) + 418\r\n    30    -[_NSModelObservingTracker\r\nstartObservingModelObjectsAtReferenceIndexes:] (in AppKit) + 333\r\n    31    -[NSArrayController\r\n_arrangeObjectsWithSelectedObjects:avoidsEmptySelection:operationsMask:useBasis\r\n:] (in AppKit) + 510\r\n    32    -[NSArrayController setContent:] (in AppKit) + 889\r\n    33    -[NSArrayController(NSManagedController)\r\n_performFetchWithRequest:merge:error:] (in AppKit) + 501\r\n    34    -[NSObjectController(NSManagedController)\r\nfetchWithRequest:merge:error:] (in AppKit) + 209\r\n    35    -[NSObjectController(NSManagedController)\r\n_executeFetch:didCommitSuccessfully:actionSender:] (in AppKit) + 106\r\n    36    _NSSendCommitEditingSelector (in AppKit) + 339\r\n    37    -[NSController _controllerEditor:didCommit:contextInfo:] (in\r\nAppKit) + 216\r\n    38    __invoking___ (in CoreFoundation) + 29\r\n    39    -[NSInvocation invoke] (in CoreFoundation) + 136\r\n    40    -[NSInvocation invokeWithTarget:] (in CoreFoundation) + 72\r\n    41    __NSFireDelayedPerform (in Foundation) + 537\r\n    42    __CFRunLoopRun (in CoreFoundation) + 6846\r\n\r\n\r\nImmediately after that exception is a related one, which sounds more\r\nhelpful, but still doesn't make sense to me:\r\n\r\nNSInternalInconsistencyException: Cannot remove an observer\r\n<NSArrayController 0x1452df0> for the key path \"text.richText\" from\r\n<ChapterEntity 0x1487b40>, most likely because the value for the key\r\n\"text\" has changed without an appropriate KVO notification being sent.\r\nCheck the KVO-compliance of the ChapterEntity class.\r\n      1    +[NSException raise:format:arguments:] (in CoreFoundation)  \r\n+ 136\r\n      2    +[NSException raise:format:] (in CoreFoundation) + 58\r\n      3    -[NSKeyValueNestedProperty\r\nobject:didRemoveObservance:recurse:] (in Foundation) + 457\r\n      4    -[NSObject(NSKeyValueObserverRegistration)\r\n_removeObserver:forProperty:] (in Foundation) + 453\r\n      5    -[NSObject(NSKeyValueObserverRegistration)\r\nremoveObserver:forKeyPath:] (in Foundation) + 176\r\n      6    -[_NSModelObservingTracker\r\n_registerOrUnregister:observerNotificationsForModelObject:] (in\r\nAppKit) + 228\r\n      7    -[_NSModelObservingTracker clearAllModelObjectObserving] (in\r\nAppKit) + 341\r\n      8    -[_NSModelObservingTracker\r\nsetIndexReferenceModelObjectArray:clearAllModelObjectObserving:] (in\r\nAppKit) + 51\r\n      9    -[NSArrayController _setObjects:] (in AppKit) + 196\r\n    10    -[NSArrayController\r\n_arrangeObjectsWithSelectedObjects:avoidsEmptySelection:operationsMask:useBasis\r\n:] (in AppKit) + 510\r\n    11    -[NSArrayController rearrangeObjects] (in AppKit) + 133\r\n    12    -[NSArrayController\r\nobserveValueForKeyPath:ofObject:change:context:] (in AppKit) + 338\r\n    13    NSKeyValueDidChange (in Foundation) + 377\r\n    14    -[NSObject(NSKeyValueObservingPrivate)\r\n_didChangeValuesForKeys:] (in Foundation) + 565\r\n    15    _PFFaultHandlerFulfillFault (in CoreData) + 1921\r\n    16    _PFFaultHandlerLookupRow (in CoreData) + 1573\r\n    17    -[NSFaultHandler fulfillFault:withContext:] (in CoreData) +  \r\n39\r\n    18    _PF_FulfillDeferredFault (in CoreData) + 193\r\n    19    _sharedIMPL_pvfk_core (in CoreData) + 65\r\n    20    -[NSManagedObject(_PFDynamicAccessorsAndPropertySupport)\r\n_genericValueForKey:withIndex:flags:] (in CoreData) + 79\r\n    21    -[NSManagedObject valueForKey:] (in CoreData) + 244\r\n    22    -[NSKeyValueNestedProperty object:didAddObservance:recurse:]\r\n(in Foundation) + 240\r\n    23    -[NSObject(NSKeyValueObserverRegistration)\r\n_addObserver:forProperty:options:context:] (in Foundation) + 812\r\n    24    -[NSObject(NSKeyValueObserverRegistration)\r\naddObserver:forKeyPath:options:context:] (in Foundation) + 565\r\n    25    -[_NSModelObservingTracker\r\n_registerOrUnregister:observerNotificationsForKeyPath:ofModelObject:]\r\n(in AppKit) + 134\r\n    26    -[_NSModelObservingTracker\r\n_registerOrUnregister:observerNotificationsForModelObject:] (in\r\nAppKit) + 228\r\n    27    -[_NSModelObservingTracker _startObservingModelObject:] (in\r\nAppKit) + 418\r\n    28    -[_NSModelObservingTracker\r\nstartObservingModelObjectsAtReferenceIndexes:] (in AppKit) + 333\r\n    29    -[NSArrayController\r\n_arrangeObjectsWithSelectedObjects:avoidsEmptySelection:operationsMask:useBasis\r\n:] (in AppKit) + 510\r\n    30    -[NSArrayController setContent:] (in AppKit) + 889\r\n    31    -[NSArrayController(NSManagedController)\r\n_performFetchWithRequest:merge:error:] (in AppKit) + 501\r\n    32    -[NSObjectController(NSManagedController)\r\nfetchWithRequest:merge:error:] (in AppKit) + 209\r\n    33    -[NSObjectController(NSManagedController)\r\n_executeFetch:didCommitSuccessfully:actionSender:] (in AppKit) + 106\r\n    34    _NSSendCommitEditingSelector (in AppKit) + 339\r\n    35    -[NSController _controllerEditor:didCommit:contextInfo:] (in\r\nAppKit) + 216\r\n    36    __invoking___ (in CoreFoundation) + 29\r\n    37    -[NSInvocation invoke] (in CoreFoundation) + 136\r\n    38    -[NSInvocation invokeWithTarget:] (in CoreFoundation) + 72\r\n    39    __NSFireDelayedPerform (in Foundation) + 537\r\n    40    __CFRunLoopRun (in CoreFoundation) + 6846\r\n    41    CFRunLoopRunSpecific (in CoreFoundation) + 452\r\n    42    CFRunLoopRunInMode (in CoreFoundation) + 97\r\n    43    RunCurrentEventLoopInMode (in HIToolbox) + 392\r\n    44    ReceiveNextEventCommon (in HIToolbox) + 354\r\n    45    BlockUntilNextEventMatchingListInMode (in HIToolbox) + 81\r\n    46    _DPSNextEvent (in AppKit) + 847\r\n    47    -[NSApplication\r\nnextEventMatchingMask:untilDate:inMode:dequeue:] (in AppKit) + 156\r\n    48    -[NSApplication run] (in AppKit) + 821\r\n    49    NSApplicationMain (in AppKit) + 574\r\n    50    main (in Narrator) (main.m:14)\r\n\r\n\r\nChapterEntity is:\r\n\r\n@interface ChapterEntity : NSManagedObject\r\n{\r\n}\r\n\r\n@property(copy) NSString *name;\r\n@property(copy) NSImage *tableImage;\r\n@property(assign) TextEntity *text;\r\n@property(assign) DocumentEntity *document;\r\n\r\n@end\r\n\r\n\r\n@implementation ChapterEntity\r\n\r\n@dynamic name, tableImage, text, document;\r\n\r\n- (void)awakeFromInsert;\r\n{\r\n    [super awakeFromInsert];\r\n\r\n    NSManagedObjectContext *managedObjectContext = [self\r\nmanagedObjectContext];\r\n\r\n    self.tableImage = [NSImage imageNamed:@\"GenericDocument\"];\r\n    self.text = [NSEntityDescription\r\ninsertNewObjectForEntityForName:@\"Text\"\r\ninManagedObjectContext:managedObjectContext];\r\n}\r\n\r\n@end\r\n\r\n\r\nBut the exception occurs even if I comment out the contents of -\r\nawakeFromInsert.\r\n\r\nAnd TextEntity has just dynamic properties, no code."
    email: DejalSystems@gmail.com
    modified: "2011-08-28T05:44:59.391845Z"
    number: "7192544"
    number_intvalue: 7192544
    originated: "2009-09-02"
    parent_number: '&{NULL_VALUE}'
    product: Mac OS X
    product_version: 10.6 / 10A432
    reproducible: Always
    resolved: ""
    status: Open
    title: Core Data observer exception in 10.6
