apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "7396501"
    labels:
        datastore_id: "113419"
data:
    classification: Security
    created: "2009-11-16T10:50:34.651976Z"
    description: "16-Nov-2009 01:47 PM Alexander Potapenko:\r\nThreadSanitizer, an open Valgrind-based data race detection tool reports possible data races in Google Chromium test suite. Those errors are caused by either flaws in the NSObject implementation or some means of synchronisation (e.g. atomics) that are not intercepted correctly by the tool.\r\n\r\nTo reproduce the warnings:\r\n1. Download and compile Google Chromium tests: http://code.google.com/p/chromium/wiki/MacBuildInstructions\r\n2. Download and install ThreadSanitizer for Mac OS X: http://code.google.com/p/data-race-test/wiki/ThreadSanitizer\r\n3. Run '<path-to-chromium>/src/tools/valgrind/chrome_tests_sh --tool=tsan -t unit'.\r\n\r\nExpected result: no \"__NSAutorelease\" warnings should appear in the report.\r\n\r\nActual result: ThreadSanitizer's report contains the following warnings:\r\n\r\n==90178== WARNING: Possible data race during read of size 4 at 0x26E2694C: {{{\r\n==90178==    T2 (locks held: {}):\r\n==90178==     #0  0x26B9F572: __NSAutoreleaseObject /System/Library/Frameworks/Foundation.framework/Versions/C/Foundation\r\n==90178==     #1  0x26B9F43D: -[NSObject(NSObject) autorelease] /System/Library/Frameworks/Foundation.framework/Versions/C/Foundation\r\n==90178==     #2  0xCA4D22: mac_util::SetFileBackupExclusion(FilePath const&, bool) /Users/glider/buildbot-slave/buildbot-tsan-unit/buildbot_new/slave/chromium-dbg-mac-unit-tsan/build/src/base/mac_util.mm:242\r\n==90178==     #3  0x65A6BA: history::ThumbnailDatabase::Init(FilePath const&, history::HistoryPublisher const*) /Users/glider/buildbot-slave/buildbot-tsan-unit/buildbot_new/slave/chromium-dbg-mac-unit-tsan/build/src/chrome/browser/history/thumbnail_database.cc:71\r\n==90178==     #4  0x633940: history::HistoryBackend::InitImpl() /Users/glider/buildbot-slave/buildbot-tsan-unit/buildbot_new/slave/chromium-dbg-mac-unit-tsan/build/src/chrome/browser/history/history_backend.cc:558\r\n==90178==     #5  0x633D39: history::HistoryBackend::Init(bool) /Users/glider/buildbot-slave/buildbot-tsan-unit/buildbot_new/slave/chromium-dbg-mac-unit-tsan/build/src/chrome/browser/history/history_backend.cc:221\r\n==90178==     #6  0x622D6A: void DispatchToMethod<history::HistoryBackend, void (history::HistoryBackend::*)(bool), bool>(history::HistoryBackend*, void (history::HistoryBackend::*)(bool), Tuple1<bool> const&) tuple.h:422\r\n==90178==     #7  0x622D9A: RunnableMethod<history::HistoryBackend, void (history::HistoryBackend::*)(bool), Tuple1<bool> >::Run() task.h:277\r\n==90178==     #8  0xCA6F2D: MessageLoop::RunTask(Task*) /Users/glider/buildbot-slave/buildbot-tsan-unit/buildbot_new/slave/chromium-dbg-mac-unit-tsan/build/src/base/message_loop.cc:320\r\n==90178==     #9  0xCA74D6: MessageLoop::DeferOrRunPendingTask(MessageLoop::PendingTask const&) /Users/glider/buildbot-slave/buildbot-tsan-unit/buildbot_new/slave/chromium-dbg-mac-unit-tsan/build/src/base/message_loop.cc:328\r\n==90178==     #10 0xCA7707: MessageLoop::DoWork() /Users/glider/buildbot-slave/buildbot-tsan-unit/buildbot_new/slave/chromium-dbg-mac-unit-tsan/build/src/base/message_loop.cc:435\r\n==90178==     #11 0xCABB7D: base::MessagePumpDefault::Run(base::MessagePump::Delegate*) /Users/glider/buildbot-slave/buildbot-tsan-unit/buildbot_new/slave/chromium-dbg-mac-unit-tsan/build/src/base/message_pump_default.cc:23\r\n==90178==     #12 0xCA7BBE: MessageLoop::RunInternal() /Users/glider/buildbot-slave/buildbot-tsan-unit/buildbot_new/slave/chromium-dbg-mac-unit-tsan/build/src/base/message_loop.cc:205\r\n==90178==     #13 0xCA7BD8: MessageLoop::RunHandler() /Users/glider/buildbot-slave/buildbot-tsan-unit/buildbot_new/slave/chromium-dbg-mac-unit-tsan/build/src/base/message_loop.cc:177\r\n\r\n==90178==     #14 0xCA7C41: MessageLoop::Run() /Users/glider/buildbot-slave/buildbot-tsan-unit/buildbot_new/slave/chromium-dbg-mac-unit-tsan/build/src/base/message_loop.cc:155\r\n==90178==     #15 0x622046: (anonymous namespace)::ChromeHistoryThread::Run(MessageLoop*) /Users/glider/buildbot-slave/buildbot-tsan-unit/buildbot_new/slave/chromium-dbg-mac-unit-tsan/build/src/chrome/browser/history/history.cc:79\r\n==90178==     #16 0xCD1405: base::Thread::ThreadMain() /Users/glider/buildbot-slave/buildbot-tsan-unit/buildbot_new/slave/chromium-dbg-mac-unit-tsan/build/src/base/thread.cc:153\r\n==90178==     #17 0xCB46D4: ThreadFunc(void*) /Users/glider/buildbot-slave/buildbot-tsan-unit/buildbot_new/slave/chromium-dbg-mac-unit-tsan/build/src/base/platform_thread_posix.cc:26\r\n==90178==     #18 0x2570207D: ThreadSanitizerStartThread /Users/glider/src/tsan-chromium/valgrind-current/tsan/ts_valgrind_intercepts.c:504\r\n==90178==   Concurrent write(s) happened at (OR AFTER) these points:\r\n==90178==    T0 (locks held: {}):\r\n==90178==     #0  0x26B9F55D: __NSAutoreleaseObject /System/Library/Frameworks/Foundation.framework/Versions/C/Foundation\r\n==90178==     #1  0x26B9F43D: -[NSObject(NSObject) autorelease] /System/Library/Frameworks/Foundation.framework/Versions/C/Foundation\r\n==90178==     #2  0x26A5A279: +[NSDictionary dictionaryWithObjectsAndKeys:] /System/Library/Frameworks/CoreFoundation.framework/Versions/A/CoreFoundation\r\n==90178==     #3  0x25C2F8C8: +[NSApplication _initializeRegisteredDefaults] /System/Library/Frameworks/AppKit.framework/Versions/C/AppKit\r\n==90178==     #4  0x25C2F321: +[NSApplication initialize] /System/Library/Frameworks/AppKit.framework/Versions/C/AppKit\r\n==90178==     #5  0x279018B3: _class_initialize /usr/lib/libobjc.A.dylib\r\n==90178==     #6  0x27901787: _class_initialize /usr/lib/libobjc.A.dylib\r\n==90178==     #7  0x27900234: _class_lookupMethodAndLoadCache /usr/lib/libobjc.A.dylib\r\n==90178==     #8  0x279106D1: objc_msgSend /usr/lib/libobjc.A.dylib\r\n==90178==     #9  0xCAD1DC: base::MessagePumpNSApplication::DoRun(base::MessagePump::Delegate*) /Users/glider/buildbot-slave/buildbot-tsan-unit/buildbot_new/slave/chromium-dbg-mac-unit-tsan/build/src/base/message_pump_mac.mm:672\r\n==90178== }}}"
    email: ramosian.glider@gmail.com
    modified: "2011-08-28T05:43:32.576323Z"
    number: "7396501"
    number_intvalue: 7396501
    originated: 16-Nov-2009 01:47 PM
    parent_number: '&{NULL_VALUE}'
    product: Mac OS X
    product_version: 'Darwin Kernel Version 9.7.0: Tue Mar 31 22:52:17 PDT 2009; root:xnu-1228.12.14~1/RELEASE_I386 i386'
    reproducible: Always
    resolved: ""
    status: Behaves correctly
    title: Possible threading errors in __NSAutoreleaseObject
