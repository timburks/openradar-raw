apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "7437355"
    labels:
        datastore_id: "123402"
data:
    classification: Serious Bug
    created: "2009-12-02T19:53:57.685642Z"
    description: "Summary: \r\nPeriodically, the AirPortBrcm43xx (AirPortDriverBrcm4311-411.91.20) Airport driver on my Macbook Pro (MacBookPro4,1) enters a state where it can receive data (e.g., DHCP requests, MDNS broadcasts, ping requests), but can't send data (e.g. DHCP replies, ping requests and replies).\r\n\r\nThis often (but not always - see notes) co-incides with an assertion error:\r\n\r\nAssertion failed: file \"/SourceCache/AirPortDriverBrcm4311/AirPortDriverBrcm4311-411.91.20/src/wl/sys/wl_macosx.cpp\", line 9407: mboolisset(pciw->txFlowControl, NBITVAL(prio))\r\n\r\nSteps to Reproduce:\r\nUnknown\r\n\r\nExpected Results:\r\nNormal operation\r\n\r\nActual Results:\r\nInterface unable to transmit data - transmission seems to silently fail\r\n\r\nRegression:\r\nUnknown\r\n\r\nNotes:\r\n\r\nProblem discovered while diagnosing 'self-assigned IP' DHCP failures while using Internet Sharing over Airport.\r\n\r\nUsing a tool like tcpdump, I can observe incoming DHCP requests, and observe the outgoing replies, but monitoring the other computer, it is apparent the replies never reach the destination.  By pinging the broadcast address from the problematic Macbook Pro, no requests are received at the peer.  The other way around, the Macbook Pro receives ping requests from the peer, but the ping replies are never received by the peer.\r\n\r\nI have not been able to identify any common circumstances where this occurs: It has happened while sharing an Internet connection over Airport to a Macbook, and it has happened the other way around, while connected to the Macbook which is sharing the Internet connection.  The OS X firewall has no effect.\r\n\r\nSome of the time (but not all of the time: see below), when the driver enters this problematic state, the following assertion failure appears in the console:\r\n\r\n01/12/2009 17:22:15\tkernel\tAssertion failed: file \"/SourceCache/AirPortDriverBrcm4311/AirPortDriverBrcm4311-411.91.20/src/wl/sys/wl_macosx.cpp\", line 9407: mboolisset(pciw->txFlowControl, NBITVAL(prio))\r\n\r\nRebooting restores the Airport device to normal status. So does unloading and reloading the com.apple.driver.AirPortBrcm43xx kernel extension.\r\n\r\nWhen unloading com.apple.driver.AirPortBrcm43xx (/System/Library/Extensions/IO80211Family.kext/Contents/PlugIns/AppleAirPortBrcm4311.kext), kextunload reports:\r\n\r\n(kernel) Can't unload kext com.apple.driver.AirPortBrcm43xx; classes have instances:\r\n(kernel)     Kext com.apple.driver.AirPortBrcm43xx class AirPort_Brcm43xxInterface has 1 instance.\r\n(kernel)     Kext com.apple.driver.AirPortBrcm43xx class AirPort_Brcm43xx has 1 instance.\r\nFailed to unload com.apple.driver.AirPortBrcm43xx - (libkern/kext) kext is in use or retained (cannot unload).\r\n\r\nAnd the following appears in the console:\r\n\r\n01/12/2009 17:56:31\tkernel\tAssertion failed: file \"/SourceCache/AirPortDriverBrcm4311/AirPortDriverBrcm4311-411.91.20/src/wl/sys/wl_macosx.cpp\", line 2465: 0\r\n\r\nAnd sometimes:\r\n\r\n02/12/2009 19:56:18\tkernel\tAirPort_Brcm43xx::terminate(kIOServiceSynchronous) timeout\r\n02/12/2009 19:56:18\tkernel\tCan't unload kext com.apple.driver.AirPortBrcm43xx; classes have instances:\r\n\r\n\r\nHowever, afterwards, the Airport device disappears successfully. \r\n\r\n\r\nOnce when this problem occurred, while running Internet Sharing over Airport, no related messages appeared in console, and the same symptoms presented themselves (i.e. inability to transmit data, but able to receive data).  This time, the airport menu extra was unresponsive and reported the following in console when clicked:\r\n\r\n02/12/2009 18:55:40\tSystemUIServer[155]\t*** Assertion failure in -[NSMenuItem setTitle:], /SourceCache/AppKit/AppKit-1038.25/Menus.subproj/NSMenuItem.m:799\r\n02/12/2009 18:55:40\tSystemUIServer[155]\tThe Menu Extra <AirPortExtra: 0x1004a7530> threw an exception 'NSInternalInconsistencyException', 'Invalid parameter not satisfying: aString != nil'\r\n\r\nTurning off Internet Sharing and turning it back on was sufficient to regain correct operation, including correct airport menu behaviour.\r\n\r\nSystem profile is attached (taken while network device operating correctly, and connected to another computer sharing an Internet connection over Airport)."
    email: michael@tyson.id.au
    modified: "2011-08-28T05:43:19.710905Z"
    number: "7437355"
    number_intvalue: 7437355
    originated: 02-Dec-2009 08:50 PM
    parent_number: '&{NULL_VALUE}'
    product: Mac OS X
    product_version: 10.6.2
    reproducible: Sometimes
    resolved: Fixed
    status: Open
    title: AirPortBrcm43xx Airport driver periodically cannot send data, requires restart
