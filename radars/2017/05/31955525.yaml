apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "31955525"
    labels:
        datastore_id: "5014360980193280"
data:
    classification: ""
    created: "2017-05-03T03:07:09.95793Z"
    description: "Area:\r\nWebKit\r\n\r\nSummary:\r\nWhen UIWebView is executing some JavaScript it can run in a dead lock on the main thread, causing the whole application to hang. In the real world this is caused by some CPU intensive JavaScript. In the attached example project a simple while (true) { ... } loop in JavaScript is used to demonstrate the issue.\r\n\r\nSteps to Reproduce:\r\n1. Open attached project in Xcode 8.3.2\r\n2. Run it on iPhone 7 10.3 Simulator\r\n3. Tap on the \"Open WebView\" button\r\n4. Wait 10 seconds\r\n5. Tap on the back button\r\n6. Wait 10 seconds\r\n7. Tap again on the \"Open WebView\" button\r\n\r\nExpected Results:\r\nOpen the WebView a second time.\r\n\r\nActual Results:\r\nIt does not open the WebView a second time. Instead the application hangs and is unresponsive.\r\n\r\nYou can pause the application at this point and get a stack trace of the main thread:\r\n\r\n* thread #1, queue = 'com.apple.main-thread', stop reason = signal SIGSTOP\r\n  * frame #0: 0x0000000107ba0c22 libsystem_kernel.dylib`__psynch_mutexwait + 10\r\n    frame #1: 0x0000000107bd5e6e libsystem_pthread.dylib`_pthread_mutex_lock_wait + 100\r\n    frame #2: 0x0000000107bd358d libsystem_pthread.dylib`_pthread_mutex_lock_slow + 285\r\n    frame #3: 0x000000010af466d2 WebCore`_WebTryThreadLock(bool) + 34\r\n    frame #4: 0x000000010af47508 WebCore`WebThreadLock + 88\r\n    frame #5: 0x00000001043fb58a UIKit`-[UIWebDocumentView viewportHandler:didChangeViewportSize:] + 56\r\n    frame #6: 0x000000010444c083 UIKit`-[_UIWebViewportHandler update:] + 394\r\n    frame #7: 0x00000001043fd991 UIKit`-[UIWebDocumentView setMinimumSize:updateCurrentViewportConfigurationSize:] + 105\r\n    frame #8: 0x0000000104446133 UIKit`-[UIWebView _updateViewSettings] + 723\r\n    frame #9: 0x0000000104445a9b UIKit`-[_UIWebViewScrollView setContentInset:] + 241\r\n    frame #10: 0x000000010425c644 UIKit`-[UIViewController _setNavigationControllerContentInsetAdjustment:] + 573\r\n    frame #11: 0x00000001042a1450 UIKit`-[UINavigationController navigationTransitionView:didEndTransition:fromView:toView:] + 804\r\n    frame #12: 0x0000000104296f84 UIKit`__49-[UINavigationController _startCustomTransition:]_block_invoke + 246\r\n    frame #13: 0x0000000104bf1dac UIKit`-[_UIViewControllerTransitionContext completeTransition:] + 102\r\n    frame #14: 0x00000001040ab360 UIKit`__53-[_UINavigationParallaxTransition animateTransition:]_block_invoke.99 + 803\r\n    frame #15: 0x000000010417bcd4 UIKit`-[UIViewAnimationBlockDelegate _didEndBlockAnimation:finished:context:] + 527\r\n    frame #16: 0x000000010414ef07 UIKit`-[UIViewAnimationState sendDelegateAnimationDidStop:finished:] + 222\r\n    frame #17: 0x000000010414f446 UIKit`-[UIViewAnimationState animationDidStop:finished:] + 136\r\n    frame #18: 0x00000001096af68e QuartzCore`CA::Layer::run_animation_callbacks(void*) + 306\r\n    frame #19: 0x000000010784305c libdispatch.dylib`_dispatch_client_callout + 8\r\n    frame #20: 0x000000010782440b libdispatch.dylib`_dispatch_main_queue_callback_4CF + 411\r\n    frame #21: 0x00000001069a0909 CoreFoundation`__CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__ + 9\r\n    frame #22: 0x0000000106966ae4 CoreFoundation`__CFRunLoopRun + 2164\r\n    frame #23: 0x0000000106966016 CoreFoundation`CFRunLoopRunSpecific + 406\r\n    frame #24: 0x00000001087f5a24 GraphicsServices`GSEventRunModal + 62\r\n    frame #25: 0x00000001040c30d4 UIKit`UIApplicationMain + 159\r\n    frame #26: 0x000000010361e1a7 WebThreadDeadLock`main at AppDelegate.swift:12\r\n    frame #27: 0x000000010788f65d libdyld.dylib`start + 1\r\n    frame #28: 0x000000010788f65d libdyld.dylib`start + 1\r\n\r\nVersion:\r\nXcode 8.3.2, Mac OS 10.12.4\r\n\r\nNotes:\r\n\r\n\r\nConfiguration:\r\niPhone 7 Simulator, iOS 10.3\r\n\r\nAttachments:\r\n'WebThreadDeadLock-master.zip' was successfully uploaded.\r\n(see here: https://github.com/technology-ebay-de/WebThreadDeadLock)"
    email: plu@pqpq.de
    modified: "2017-05-03T03:07:49.07557Z"
    number: "31955525"
    number_intvalue: 31955525
    originated: "2017-05-03"
    parent_number: '&{NULL_VALUE}'
    product: WebKit on iOS
    product_version: iOS 10.3
    reproducible: Always
    resolved: ""
    status: Open
    title: Dead lock in WebCore/WebThreadLock
