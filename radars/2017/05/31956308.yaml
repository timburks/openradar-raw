apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "31956308"
    labels:
        datastore_id: "6160430053457920"
data:
    classification: Enhancement
    created: "2017-05-03T04:19:57.94857Z"
    description: "Area:\r\nUserNotifications Framework\r\n\r\nSummary:\r\nThis is a long one, so I apologize in advance and thank you for your time. I'm happy to answer any questions that might be useful.\r\n\r\nI have two apps which send alerts based on sunrise and sunset. To trigger at the correct time, I can't use any repeating trigger, since none account for sunrise or sunset. \r\n\r\nOne app runs notifications for a specific 7 weeks, scheduling two notifications for those 49 days. Another runs a set of reminders based on sunrise and sunset every day of the year.\r\n\r\nTo work around this, I need to calculate the correct time and use a calendar trigger, scheduling one notification per day. Then, I can schedule as many notifications as iOS allows, which is a pithy 64.\r\n\r\nFor example, if I want to schedule a notification every day, one hour after sunrise, where an hour is a fixed length of 60 minutes, there's no way to do it with a single notification request. So, I schedule one for sunrise tomorrow, and one for the day after and so on.\r\n\r\nAs time goes on, those notifications begin to fire, and eventually, all 64 will be delivered and my user will stop receiving notifications.\r\n\r\nTo continue receiving notifications, my user needs to open up the app at least once in the 64 days to reschedule notifications further out into the future.\r\n\r\nThis is sort of okay, because users that care about my app will hopefully open it at least once every 2 months, but with ï£¿ Watch, and Today Widgets, and my notifications, users are less likely to do so. \r\n\r\nAlso, if my user wants two notifications, such as one an hour after sunrise and one an hour before sunset, I now need to use TWO requests per day. Now my user needs to open up the app once a month, instead of once every other month.\r\n\r\nIn my case, there are at least half a dozen different notifications that my user can enable, so they need to open the app weekly for this to work.\r\n\r\nEssentially, it gets increasingly difficult and increasingly complicated to schedule notifications that trigger not just on time or region, but on a combination of both.\r\n\r\nOne of three things would improve this situation for me:\r\n1. Remove the 64 request cap, so I can keep on calculating notifications out into the future.\r\n2. Allow me to write a custom notification trigger\r\n3. Add a SunriseSunsetOffset trigger to the framework.\r\n\r\nSteps to Reproduce:\r\nCase 1:\r\n- Schedule notifications at sunset every day for a year by running a loop that calculates sunset and passes that to a UNCalendarTrigger. (See the attached code for an example.)\r\n- Fetch the pending requests\r\n- Count them\r\n\r\nCase 2:\r\n- Attempt to subclass UNNotificationTrigger and vend your own fire date and repeat rules based on sunrise or sunset.\r\n\r\nCase 3: \r\n- Attempt to use a sunrise based calendar trigger.\r\n\r\nExpected Results:\r\nCase 1:\r\n- All pending requests should be scheduled\r\n\r\nCase 2:\r\n- Notifications scheduled with a custom trigger should call the callback block.\r\n\r\nCase 3:\r\n- A sunrise/sunset trigger should exist.\r\n\r\nActual Results:\r\nCase 1:\r\n- Observe that only the most recent 64 requests are pending (at the end of the year, so the user will be unlikely to ever see them.)\r\n\r\nCase 2: \r\n- There's no way to do this as of iOS 10.3. UserNotificationCenter.current().add(_, withCompletionHandler:) doesn't call the completion block with an error. It silently fails.\r\n\r\nCase 3: \r\n- There's no such trigger.\r\n\r\n\r\nVersion:\r\niOS 10.3 \r\n\r\nNotes:\r\nIn the attached file ReminderManager.swift, there's a method called scheduleRemindersInALoop() which schedules a fixed reminder, and a badging-only reminder for sunset every day. In this case I want the badging to happen every day for 49 days. That, coupled with a fixed reminder for those same 49 days, means that I have a total of 98 reminders that can't be repeated on a repeating trigger.\r\n\r\nAlarm Manager.zip is equivalent UILocalNotification code, illustrating the same challenge in the case of N daily sun-based notifications. I understand that it's using the older API but I think it's useful context to have.\r\n\r\nIf you're still reading, I really appreciate your time, and I'm happy to answer any questions you have. \r\n\r\nMoshe Berman,\r\n---.---.----\r\n(----- Time Zone, best to talk after 4PM Pacific)\r\n\r\nConfiguration:\r\niPhone 6s, Verizon\r\n\r\nAttachments:\r\n'Alarm Manager.zip' and 'ReminderManager.swift' were successfully uploaded."
    email: moshefromsinai@gmail.com
    modified: "2017-05-03T04:19:57.94884Z"
    number: "31956308"
    number_intvalue: 31956308
    originated: 5/3/2017
    parent_number: '&{NULL_VALUE}'
    product: iOS + SDK
    product_version: "10.3"
    reproducible: Always
    resolved: ""
    status: Open
    title: Allow Custom (Sunrise/Sunset) Notification Triggers or remove 64 notification cap
