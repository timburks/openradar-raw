apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "32508213"
    labels:
        datastore_id: "4983982273855488"
data:
    classification: Crash
    created: "2017-06-01T10:20:36.3165Z"
    description: "Summary:\r\nWhen attempting to undo a paste operation on a UITextField that implements the '- (BOOL)textField:(UITextField *)textField shouldChangeCharactersInRange:(NSRange)range replacementString:(NSString *)string' delegate method which returned 'NO' the app will crash:\r\n\r\n *** Terminating app due to uncaught exception 'NSRangeException', reason: '*** -[NSBigMutableString substringWithRange:]: Range {0, 568} out of bounds; string length 0'\r\n\r\nSteps to Reproduce:\r\n1. Implement an app with a UITextField\r\n2. Implement the UITextFieldDelegate protocol and assign the UITextField delegate\r\n3. Implement the '- (BOOL)textField:(UITextField *)textField shouldChangeCharactersInRange:(NSRange)range replacementString:(NSString *)string' method\r\n4. Return NO from that method\r\n5. Run app and attempt to paste text into the UITextField and observe that no text is actually pasted\r\n6. Shake the phone to trigger the Undo prompt\r\n7. Tap the Undo button in the prompt and observe crash\r\n\r\nExpected Results:\r\nThe app should not crash. \r\n\r\nActual Results:\r\nThe app crashes due to iOS recording the unsuccessful paste operation as something that can be undone.\r\n\r\nRegression:\r\nAlways occours\r\n\r\nNotes:\r\n\r\nFull crash report:\r\n\r\n *** Terminating app due to uncaught exception 'NSRangeException', reason: '*** -[NSBigMutableString substringWithRange:]: Range {0, 568} out of bounds; string length 0'\r\n*** First throw call stack:\r\n(\r\n\t0   CoreFoundation                      0x000000010abfbb0b __exceptionPreprocess + 171\r\n\t1   libobjc.A.dylib                     0x000000010a33e141 objc_exception_throw + 48\r\n\t2   CoreFoundation                      0x000000010ac64625 +[NSException raise:format:] + 197\r\n\t3   Foundation                          0x0000000109e19a61 -[NSString substringWithRange:] + 131\r\n\t4   UIKit                               0x000000010c85baf8 -[NSTextStorage(UIKitUndoExtensions) _undoRedoAttributedSubstringFromRange:] + 136\r\n\t5   UIKit                               0x000000010c85bf4a -[_UITextUndoOperationReplace undoRedo] + 306\r\n\t6   Foundation                          0x0000000109ed0463 -[_NSUndoStack popAndInvoke] + 280\r\n\t7   Foundation                          0x0000000109ed01f2 -[NSUndoManager undoNestedGroup] + 433\r\n\t8   UIKit                               0x000000010bc7a138 -[UIApplication alertView:clickedButtonAtIndex:] + 151\r\n\t9   UIKit                               0x000000010bfe98fc -[UIAlertView _prepareToDismissForTappedIndex:] + 134\r\n\t10  UIKit                               0x000000010bfe933e __35-[UIAlertView _prepareAlertActions]_block_invoke.50 + 53\r\n\t11  UIKit                               0x000000010bfd2404 -[UIAlertController _dismissAnimated:triggeringAction:triggeredByPopoverDimmingView:] + 1080\r\n\t12  UIKit                               0x000000010c75ceca -[_UIAlertControllerView interfaceAction:invokeActionHandler:completion:] + 337\r\n\t13  UIKit                               0x000000010c82f398 -[UIInterfaceActionGroupView interfaceAction:invokeActionHandler:completion:] + 105\r\n\t14  UIKit                               0x000000010c54aa23 -[UIInterfaceAction _invokeHandlerWithCompletionBlock:] + 163\r\n\t15  UIKit                               0x000000010c316d4f -[UIInterfaceActionSelectionTrackingController _handleActionSelectionGestureRecognizer:] + 784\r\n\t16  UIKit                               0x000000010c19dc09 -[UIGestureRecognizerTarget _sendActionWithGestureRecognizer:] + 57\r\n\t17  UIKit                               0x000000010c1a5a07 _UIGestureRecognizerSendTargetActions + 109\r\n\t18  UIKit                               0x000000010c1a33bb _UIGestureRecognizerSendActions + 225\r\n\t19  UIKit                               0x000000010c1a267e -[UIGestureRecognizer _updateGestureWithEvent:buttonEvent:] + 981\r\n\t20  UIKit                               0x000000010c18ee02 _UIGestureEnvironmentUpdate + 1219\r\n\t21  UIKit                               0x000000010c18e8f3 -[UIGestureEnvironment _deliverEvent:toGestureRecognizers:usingBlock:] + 484\r\n\t22  UIKit                               0x000000010c18daba -[UIGestureEnvironment _updateGesturesForEvent:window:] + 274\r\n\t23  UIKit                               0x000000010bcd9b9a -[UIWindow sendEvent:] + 4092\r\n\t24  UIKit                               0x000000010bc867b0 -[UIApplication sendEvent:] + 352\r\n\t25  UIKit                               0x000000010c469adc __dispatchPreprocessedEventFromEventQueue + 2926\r\n\t26  UIKit                               0x000000010c461a3a __handleEventQueue + 1122\r\n\t27  CoreFoundation                      0x000000010aba1c01 __CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__ + 17\r\n\t28  CoreFoundation                      0x000000010ab870cf __CFRunLoopDoSources0 + 527\r\n\t29  CoreFoundation                      0x000000010ab865ff __CFRunLoopRun + 911\r\n\t30  CoreFoundation                      0x000000010ab86016 CFRunLoopRunSpecific + 406\r\n\t31  GraphicsServices                    0x000000010fd84a24 GSEventRunModal + 62\r\n\t32  UIKit                               0x000000010bc690d4 UIApplicationMain + 159\r\n\t33  MyApp                          0x00000001087453c7 main + 55\r\n\t34  libdyld.dylib                       0x000000010df3665d start + 1\r\n)\r\nlibc++abi.dylib: terminating with uncaught exception of type NSException\r\n\r\nApple have responding marking the Radar a duplicate of : 16697134"
    email: web@cameroncooke.com
    modified: "2017-06-22T09:35:20.31069Z"
    number: "32508213"
    number_intvalue: 32508213
    originated: ""
    parent_number: '&{NULL_VALUE}'
    product: iOS + UIKit
    product_version: 10.3.x
    reproducible: Always
    resolved: ""
    status: Closed
    title: Crash when attempting to undo after unsuccessfully pasting into UITextField
