apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "32629312"
    labels:
        datastore_id: "6626027728011264"
data:
    classification: Serious Bug
    created: "2017-06-07T22:30:01.13416Z"
    description: "Summary:\r\nAn hdiutil command I’d been running in a unit test to create HFS+ volumes doesn’t work for APFS. I gave these arguments: create -fs APFS -format UDRW -srcFolder <folder> -volname <name> -attach -plist <dmg name>\r\n\r\nSteps to Reproduce:\r\n1. Call hdiutil create -fs APFS -format UDRW -srcFolder <folder> -volname <name> -attach -plist <dmg name>\r\n\r\nExpected Results:\r\nA DMG gets created with the contents of <folder>\r\n\r\nActual Results:\r\nIt returns nonzero, and gives this stdout/stderr output:\n\n2017-06-07 17:30:12.177 diskimages-helper[4038:516057] *useEffectiveIDs**** euid/egid changed to 501,20 (uid/gid is 501,20)\n2017-06-07 17:30:12.177 diskimages-helper[4038:516057] *useRealIDs******** euid/egid changed to 501,20 (uid/gid is 501,20)\n2017-06-07 17:30:12.178 diskimages-helper[4038:516057] *useEffectiveIDs**** euid/egid changed to 501,20 (uid/gid is 501,20)\n2017-06-07 17:30:12.184 copy-helper[4039:516063] estimating /Users/Dov/Source Code/UnzipKit/Tests/Test Data/DMGSource\n2017-06-07 17:30:13.198 diskimages-helper[4038:516057] *useRealIDs******** euid/egid changed to 501,20 (uid/gid is 501,20)\nDIDiskImageCreatorProbe: interface  1, score    -1000, CSparseBundleDiskImage\nDIDiskImageCreatorProbe: interface  2, score    -1000, CSparseDiskImage\nDIDiskImageCreatorProbe: interface  3, score     1000, CRawDiskImage\nDIDiskImageCreatorProbe: interface  7, score    -1000, CWOUDIFDiskImage\nDIDiskImageCreatorProbe: interface  9, score    -1000, CCFPlugInDiskImage\nDIDiskImageCreateWithCFURL: CRawDiskImage\nDIFileEncodingCreatorProbe: interface  2, score    -1000, CEncryptedEncoding\nDIBackingStoreCreatorProbe: interface  0, score      100, CBSDBackingStore\nDIBackingStoreCreatorProbe: interface  1, score    -1000, CBundleBackingStore\nDIBackingStoreCreatorProbe: interface  2, score        0, CRAMBackingStore\nDIBackingStoreCreatorProbe: interface  3, score      300, CCarbonBackingStore\nDIBackingStoreCreatorProbe: interface  5, score     -100, CCURLBackingStore\nDIBackingStoreCreateWithCFURL: CCarbonBackingStore\nDIBackingStoreCreateWithCFURL: creator returned 0\nDIDiskImageCreateWithCFURL: creator returned 0\nDI_kextWaitQuiet: about to call IOServiceWaitQuiet...\nDI_kextWaitQuiet: IOServiceWaitQuiet took 0.000015 seconds\nspaceman_metazone_init:262: not creating spaceman metazone, container is only 10575872 bytes, block_size 4096 block count 2582\nspaceman_metazone_init:262: not creating spaceman metazone, container is only 10575872 bytes, block_size 4096 block count 2582\nnx_mount:981: checkpoint search: largest xid 1, best xid 1 @ 1\nnx_mount:1043: sanity checking all nx state... please be patient.\napfs_newfs:14968: FS will NOT be encrypted.\nDI_kextWaitQuiet: about to call IOServiceWaitQuiet...\nDI_kextWaitQuiet: IOServiceWaitQuiet took 0.000002 seconds\n2017-06-07 17:30:13.718 diskimages-helper[4038:516182] DIHelperHDID serveImage: attaching drive\n{\n    autodiskmount = 1;\n    \"hdiagent-drive-identifier\" = \"88DD5523-34A3-4265-8BC2-5BCAB4216B50\";\n    \"skip-auto-fsck-for-system-images\" = 1;\n    \"system-image\" = 1;\n    \"unmount-timeout\" = 0;\n}\n2017-06-07 17:30:13.718 diskimages-helper[4038:516182] DIHelperHDID serveImage: connecting to myDrive 0x590B\n2017-06-07 17:30:13.718 diskimages-helper[4038:516182] DIHelperHDID serveImage: register _readBuffer 0x105f40000\n2017-06-07 17:30:13.718 diskimages-helper[4038:516182] DIHelperHDID serveImage: activating drive port 22295\n2017-06-07 17:30:13.719 diskimages-helper[4038:516182] DIHelperHDID serveImage: set cache enabled=TRUE returned FAILURE.\n2017-06-07 17:30:13.722 diskimages-helper[4038:516182] DIHelperHDID serveImage: set on IO thread=TRUE returned SUCCESS.\n2017-06-07 17:30:13.722 diskimages-helper[4038:516182] -processKernelRequest: will sleep received\n2017-06-07 17:30:13.800 diskimages-helper[4038:516182] -processKernelRequest: flush received\n2017-06-07 17:30:13.840 diskimages-helper[4038:516057] _mountDevEntries: disk5s1 aborting mountpoint postflight because disk image has no band size specified.\n2017-06-07 17:30:13.844 diskimages-helper[4038:516057] *useEffectiveIDs**** euid/egid changed to 501,20 (uid/gid is 501,20)\n2017-06-07 17:30:13.865 diskimages-helper[4038:516057] *useRealIDs******** euid/egid changed to 501,20 (uid/gid is 501,20)\n2017-06-07 17:30:13.866 diskimages-helper[4038:516057] *useEffectiveIDs**** euid/egid changed to 501,20 (uid/gid is 501,20)\n2017-06-07 17:30:13.884 copy-helper[4071:516300] copying /Users/Dov/Source Code/UnzipKit/Tests/Test Data/DMGSource to /Volumes/FileSystemTests_APFS\n2017-06-07 17:30:13.884 copy-helper[4071:516300] About to copy \"/Users/Dov/Source Code/UnzipKit/Tests/Test Data/DMGSource\".\n2017-06-07 17:30:13.885 copy-helper[4071:516300] copy error (fatal): /Users/Dov/Source Code/UnzipKit/Tests/Test Data/DMGSource/Volumes/FileSystemTests_APFS: Operation not permitted\n2017-06-07 17:30:13.885 copy-helper[4071:516300] Copy finished with error 1 (Operation not permitted).\nError 1 (Operation not permitted).\ncould not access /Volumes/FileSystemTests_APFS - Operation not permitted\n2017-06-07 17:30:14.982 diskimages-helper[4038:516182] -processKernelRequest: flush received\n2017-06-07 17:30:15.040 diskimages-helper[4038:516182] -processKernelRequest: flush received\n2017-06-07 17:30:15.084 diskimages-helper[4038:516182] -processKernelRequest: flush received\n2017-06-07 17:30:15.159 diskimages-helper[4038:516182] -processKernelRequest: flush received\n2017-06-07 17:30:15.234 diskimages-helper[4038:516182] -processKernelRequest: flush received\n2017-06-07 17:30:15.373 diskimages-helper[4038:516182] -processKernelRequest: flush received\n2017-06-07 17:30:15.458 diskimages-helper[4038:516057] *useEffectiveIDs**** euid/egid changed to 501,20 (uid/gid is 501,20)\nDIHLDiskImageCreate() returned 1\n2017-06-07 17:30:16.459 diskimages-helper[4038:516051] *** -[NSMachPort handlePortMessage:]: dropping incoming DO message because the connection is invalid\nhdiutil: create: returning 1\nhdiutil: create failed - Operation not permitted\r\n\r\nVersion:\r\n10.12.5\r\n\r\nNotes:\r\nnone"
    email: thedov@gmail.com
    modified: "2017-06-07T22:30:01.13435Z"
    number: "32629312"
    number_intvalue: 32629312
    originated: 07-Jun-2017 06:29 PM
    parent_number: '&{NULL_VALUE}'
    product: macOS + SDK
    product_version: 10.12.5
    reproducible: Always
    resolved: ""
    status: Open
    title: hdiutil doesn't accept -srcfolder arg for APFS volumes
