apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "33180013"
    labels:
        datastore_id: "5004937687728128"
data:
    classification: Crash/Hang/Data Loss
    created: "2017-07-07T12:53:59.37494Z"
    description: "Summary:\r\nUpdating a table view with beginUpdates/endUpdates and deleteRowsAtIndexPaths in between crashes on iOS 11 beta.\n\r\n\r\nSteps to Reproduce:\r\n1. Open attached example project in Xcode 9 beta\n2. Build & Run on iOS 11 beta simulator\n3. Tap Edit\n4. Delete a row\n5. Crash\r\n\r\nExpected Results:\r\nThis should not crash, works properly on iOS 10.\r\n\r\nActual Results:\r\nCrashes with an internal inconsistency exception that isn't correct, i.e. we never return 2 when asked for number of items, yet the exception says so:\n\n*** Terminating app due to uncaught exception 'NSInternalInconsistencyException', reason: 'Invalid update: invalid number of rows in section 0.  The number of rows contained in an existing section after the update (2) must be equal to the number of rows contained in that section before the update (1), plus or minus the number of rows inserted or deleted from that section (0 inserted, 0 deleted) and plus or minus the number of rows moved into or out of that section (0 moved in, 0 moved out).'\n*** First throw call stack:\n(\n\t0   CoreFoundation                      0x000000010e19779b __exceptionPreprocess + 171\n\t1   libobjc.A.dylib                     0x000000010daf9121 objc_exception_throw + 48\n\t2   CoreFoundation                      0x000000010e19c852 +[NSException raise:format:arguments:] + 98\n\t3   Foundation                          0x000000010d5a8612 -[NSAssertionHandler handleFailureInMethod:object:file:lineNumber:description:] + 193\n\t4   UIKit                               0x000000010e72e9f1 -[UITableView _endCellAnimationsWithContext:] + 17773\n\t5   ExceptionInTableViewAfterUpdateOniOS11 0x000000010d1eaee1 -[ViewController tableView:commitEditingStyle:forRowAtIndexPath:] + 513\n\t6   UIKit                               0x000000010e76b2d3 -[UITableView _animateDeletionOfRowAtIndexPath:] + 177\n\t7   UIKit                               0x000000010e773e53 __82-[UITableView _contextualActionForDeletingRowAtIndexPath:usingPresentationValues:]_block_invoke + 59\n\t8   UIKit                               0x000000010ec79c2b -[UIContextualAction executeHandlerWithView:completionHandler:] + 174\n\t9   UIKit                               0x000000010ef4c3f3 -[UISwipeOccurrence _performSwipeAction:inPullview:swipeInfo:] + 696\n\t10  UIKit                               0x000000010ef4dbea -[UISwipeOccurrence swipeActionPullView:tappedAction:] + 112\n\t11  UIKit                               0x000000010f0250a8 -[UISwipeActionPullView _tappedButton:] + 138\n\t12  UIKit                               0x000000010e617d45 -[UIApplication sendAction:to:from:forEvent:] + 83\n\t13  UIKit                               0x000000010e786c16 -[UIControl sendAction:to:forEvent:] + 67\n\t14  UIKit                               0x000000010e786f33 -[UIControl _sendActionsForEvents:withEvent:] + 450\n\t15  UIKit                               0x000000010e785e60 -[UIControl touchesEnded:withEvent:] + 618\n\t16  UIKit                               0x000000010ebc937e _UIGestureEnvironmentSortAndSendDelayedTouches + 5560\n\t17  UIKit                               0x000000010ebc3247 _UIGestureEnvironmentUpdate + 1424\n\t18  UIKit                               0x000000010ebc2c6b -[UIGestureEnvironment _deliverEvent:toGestureRecognizers:usingBlock:] + 484\n\t19  UIKit                               0x000000010ebc1d17 -[UIGestureEnvironment _updateGesturesForEvent:window:] + 288\n\t20  UIKit                               0x000000010e68c032 -[UIWindow sendEvent:] + 4102\n\t21  UIKit                               0x000000010e632aae -[UIApplication sendEvent:] + 352\n\t22  UIKit                               0x0000000127cca030 -[UIApplicationAccessibility sendEvent:] + 85\n\t23  UIKit                               0x000000010ef231ff __dispatchPreprocessedEventFromEventQueue + 2809\n\t24  UIKit                               0x000000010ef25d66 __handleEventQueueInternal + 5957\n\t25  CoreFoundation                      0x000000010e13ae71 __CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__ + 17\n\t26  CoreFoundation                      0x000000010e11f56f __CFRunLoopDoSources0 + 271\n\t27  CoreFoundation                      0x000000010e11eb1f __CFRunLoopRun + 1039\n\t28  CoreFoundation                      0x000000010e11e499 CFRunLoopRunSpecific + 409\n\t29  GraphicsServices                    0x0000000112f309d7 GSEventRunModal + 62\n\t30  UIKit                               0x000000010e6160b8 UIApplicationMain + 159\n\t31  ExceptionInTableViewAfterUpdateOniOS11 0x000000010d1eb30f main + 111\n\t32  libdyld.dylib                       0x0000000111a74771 start + 1\n\t33  ???                                 0x0000000000000001 0x0 + 1\n)\nlibc++abi.dylib: terminating with uncaught exception of type NSException\r\n\r\nVersion:\r\niOS 11.0 (15A5304f)\r\n\r\nNotes:\r\nFor up to date sample code regarding this crash, see our git repo: https://github.com/PSPDFKit-labs/radar.apple.com/tree/master/33179382%20-%20Crash%20in%20UITableView%20after%20update%20on%20iOS%2011%20beta"
    email: steipete@gmail.com
    modified: "2017-07-07T12:53:59.37521Z"
    number: "33180013"
    number_intvalue: 33180013
    originated: 07-Jul-2017 02:53 PM
    parent_number: '&{NULL_VALUE}'
    product: iOS + SDK
    product_version: iOS 11.0 (15A5304f)
    reproducible: Always
    resolved: ""
    status: Open
    title: Crash in UITableView after update on iOS 11 beta
