apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "29969759"
    labels:
        datastore_id: "5010063664087040"
data:
    classification: Bug
    created: "2017-01-11T17:26:24.80519Z"
    description: "If there is a nested NSTouchBar (using NSTouchBarItemIdentifierOtherItemsProxy) in touch bar and not enough room to display all items it gets possible to drop a parent bar item to nested bar by replacing inner one. \r\nOnce one does it app crashes with console log:\r\n\r\n2017-01-11 18:45:37.342768 touchbartest[786:28851] [General] *** -[__NSArrayM objectAtIndex:]: index 9223372036854775807 beyond bounds for empty array\r\n2017-01-11 18:45:37.346859 touchbartest[786:28851] [General] (\r\n\t0   CoreFoundation                      0x00007fffbb038e7b __exceptionPreprocess + 171\r\n\t1   libobjc.A.dylib                     0x00007fffcfc23cad objc_exception_throw + 48\r\n\t2   CoreFoundation                      0x00007fffbaf521dc -[__NSArrayM objectAtIndex:] + 204\r\n\t3   AppKit                              0x00007fffb95cb3e8 -[NSTouchBarCustomizationPreviewViewController removeItemAtIndex:inSection:reload:] + 62\r\n\t4   AppKit                              0x00007fffb95d2ee4 __99-[NSTouchBarCustomizationPreviewViewController(NSInteraction) coordinator:didFinishDrag:isRemoval:]_block_invoke + 673\r\n\t5   AppKit                              0x00007fffb95c8ff7 __69-[NSTouchBarCustomizationPreviewViewController updateModel:animated:]_block_invoke + 661\r\n\t6   UIFoundation                        0x00007fffcdac369c -[_NSCollectionViewCore _performBatchUpdates:completion:invalidationContext:tentativelyForReordering:] + 210\r\n\t7   AppKit                              0x00007fffb94577bf -[NSCollectionView performBatchUpdates:completionHandler:] + 156\r\n\t8   AppKit                              0x00007fffb9633424 ___withImplicitAnimationEnabledDo_block_invoke + 52\r\n\t9   AppKit                              0x00007fffb9429096 +[NSAnimationContext runAnimationGroup:] + 58\r\n\t10  AppKit                              0x00007fffb9632f7b -[_NSViewAnimator_NSCollectionView performBatchUpdates:completionHandler:] + 135\r\n\t11  AppKit                              0x00007fffb95c8cd4 -[NSTouchBarCustomizationPreviewViewController updateModel:animated:] + 314\r\n\t12  AppKit                              0x00007fffb95d2b16 -[NSTouchBarCustomizationPreviewViewController(NSInteraction) coordinator:didFinishDrag:isRemoval:] + 671\r\n\t13  AppKit                              0x00007fffb94b70cc -[NSTouchBarCustomizationPreviewInteractionCoordinator endDragOfItem:isRemoval:] + 333\r\n\t14  AppKit                              0x00007fffb95d0c45 -[NSTouchBarCustomizationPreviewViewController(CursorUpdates) cursorMouseUpAtPoint:] + 100\r\n\t15  AppKit                              0x00007fffb8eddc79 -[NSTouchBarCustomizationCursorManager updateWithEvent:] + 146\r\n\t16  AppKit                              0x00007fffb8eddb2a __59-[NSTouchBarCustomizationCursorManager beginTrackingCursor]_block_invoke + 47\r\n\t17  AppKit                              0x00007fffb906ef81 _NSSendEventToDequingObservers + 372\r\n\t18  AppKit                              0x00007fffb925aa9f -[NSApplication(NSEvent) _nextEventMatchingEventMask:untilDate:inMode:dequeue:] + 869\r\n\t19  AppKit                              0x00007fffb8d36d7c -[NSApplication _doModalLoop:peek:] + 497\r\n\t20  AppKit                              0x00007fffb8f16f6a __35-[NSApplication runModalForWindow:]_block_invoke + 64\r\n\t21  AppKit                              0x00007fffb8d34862 -[NSApplication runModalForWindow:] + 137\r\n\t22  AppKit                              0x00007fffb9331224 __82-[NSTouchBarCustomizationController toggleCustomizationPalette:forceControlStrip:]_block_invoke.332 + 177\r\n\t23  AppKit                              0x00007fffb93343e6 ___NSMainRunLoopPerformBlockAfterDelay_block_invoke + 25\r\n\t24  CoreFoundation                      0x00007fffbafb8244 __CFRUNLOOP_IS_CALLING_OUT_TO_A_TIMER_CALLBACK_FUNCTION__ + 20\r\n\t25  CoreFoundation                      0x00007fffbafb7ecf __CFRunLoopDoTimer + 1071\r\n\t26  CoreFoundation                      0x00007fffbafb7a2a __CFRunLoopDoTimers + 298\r\n\t27  CoreFoundation                      0x00007fffbafaf3e1 __CFRunLoopRun + 2065\r\n\t28  CoreFoundation                      0x00007fffbafae974 CFRunLoopRunSpecific + 420\r\n\t29  HIToolbox                           0x00007fffba53aacc RunCurrentEventLoopInMode + 240\r\n\t30  HIToolbox                           0x00007fffba53a901 ReceiveNextEventCommon + 432\r\n\t31  HIToolbox                           0x00007fffba53a736 _BlockUntilNextEventMatchingListInModeWithFilter + 71\r\n\t32  AppKit                              0x00007fffb8ae0ae4 _DPSNextEvent + 1120\r\n\t33  AppKit                              0x00007fffb925b21f -[NSApplication(NSEvent) _nextEventMatchingEventMask:untilDate:inMode:dequeue:] + 2789\r\n\t34  AppKit                              0x00007fffb8ad5465 -[NSApplication run] + 926\r\n\t35  AppKit                              0x00007fffb8a9fd80 NSApplicationMain + 1237\r\n\t36  touchbartest                        0x00000001000016e2 main + 34\r\n\t37  libdyld.dylib                       0x00007fffd0507255 start + 1\r\n\t38  ???                                 0x0000000000000003 0x0 + 3\r\n)"
    email: dbezverkhnii@readdle.com
    modified: "2017-01-11T17:26:24.80548Z"
    number: "29969759"
    number_intvalue: 29969759
    originated: 11 Jan 2017
    parent_number: '&{NULL_VALUE}'
    product: macOS + SDK
    product_version: 10.12.2
    reproducible: 100%
    resolved: ""
    status: Open
    title: App crashes on trying to customize touch bar items.
