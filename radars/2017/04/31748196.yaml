apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "31748196"
    labels:
        datastore_id: "5052193535164416"
data:
    classification: UIKit
    created: "2017-04-21T00:31:04.44726Z"
    description: "Area:\r\nUIKit\r\n\r\nSummary:\r\nWhen calling `UICollectionView.performBatchUpdates` then soon after calling `UICollectionView.reloadData`, the `UICollectionView` is not properly reloaded. In this bad case, `UICollectionViewDataSource.collectionView(_:cellForItemAt:)` is never called for the `reloadData`.\r\n\r\nThis issue is not experience if `UICollectionView.reloadSections` is used in place of `reloadData`.\r\n\r\nHere are some example method traces from the demo project:\r\n\r\nHere we have `performBatchUpdates` followed by `reloadData` and we can see that no call is made to `UICollectionViewDataSource.collectionView(_:cellForItemAt:)` as expected with `reloadData`.\r\n```\r\n2017-04-20 16:39:25.944 CollectionViewBug[78449:18671781] CollectionView.performBatchUpdates\r\n2017-04-20 16:39:25.945 CollectionViewBug[78449:18671781] ViewController.performBatchUpdates update closure\r\n2017-04-20 16:39:25.946 CollectionViewBug[78449:18671781] ViewController.collectionView(_:layout:sizeForItemAt: 0-0)\r\n2017-04-20 16:39:25.946 CollectionViewBug[78449:18671781] ViewController.collectionView(_:layout:sizeForItemAt: 0-1)\r\n2017-04-20 16:39:25.947 CollectionViewBug[78449:18671781] ViewController.collectionView(_:layout:sizeForItemAt: 0-2)\r\n2017-04-20 16:39:25.947 CollectionViewBug[78449:18671781] ViewController.collectionView(_:layout:sizeForItemAt: 0-3)\r\n2017-04-20 16:39:25.948 CollectionViewBug[78449:18671781] ViewController.collectionView(_:layout:sizeForItemAt: 0-4)\r\n2017-04-20 16:39:25.948 CollectionViewBug[78449:18671781] ViewController.collectionView(_:layout:sizeForItemAt: 0-5)\r\n2017-04-20 16:39:25.949 CollectionViewBug[78449:18671781] ViewController.collectionView(_:layout:sizeForItemAt: 0-6)\r\n2017-04-20 16:39:25.950 CollectionViewBug[78449:18671781] CollectionView.reloadData\r\n2017-04-20 16:39:25.951 CollectionViewBug[78449:18671781] ViewController.collectionView(_:layout:sizeForItemAt: 0-0)\r\n2017-04-20 16:39:26.000 CollectionViewBug[78449:18671781] ViewController.collectionView(_:layout:sizeForItemAt: 0-1)\r\n2017-04-20 16:39:26.000 CollectionViewBug[78449:18671781] ViewController.collectionView(_:layout:sizeForItemAt: 0-2)\r\n2017-04-20 16:39:26.000 CollectionViewBug[78449:18671781] ViewController.collectionView(_:layout:sizeForItemAt: 0-3)\r\n2017-04-20 16:39:26.001 CollectionViewBug[78449:18671781] ViewController.collectionView(_:layout:sizeForItemAt: 0-4)\r\n2017-04-20 16:39:26.001 CollectionViewBug[78449:18671781] ViewController.collectionView(_:layout:sizeForItemAt: 0-5)\r\n2017-04-20 16:39:26.001 CollectionViewBug[78449:18671781] ViewController.collectionView(_:layout:sizeForItemAt: 0-6)\r\n2017-04-20 16:39:26.001 CollectionViewBug[78449:18671781] ViewController.performBatchUpdates complete closure\r\n2017-04-20 16:39:26.002 CollectionViewBug[78449:18671781] CollectionView.layoutSubviews\r\n```\r\n\r\nHere we have `performBatchUpdates` followed by `reloadSections` and we can see that calls are properly made to `UICollectionViewDataSource.collectionView(_:cellForItemAt:)` as expected.\r\n```\r\n2017-04-20 17:13:28.620 CollectionViewBug[79697:18821731] CollectionView.performBatchUpdates\r\n2017-04-20 17:13:28.621 CollectionViewBug[79697:18821731] ViewController.performBatchUpdates update closure\r\n2017-04-20 17:13:28.622 CollectionViewBug[79697:18821731] ViewController.collectionView(_:layout:sizeForItemAt: 0-0)\r\n2017-04-20 17:13:28.622 CollectionViewBug[79697:18821731] ViewController.collectionView(_:layout:sizeForItemAt: 0-1)\r\n2017-04-20 17:13:28.622 CollectionViewBug[79697:18821731] ViewController.collectionView(_:layout:sizeForItemAt: 0-2)\r\n2017-04-20 17:13:28.623 CollectionViewBug[79697:18821731] ViewController.collectionView(_:layout:sizeForItemAt: 0-3)\r\n2017-04-20 17:13:28.623 CollectionViewBug[79697:18821731] ViewController.collectionView(_:layout:sizeForItemAt: 0-4)\r\n2017-04-20 17:13:28.623 CollectionViewBug[79697:18821731] ViewController.collectionView(_:layout:sizeForItemAt: 0-5)\r\n2017-04-20 17:13:28.624 CollectionViewBug[79697:18821731] ViewController.collectionView(_:layout:sizeForItemAt: 0-6)\r\n2017-04-20 17:13:28.625 CollectionViewBug[79697:18821731] CollectionView.reloadSections\r\n2017-04-20 17:13:28.625 CollectionViewBug[79697:18821731] ViewController.collectionView(_:layout:sizeForItemAt: 0-0)\r\n2017-04-20 17:13:28.625 CollectionViewBug[79697:18821731] ViewController.collectionView(_:layout:sizeForItemAt: 0-1)\r\n2017-04-20 17:13:28.626 CollectionViewBug[79697:18821731] ViewController.collectionView(_:layout:sizeForItemAt: 0-2)\r\n2017-04-20 17:13:28.626 CollectionViewBug[79697:18821731] ViewController.collectionView(_:layout:sizeForItemAt: 0-3)\r\n2017-04-20 17:13:28.626 CollectionViewBug[79697:18821731] ViewController.collectionView(_:layout:sizeForItemAt: 0-4)\r\n2017-04-20 17:13:28.626 CollectionViewBug[79697:18821731] ViewController.collectionView(_:layout:sizeForItemAt: 0-5)\r\n2017-04-20 17:13:28.627 CollectionViewBug[79697:18821731] ViewController.collectionView(_:layout:sizeForItemAt: 0-6)\r\n2017-04-20 17:13:28.627 CollectionViewBug[79697:18821731] ViewController.collectionView(_:cellForItemAt: 0-0)\r\n2017-04-20 17:13:28.629 CollectionViewBug[79697:18821731] ViewController.collectionView(_:cellForItemAt: 0-1)\r\n2017-04-20 17:13:28.629 CollectionViewBug[79697:18821731] ViewController.collectionView(_:cellForItemAt: 0-2)\r\n2017-04-20 17:13:28.630 CollectionViewBug[79697:18821731] ViewController.collectionView(_:cellForItemAt: 0-3)\r\n2017-04-20 17:13:28.631 CollectionViewBug[79697:18821731] CollectionView.layoutSubviews\r\n2017-04-20 17:13:28.633 CollectionViewBug[79697:18821731] ViewController.performBatchUpdates complete closure\r\n2017-04-20 17:13:28.633 CollectionViewBug[79697:18821731] CollectionView.layoutSubviews\r\n2017-04-20 17:13:29.002 CollectionViewBug[79697:18821731] CollectionView.layoutSubviews\r\n```\r\n\r\nSteps to Reproduce:\r\n1. Call `UICollectionView.performBatchUpdates(nil, completion: nil)`\r\n2. Optionally, update the UICollectionViewDataSource (this will help visualize the issue)\r\n3. Call `UICollectionView.reloadData()` immediately afterward (all of this in the same method is the easiest)\r\n\r\nExpected Results:\r\nAll cells are reloaded by calling `UICollectionViewDataSource.collectionView(_:cellForItemAt:)`.  \r\n\r\nActual Results:\r\n`UICollectionViewDataSource.collectionView(_:cellForItemAt:)` is never called.\r\n\r\nVersion:\r\niOS 10.2.1 (14D27), iOS Simulator 10.2 (14C89), Xcode Version 8.2.1 (8C1002), iOS Simulator 10.3 (14E269), Xcode Version 8.3.2 (8E2002)\r\n\r\nNotes:\r\nFor using the included demo project:\r\n\r\nThere are some notes at the top of ViewController.swift, the main file.\r\n\r\n1. Run the project on any device or simulator.\r\n2. Tap the button labeled \"Bad\"\r\n  - You should see that the cells change size but do not reload (they should reload to yellow). If you scroll around you will see that the cells do correctly configure when scrolled on to the screen.\r\n3. Tap the button labeled \"Reset\"\r\n  - This will reset the example to its original state\r\n4. Tap the button labeled \"Good\"\r\n  - You should see the proper reloading behavior since this uses `reloadSections`\r\n5. Repeat 2-4 after changing `DISABLE_ANIMATIONS` at the top of the ViewController.swift file to `true`. This just demonstrates the same issue occurs when not using animations for the animated UICollectionView methods.\r\n\r\nConfiguration:\r\niPhone 7 Plus 128G AT&T, iPhone Simulator\r\n\r\nAttachments:\r\n'CollectionViewBug.zip' was successfully uploaded."
    email: smiller@uber.com
    modified: "2017-04-21T00:31:04.44745Z"
    number: "31748196"
    number_intvalue: 31748196
    originated: 20-Apr-2017 05:27 PM
    parent_number: '&{NULL_VALUE}'
    product: iOS + SDK
    product_version: iOS 10.2, iOS 10.3
    reproducible: Always
    resolved: ""
    status: Open
    title: UICollectionView reloadData does not reload when preceded by performBatchUpdates
