apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "31749591"
    labels:
        datastore_id: "5026381788348416"
data:
    classification: Crash
    created: "2017-04-21T01:54:49.85051Z"
    description: "Area:\r\nUIKit\r\n\r\nSummary:\r\nPlease see the included stack traces for this bug.\r\n\r\nWe are unable to reproduce this crash, but it has started occurring in as high as 0.1% of sessions. While we do not have reproduction steps, we know that when using `UICollectionView.reloadSections` instead of `UICollectionView.reloadData` this crash does not occur. \r\n\r\nBecause `UICollectionView.reloadSections` instead of `UICollectionView.reloadData` fixes the crashes we suspect that this is similar to the bug filed in Bug Report #31748196 (https://openradar.appspot.com/31748196).\r\n\r\nSteps to Reproduce:\r\nUnknown. We have been unsuccessful in attempts to reproduce this bug.\r\n\r\nIt seems that a similar crash has been reported in bug report #27354858, https://openradar.appspot.com/27354858 which has reproduction steps. However, we do not use `insertItems` in the `performBatchUpdates` or elsewhere in our code. We do use `insertSections` but only once at the beginning of our `UICollectionView` lifecycle.\r\n\r\nExpected Results:\r\nNo crashes.\r\n\r\nActual Results:\r\nCrashes.\r\n\r\nVersion:\r\nAll iOS versions, it seems there is a significantly reduced number of crashes on iOS 10.3\r\n\r\nNotes:\r\n\r\n\r\nConfiguration:\r\nAll iPhone devices, there seems to be no correlation to hardware.\r\n\r\nAttachments:\r\n'ExampleCrashStackTraces_PerformBatchUpdates.zip' was successfully uploaded.\r\n\r\nAdded for Open Radar:\r\nHere are some examples of the tops of included stack traces\r\n\r\n```\r\nException Type:      EXC_CRASH (SIGABRT)\r\nException Codes:     0x00000000 at 0x0000000000000000\r\nCrashed Thread:      0\r\nApplication Specific Information: *** Terminating app due to uncaught exception 'NSInternalInconsistencyException', reason: 'request for index path for global index 4361310367 when there are only 1 items in the collection view'\r\n\r\nThread 0 Crashed:\r\n0   CoreFoundation                 0x000000018e38d1b8 __exceptionPreprocess + 124\r\n1   libobjc.A.dylib                0x000000018cdc455c objc_exception_throw + 56\r\n2   CoreFoundation                 0x000000018e38d08c -[NSException raise:format:] + 0\r\n3   Foundation                     0x000000018ee4502c -[NSAssertionHandler handleFailureInMethod:object:file:lineNumber:description:] + 112\r\n4   UIKit                          0x00000001944147f0 -[UICollectionViewData indexPathForItemAtGlobalIndex:] + 300\r\n5   UIKit                          0x0000000194b3c7e8 -[UICollectionView _viewAnimationsForCurrentUpdate] + 220\r\n6   CoreFoundation                 0x000000018e26e17c -[__NSDictionaryM enumerateKeysAndObjectsWithOptions:usingBlock:] + 136\r\n7   CoreFoundation                 0x000000018e26e048 -[__NSDictionaryM enumerateKeysAndObjectsWithOptions:usingBlock:] + 180\r\n8   UIKit                          0x0000000194418064 -[UICollectionView _viewAnimationsForCurrentUpdate] + 160\r\n9   UIKit                          0x00000001944155dc -[UICollectionView _viewAnimationsForCurrentUpdate] + 320\r\n10  UIKit                          0x0000000194b3f200 __71-[UICollectionView _updateWithItems:tentativelyForReordering:animator:]_block_invoke.1993 + 132\r\n11  UIKit                          0x00000001942507dc +[UIView(Animation) performWithoutAnimation:] + 104\r\n12  UIKit                          0x0000000194b3e230 -[UICollectionView _updateWithItems:tentativelyForReordering:animator:] + 3224\r\n13  UIKit                          0x0000000194b3c2d0 -[UICollectionView _endItemAnimationsWithInvalidationContext:tentativelyForReordering:animator:] + 13816\r\n14  UIKit                          0x0000000194b3fc98 -[UICollectionView _endUpdatesWithInvalidationContext:tentativelyForReordering:animator:] + 92\r\n15  UIKit                          0x0000000194b3ff78 -[UICollectionView _performBatchUpdates:completion:invalidationContext:tentativelyForReordering:animator:] + 384\r\n16  UIKit                          0x0000000194b3fdd8 -[UICollectionView _performBatchUpdates:completion:invalidationContext:tentativelyForReordering:] + 96\r\n17  UIKit                          0x0000000194b3fd5c -[UICollectionView _performBatchUpdates:completion:invalidationContext:] + 84\r\n18  UIKit                          0x000000019441c618 -[UICollectionView performBatchUpdates:completion:] + 64\r\n```\r\n\r\n```\r\nException Type:      EXC_BAD_ACCESS (SIGSEGV)\r\nException Codes:     KERN_INVALID_ADDRESS at 0x20b40628\r\nCrashed Thread:      0\r\n\r\nThread 0 Crashed:\r\n0   UIKit                          0x000000002ed87762 -[UICollectionViewData layoutAttributesForItemAtIndexPath:] + 214\r\n1   UIKit                          0x000000002ed84377 -[UICollectionViewData globalIndexForItemAtIndexPath:] + 67\r\n2   UIKit                          0x000000002eee5861 -[UICollectionView _viewAnimationsForCurrentUpdate] + 3361\r\n3   UIKit                          0x000000002f32c94b -[UICollectionView _updateWithItems:tentativelyForReordering:] + 1747\r\n4   UIKit                          0x000000002f32b343 -[UICollectionView _endItemAnimationsWithInvalidationContext:tentativelyForReordering:] + 8563\r\n5   UIKit                          0x000000002f32d92f -[UICollectionView _performBatchUpdates:completion:invalidationContext:tentativelyForReordering:] + 407\r\n6   UIKit                          0x000000002f32d793 -[UICollectionView _performBatchUpdates:completion:invalidationContext:] + 31\r\n7   UIKit                          0x000000002eeea617 -[UICollectionView performBatchUpdates:completion:] + 31\r\n```\r\n\r\n```\r\nException Type:      EXC_CRASH (SIGABRT)\r\nException Codes:     0x00000000 at 0x0000000000000000\r\nCrashed Thread:      0\r\nApplication Specific Information: *** Terminating app due to uncaught exception 'NSInternalInconsistencyException', reason: 'request for index path for global index 6249663710 when there are only 2 items in the collection view'\r\n\r\nThread 0 Crashed:\r\n0   CoreFoundation                 0x00000001907d91b8 __exceptionPreprocess + 124\r\n1   libobjc.A.dylib                0x000000018f21055c objc_exception_throw + 56\r\n2   CoreFoundation                 0x00000001907d908c -[NSException raise:format:] + 0\r\n3   Foundation                     0x000000019129102c -[NSAssertionHandler handleFailureInMethod:object:file:lineNumber:description:] + 112\r\n4   UIKit                          0x00000001968607f0 -[UICollectionViewData indexPathForItemAtGlobalIndex:] + 300\r\n5   UIKit                          0x0000000196f887e8 -[UICollectionView _viewAnimationsForCurrentUpdate] + 220\r\n6   CoreFoundation                 0x00000001906ba17c -[__NSDictionaryM enumerateKeysAndObjectsWithOptions:usingBlock:] + 136\r\n7   CoreFoundation                 0x00000001906ba048 -[__NSDictionaryM enumerateKeysAndObjectsWithOptions:usingBlock:] + 180\r\n8   UIKit                          0x0000000196864064 -[UICollectionView _viewAnimationsForCurrentUpdate] + 160\r\n9   UIKit                          0x00000001968615dc -[UICollectionView _viewAnimationsForCurrentUpdate] + 320\r\n10  UIKit                          0x0000000196f8b200 __71-[UICollectionView _updateWithItems:tentativelyForReordering:animator:]_block_invoke.1993 + 132\r\n11  UIKit                          0x000000019669c7dc +[UIView(Animation) performWithoutAnimation:] + 104\r\n12  UIKit                          0x0000000196f8a230 -[UICollectionView _updateWithItems:tentativelyForReordering:animator:] + 3224\r\n13  UIKit                          0x0000000196f882d0 -[UICollectionView _endItemAnimationsWithInvalidationContext:tentativelyForReordering:animator:] + 13816\r\n14  UIKit                          0x0000000196f8bc98 -[UICollectionView _endUpdatesWithInvalidationContext:tentativelyForReordering:animator:] + 92\r\n15  UIKit                          0x0000000196f8bf78 -[UICollectionView _performBatchUpdates:completion:invalidationContext:tentativelyForReordering:animator:] + 384\r\n16  UIKit                          0x0000000196f8bdd8 -[UICollectionView _performBatchUpdates:completion:invalidationContext:tentativelyForReordering:] + 96\r\n17  UIKit                          0x0000000196f8bd5c -[UICollectionView _performBatchUpdates:completion:invalidationContext:] + 84\r\n18  UIKit                          0x0000000196868618 -[UICollectionView performBatchUpdates:completion:] + 64\r\n```\r\n\r\n```\r\nException Type:      EXC_CRASH (SIGABRT)\r\nException Codes:     0x00000000 at 0x00000000\r\nCrashed Thread:      0\r\nApplication Specific Information: *** Terminating app due to uncaught exception 'NSInternalInconsistencyException', reason: 'request for index path for global index 1102011508 when there are only 1 items in the collection view'\r\n\r\nThread 0 Crashed:\r\n0   CoreFoundation                 0x00000000235a391b __exceptionPreprocess + 127\r\n1   libobjc.A.dylib                0x0000000022d3ee17 objc_exception_throw + 39\r\n2   CoreFoundation                 0x00000000235a37f1 -[NSException raise:format:] + 1\r\n3   Foundation                     0x0000000023d87529 -[NSAssertionHandler handleFailureInMethod:object:file:lineNumber:description:] + 93\r\n4   UIKit                          0x0000000027d01909 -[UICollectionViewData indexPathForItemAtGlobalIndex:] + 273\r\n5   UIKit                          0x0000000027d00ae9 -[UICollectionViewLayout prepareForCollectionViewUpdates:] + 533\r\n6   UIKit                          0x0000000027d008c7 -[UICollectionView _prepareLayoutForUpdates] + 323\r\n7   UIKit                          0x000000002832094b -[UICollectionView _updateWithItems:tentativelyForReordering:] + 2275\r\n8   UIKit                          0x000000002831eff9 -[UICollectionView _endItemAnimationsWithInvalidationContext:tentativelyForReordering:] + 10393\r\n9   UIKit                          0x0000000028321d59 -[UICollectionView _performBatchUpdates:completion:invalidationContext:tentativelyForReordering:] + 353\r\n10  UIKit                          0x0000000028321be5 -[UICollectionView _performBatchUpdates:completion:invalidationContext:] + 57\r\n11  UIKit                          0x0000000027d089e1 -[UICollectionView performBatchUpdates:completion:] + 45\r\n```"
    email: smiller@uber.com
    modified: "2017-04-21T01:54:49.85097Z"
    number: "31749591"
    number_intvalue: 31749591
    originated: 20-Apr-2017 06:49 PM
    parent_number: '&{NULL_VALUE}'
    product: iOS + SDK
    product_version: All iPhone and iOS versions
    reproducible: Unable
    resolved: ""
    status: Open
    title: PerformBatchUpdates crashes with NSInternalInconsistencyException requesting absurd index
