apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "7757591"
    labels:
        datastore_id: "192401"
data:
    classification: serious bug
    created: "2010-03-16T08:17:28.236311Z"
    description: "16-Mar-2010 07:22 AM Jean-Denis Muys:\r\nSummary: \LUITableView crashes in endUpdate, called by the Managed Object Context \"save\" method, when:\r\n1- The Core-Data Store is empty\r\n2- The Fetched Result Controller is configured to show sections\r\n3- Two managed objects (or more) have been added to the store\r\n\r\nSteps to Reproduce:\LTo reproduce the crash: \r\n\r\n1- Start with a Navigation-based application project using Core Data. I named it crashTest. \r\n2- The template has one Entity in the data model, called Event. Add two strings attributes to it. I added \"name\" and \"kind\". \r\n3- Modify RootViewController.m to use sections on the new \"kind\" attribute. to do so change one line in - (NSFetchedResultsController *)fetchedResultsController: \r\n\r\n    NSFetchedResultsController *aFetchedResultsController = [[NSFetchedResultsController alloc] initWithFetchRequest:fetchRequest managedObjectContext:managedObjectContext sectionNameKeyPath:nil cacheName:@\"Root\"]; \r\n\r\nto: \r\n\r\n    NSFetchedResultsController *aFetchedResultsController = [[NSFetchedResultsController alloc] initWithFetchRequest:fetchRequest managedObjectContext:managedObjectContext sectionNameKeyPath:@\"kind\" cacheName:@\"Root\"]; \r\n\r\nAlso, one data source routine must be added to name the section: \r\n\r\n- (NSString *)tableView:(UITableView *)tableView titleForHeaderInSection:(NSInteger)section { \r\n    return [[[fetchedResultsController sections] objectAtIndex:section] name]; \r\n} \r\n\r\n\r\n4- Modify the - (void)insertNewObject routine to create two objects at once, and to set the two new attributes: \r\n\r\n- (void)insertNewObject { \r\n     \r\n    // Create a new instance of the entity managed by the fetched results controller. \r\n    NSManagedObjectContext *context = [fetchedResultsController managedObjectContext]; \r\n    NSEntityDescription *entity = [[fetchedResultsController fetchRequest] entity]; \r\n    NSManagedObject *newManagedObject = [NSEntityDescription insertNewObjectForEntityForName:[entity name] inManagedObjectContext:context]; \r\n     \r\n    // If appropriate, configure the new managed object. \r\n    [newManagedObject setValue:[NSDate date] forKey:@\"timeStamp\"]; \r\n    [newManagedObject setValue:@\"name1\" forKey:@\"name\"]; \r\n    [newManagedObject setValue:@\"lunch\" forKey:@\"kind\"]; \r\n\r\n    newManagedObject = [NSEntityDescription insertNewObjectForEntityForName:[entity name] inManagedObjectContext:context]; \r\n    [newManagedObject setValue:[NSDate date] forKey:@\"timeStamp\"]; \r\n    [newManagedObject setValue:@\"name2\" forKey:@\"name\"]; \r\n    [newManagedObject setValue:@\"lunch\" forKey:@\"kind\"]; \r\n\r\n    // Save the context. \r\n    NSError *error = nil; \r\n    if (![context save:&error]) { \r\n        NSLog(@\"Unresolved error %@, %@\", error, [error userInfo]); \r\n        abort(); \r\n    } \r\n} \r\n\r\n5- Run, tap the \"+\" button, and watch it crash: \r\n\r\nI attach such a XCode project.\r\n\r\nExpected Results:\LI expected the two objects to be added to the Core Data store, and to be displayed under their section in the UITableView\r\n\r\n\r\nActual Results:\LI get an array out of bound exception:\r\n\r\n2010-03-15 02:48:30.056 crashTest[12767:207] Serious application error.  Exception was caught during Core Data change processing: *** -[NSCFArray objectAtIndex:]: index (1) beyond bounds (1) with userInfo (null) \r\n\r\n\r\n#0  0x901ca4e6 in objc_exception_throw\r\n#1  0x01d86c3b in +[NSException raise:format:arguments:]\r\n#2  0x01d86b9a in +[NSException raise:format:]\r\n#3  0x00072cb9 in _NSArrayRaiseBoundException\r\n#4  0x00010217 in -[NSCFArray objectAtIndex:]\r\n#5  0x002eaaa7 in -[UITableView(_UITableViewPrivate) _endCellAnimationsWithContext:]\r\n#6  0x002def02 in -[UITableView endUpdates]\r\n#7  0x00004863 in -[AirportViewController controllerDidChangeContent:] at AirportViewController.m:463\r\n#8  0x01c43be1 in -[NSFetchedResultsController(PrivateMethods) _managedObjectContextDidChange:]\r\n#9  0x0001462a in _nsnote_callback\r\n#10 0x01d31005 in _CFXNotificationPostNotification\r\n#11 0x00011ee0 in -[NSNotificationCenter postNotificationName:object:userInfo:]\r\n#12 0x01ba417d in -[NSManagedObjectContext(_NSInternalNotificationHandling) _postObjectsDidChangeNotificationWithUserInfo:]\r\n#13 0x01c03763 in -[NSManagedObjectContext(_NSInternalChangeProcessing) _createAndPostChangeNotification:withDeletions:withUpdates:withRefreshes:]\r\n#14 0x01b885ea in -[NSManagedObjectContext(_NSInternalChangeProcessing) _processRecentChanges:]\r\n#15 0x01bbe728 in -[NSManagedObjectContext save:]\r\n\r\n\r\n\r\nRegression:\LThis happens on all variants of iPhone 3.1.x. I haven't tested earlier versions. This happens in both a device or the Simulator.\r\n\r\nNotes:\LIt's possible to work around the crash by making sure one of the three conditions listed above is not met. For example, save the Managed Object Context after the first Managed Object is added, before going on with a mass insert."
    email: jdmuys@gmail.com
    modified: "2011-08-28T05:42:16.015355Z"
    number: "7757591"
    number_intvalue: 7757591
    originated: 03/16/2010
    parent_number: '&{NULL_VALUE}'
    product: iPhone SDK
    product_version: 3.1.x
    reproducible: always
    resolved: ""
    status: open
    title: UITableView crashes when adding 2 objects to an empty store, with sections
