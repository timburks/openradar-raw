apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "7538960"
    labels:
        datastore_id: "139404"
data:
    classification: Performance
    created: "2010-01-13T21:32:17.981259Z"
    description: "Summary: \r\n\r\nIn our student computing environment at the University of Utah we have thousands of students logging in for a single session on our public Macs.\r\n\r\nThe time between the student authenticating at the loginwindow and getting a usable desktop takes a minute and fifteen seconds, on the majority of our Mac's which are: White iMac 17\", 1.83Ghz intel core 2 duo, 2gb Ram, 160Gb 7200 rpm HDD.\r\n\r\nOur Macs are connected to a directory service that has ~50,000 unique users and we can not anticipate which of those 50,000 users are going to login on a given machine. Every time they login a new home folder is created. We have had hard disks fill up with user caches, so we remove them weekly. All our users have the exact same permissions and so we would like to be able to create the  launchservices database and other caches that applies to all of them.  We tried to statically map all of the users to one uid but that failed.  The home folder is already mapped to the same directory for all users.\r\n\r\nWe have been troubleshooting to bring down this login time and here are our conclusions so far.\r\n\r\nloginwindow.app kicks off lsregister and ATSServer, for every new user login.\r\n\r\nif we try to build the \"Launch Services Database\" before the user logs in using:\r\n\r\n/System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/LaunchServices.framework/Versions/A/Support/lsregister -kill -r -domain local -domain system -domain user\r\n\r\nlsserver still rebuilds the database when the user logs in, causing a significant Disk I/O bottleneck.\r\n\r\nFor ATSServer we could find no commands to pre-build the Font Caches. So it runs every time, causing a significant Disk I/O bottleneck.\r\n\r\n\r\n***********************\r\nSuggested Resolution:\r\n\r\n-> We would like to see documentation of all the things loginwindow does, e.g. all processes that it spawns and under what conditions, and  would like to have more control over how loginwindow.app calls lsregister and ATSServer, and oter daemons.\r\n\r\n-> Consistent behavior for manually running lsregister, and a command to manually build the Font Cache (for ATSServer) per user, and any other system Caches.\r\n\r\n***********************\r\n\r\n\r\n\r\nBelow is an overview of our attached troubleshooting files captured using opensnoop -cv & fs_usage. we found opensnoop useful for lsregister and fs_usage more useful for ATSServer.\r\n\r\n---------------lsregister (from opensnoop transcript)--------------------------\r\n\r\n\r\nLogin begins at:\r\n2010 Jan 13 11:53:03     0    518 authorizationho   3 Mac OS X             /System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/Metadata.framework\r\n\r\n\r\n\r\n-> lsregister starts at:\r\n\r\n2010 Jan 13 11:53:11 695902    860 lsregister     3 Mac OS X             /System/Library/Frameworks/DiskArbitration.framework/Versions/A/DiskArbitration\r\n\r\n\r\n-> Session doesn't reach a usable state (desktop visible, dock started, finder running, etc.) until approx:\r\n\r\n2010 Jan 13 11:54:14 695902    860 lsregister     8 Mac OS X             /.vol/234881026/30313720//Contents/PkgInfo\r\n\r\n-> lsregister Ends at:\r\n\r\n2010 Jan 13 11:55:18 695902    896 lssave         3 Mac OS X             /Library/Caches/com.apple.LaunchServices-023695902.csstore~\r\n\r\n\r\n\r\n-------------------ATSServer (from fs_usage transcript)-----------------------\r\n\r\n-> Login begins\r\n\r\n10:51:59  read                                                                                               0.155162 W DirectorySer\r\n\r\n\r\n\r\n-> ATSServer starts at:\r\n\r\n10:52:01  PAGE_IN                                                                                            0.000004   ATSServer\r\n\r\n\r\n-> Login session waiting until...\r\n\r\n\r\n-> Session usable at:\r\n10:52:33  PAGE_IN                                                                                            0.000006   Finder\r\n\r\n\r\n\r\n-> ATSServer ends at:\r\n\r\n10:52:40  close                                                                                              0.000010   ATSServer"
    email: mdwhitis@gmail.com
    modified: "2011-08-28T05:42:59.87391Z"
    number: "7538960"
    number_intvalue: 7538960
    originated: 13-Jan-2010
    parent_number: '&{NULL_VALUE}'
    product: Os X
    product_version: 10.5.8
    reproducible: Yes
    resolved: ""
    status: Open
    title: '1 minute 15 seconds login times. Cause: loginwindow.app, lsregister, ATSServer'
