apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "8326299"
    labels:
        datastore_id: "578404"
data:
    classification: Crash/Hang/Data Loss
    created: "2010-08-22T13:57:47.383158Z"
    description: "I am having troubles with an application designed to run on both iPad (iOS 3.2.2) and iPhone 3GS (iOS 4.0.2).\r\n\r\nThis application makes use of a stencil buffer to limit shadow projection (I do a pass over geometry designed to project their shapes onto a plane using a specified color to paint the shadows with [and I blend it with the ground's texture]) as well as to avoid double blending (painting more than one shadow over the same pixel). This is supported under both Simulator and Device runtimes, just that the Simulator is not able to support packed depth-stencil yet, so I have a separate path for it (using separate depth and shadow buffers).\r\n\r\nThe scene also features rolling physics (thanks to Bullet) and a single Lamp light exported from Blender. The main game engine backbone is powered by the opensource SIO2 engine (version 1.4.x).\r\n\r\nI am also supporting the use of the CADisplayLink in EAGLView (with an NSTimer fallback) which calls the main rendering loop every 1/60th of a second. MultiTasking is supported correctly under iOS4.\r\n\r\nThe problem does not happen in either iPhone or iPad Simulators and it does not happen on the iPhone 3GS device, it only happens when the program runs on the iPad itself and it does happen in a strange way...\r\nSometimes I am able to launch the app, close it by pressing the Home button, re-open it again... and the app would sometimes work (only to hang the third time I launched it back to back) and other times it would fail... when it hangs... well it is like the app would be played out in extreme slow motion... the screen would be black for a while, then I would see a screen from my app... then it would be black again... etc...\r\nSometimes, the app would launch just fine and it would show a kind of \"corrupted\" screen (with a portion of the loading screen used).\r\nLaunching app the first time after device reboot (and exited using the Home button):\r\n\r\nSteps to Reproduce: Compile target app and run it on iPad device.\r\n\r\nExpected Results: app can be closed and re-opened.\r\n\r\nActual Results: the app sometimes hangs due to the SGX GPU becoming unresponsive/hanging.\r\n\r\nRegression:\r\n\r\nNotes: other details posted on the dev forums at https://devforums.apple.com/message/279249\r\n\r\nand\r\n\r\nhttp://forum.sio2interactive.com/viewtopic.php?f=3&t=814&sid=5b02ac2d6d57b0971737117446d5c780\r\n\r\n\r\nEdit (solution):\r\n\r\nhttps://devforums.apple.com/message/294345#294345\r\n\r\nThanks to the hint provided by user \"frogblast\" I was able to fix the problem in my code.\r\n\r\nI was not disabling the client state when rendering multiple objects through glDrawElements() and doing it correctly for every function which ended up calling glDrawElements() to render an object (and the data inside its VBO) did fix my issue on the iPad... I still do not understand why this problem did not manifest itself when the app ran on the iPhone 3GS.\r\n\r\n\r\nExample of a function after the fix:\r\n-(void) renderShadowCasters {\r\n\tglEnableClientState( GL_VERTEX_ARRAY);\r\n\tglEnableClientState( GL_TEXTURE_COORD_ARRAY );\r\n\t\r\n\tint i = 0;\r\n\tint _mask = SIO2_RENDER_SOLID_OBJECT | SIO2_LAMP | SIO2_RENDER_CLIPPED_OBJECT;\r\n\t{\r\n\t\t// Render our shadow objects\r\n\t\twhile( i < sio2Ptr->_SIO2resource->n_object )\r\n\t\t{\r\n\t\t\tSIO2object *_SIO2object = ( SIO2object * )sio2Ptr->_SIO2resource->_SIO2object[ i ];\r\n\t\t\tif( (sio2IsStateEnabled( _SIO2object->flags, SIO2_OBJECT_SHADOW )) &&\r\n\t\t\t   (0 != sio2StringCmp(_SIO2object->name, (const char*)\"object/Plane\")) )\r\n\t\t\t{\r\n\t\t\t\tDPRINTF (\"Object's name %s\\n\", _SIO2object->name);\r\n\t\t\t\tif( (_SIO2object->type & SIO2_OBJECT_SOLID ) && _SIO2object->dst )\r\n\t\t\t\t{\r\n\t\t\t\t\tsio2ObjectRender( _SIO2object,\r\n\t\t\t\t\t\t\t\t\t sio2Ptr->_SIO2window,\t\t\t\r\n\t\t\t\t\t\t\t\t\t sio2Ptr->_SIO2camera,\r\n\t\t\t\t\t\t\t\t\t !( _mask & SIO2_RENDER_NO_MATERIAL ),\r\n\t\t\t\t\t\t\t\t\t !( _mask & SIO2_RENDER_NO_MATRIX ) );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t++i;\r\n\t\t}\r\n\t}\r\n\tglDisableClientState( GL_VERTEX_ARRAY);\r\n\tglDisableClientState( GL_TEXTURE_COORD_ARRAY );\r\n}"
    email: Panajev@gmail.com
    modified: "2011-08-28T05:40:10.649273Z"
    number: "8326299"
    number_intvalue: 8326299
    originated: 18-Aug-2010 11:30 PM
    parent_number: '&{NULL_VALUE}'
    product: iPad SDK
    product_version: iOS 4.0.2 SDK
    reproducible: Always
    resolved: Yes
    status: Closed
    title: 'SGX hangs, SGX: Microkernel unresponsive'
