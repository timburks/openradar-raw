apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "8287193"
    labels:
        datastore_id: "574401"
data:
    classification: Security
    created: "2010-08-09T15:10:32.704435Z"
    description: "09-Aug-2010 07:07 PM Alexander Potapenko:\r\nSummary:\r\n\r\nValgrind (http://valgrind.org) reports invalid reads/writes performed by DKeyHas8Words in /usr/lib/libSystem.B.dylib on OS X 10.6\r\nAccesses below the stack pointer may possibly corrupt the program state and lead to crashes and/or undetermined behavior.\r\n\r\nSteps to Reproduce:\r\n\r\na) Build and run Chromium base_unittests under Valgrind on OS X 10.6:\r\n 1. Build base_unittests as described at http://code.google.com/p/chromium/wiki/MacBuildInstructions (use xcodebuild -project  base.xcodeproj -configuration Debug -target base_unittests to build)\r\n 2. Check out Valgrind for Snow Leopard (see http://sites.google.com/a/chromium.org/dev/developers/how-tos/using-valgrind/building-valgrind)\r\n 3. Run EncryptorTest.EncryptDecrypt under Valgrind:\r\n    $ tools/valgrind/valgrind.sh xcodebuild/Debug/base_unittests --gtest_filter=EncryptorTest.EncryptDecrypt\r\n\r\n==25443== Memcheck, a memory error detector\r\n==25443== Copyright (C) 2002-2010, and GNU GPL'd, by Julian Seward et al.\r\n==25443== Using Valgrind-3.6.0.SVN and LibVEX; rerun with -h for copyright info\r\n==25443== Command: xcodebuild/Debug/base_unittests --gtest_filter=EncryptorTest.EncryptDecrypt\r\n==25443== \r\n--25443-- xcodebuild/Debug/base_unittests:\r\n--25443-- dSYM directory is missing; consider using --dsymutil=yes\r\nNote: Google Test filter = EncryptorTest.EncryptDecrypt\r\n[==========] Running 1 test from 1 test case.\r\n[----------] Global test environment set-up.\r\n[----------] 1 test from EncryptorTest\r\n[ RUN      ] EncryptorTest.EncryptDecrypt\r\n==25443== Invalid write of size 4\r\n==25443==    at 0x2B4E309: DKeyHas8Words (in /usr/lib/libSystem.B.dylib)\r\n==25443==  Address 0xbffff434 is just below the stack ptr.  To suppress, use: --workaround-gcc296-bugs=yes\r\n==25443== \r\n==25443== Invalid write of size 4\r\n==25443==    at 0x2B4E30F: DKeyHas8Words (in /usr/lib/libSystem.B.dylib)\r\n==25443==  Address 0xbffff438 is just below the stack ptr.  To suppress, use: --workaround-gcc296-bugs=yes\r\n==25443== \r\n==25443== Invalid write of size 4\r\n==25443==    at 0x2B4E315: DKeyHas8Words (in /usr/lib/libSystem.B.dylib)\r\n==25443==  Address 0xbffff43c is just below the stack ptr.  To suppress, use: --workaround-gcc296-bugs=yes\r\n==25443== \r\n==25443== Invalid write of size 4\r\n==25443==    at 0x2B4E31B: DKeyHas8Words (in /usr/lib/libSystem.B.dylib)\r\n==25443==  Address 0xbffff440 is just below the stack ptr.  To suppress, use: --workaround-gcc296-bugs=yes\r\n...\r\n==25443== Invalid read of size 4\r\n==25443==    at 0x2B4E6F1: DKeyHas8Words (in /usr/lib/libSystem.B.dylib)\r\n==25443==  Address 0xbffff428 is just below the stack ptr.  To suppress, use: --workaround-gcc296-bugs=yes\r\n==25443== \r\n==25443== Invalid read of size 4\r\n==25443==    at 0x2B4E701: DKeyHas8Words (in /usr/lib/libSystem.B.dylib)\r\n==25443==  Address 0xbffff42c is just below the stack ptr.  To suppress, use: --workaround-gcc296-bugs=yes\r\n==25443== \r\n==25443== Invalid read of size 4\r\n==25443==    at 0x2B4E711: DKeyHas8Words (in /usr/lib/libSystem.B.dylib)\r\n==25443==  Address 0xbffff430 is just below the stack ptr.  To suppress, use: --workaround-gcc296-bugs=yes\r\n==25443== \r\n[       OK ] EncryptorTest.EncryptDecrypt (976 ms)\r\n[----------] 1 test from EncryptorTest (1066 ms total)\r\n\r\n[----------] Global test environment tear-down\r\n[==========] 1 test from 1 test case ran. (1152 ms total)\r\n[  PASSED  ] 1 test.\r\n  YOU HAVE 6 FLAKY TESTS\r\n\r\n  YOU HAVE 2 tests with ignored failures (FAILS prefix)\r\n\r\n==25443== \r\n==25443== HEAP SUMMARY:\r\n==25443==     in use at exit: 277,931 bytes in 2,713 blocks\r\n==25443==   total heap usage: 24,337 allocs, 21,624 frees, 1,006,745 bytes allocated\r\n==25443== \r\n==25443== LEAK SUMMARY:\r\n==25443==    definitely lost: 0 bytes in 0 blocks\r\n==25443==    indirectly lost: 0 bytes in 0 blocks\r\n==25443==      possibly lost: 5,046 bytes in 206 blocks\r\n==25443==    still reachable: 263,136 bytes in 2,462 blocks\r\n==25443==         suppressed: 9,749 bytes in 45 blocks\r\n==25443== Rerun with --leak-check=full to see details of leaked memory\r\n==25443== \r\n==25443== For counts of detected and suppressed errors, rerun with: -v\r\n==25443== ERROR SUMMARY: 100 errors from 36 contexts (suppressed: 0 from 0)\r\n\r\n b) Inspect /usr/lib/libSystem.B.dylib using gobjdump:\r\n    $ gobjdump -d /usr/lib/libSystem.B.dylib | less\r\n    <search for DKeyHas8Words>\r\n000000000007cac6 <DKeyHas8Words>:\r\n   7cac6:       66 0f 7e 07             movd   %xmm0,(%rdi)\r\n   7caca:       66 0f 7e 4f 04          movd   %xmm1,0x4(%rdi)\r\n   7cacf:       66 0f 7e 57 08          movd   %xmm2,0x8(%rdi)\r\n   7cad4:       66 0f 7e 5f 0c          movd   %xmm3,0xc(%rdi)\r\n   7cad9:       66 0f 6e 46 10          movd   0x10(%rsi),%xmm0\r\n   7cade:       66 0f 6e 4e 14          movd   0x14(%rsi),%xmm1\r\n   7cae3:       66 0f 6e 56 18          movd   0x18(%rsi),%xmm2\r\n   7cae8:       66 0f 6e 5e 1c          movd   0x1c(%rsi),%xmm3\r\n   7caed:       48 8d 35 8c 09 0e 00    lea    0xe098c(%rip),%rsi        # 15d480 <_AESRcon>\r\n   7caf4:       48 8d 1d 91 09 0e 00    lea    0xe0991(%rip),%rbx        # 15d48c <_AESInvMixColumnTable>\r\n   7cafb:       48 8d 15 8a 39 0e 00    lea    0xe398a(%rip),%rdx        # 16048c <_AESSubBytesWordTable>\r\n   7cb02:       48 c7 c5 40 ff ff ff    mov    $0xffffffffffffff40,%rbp\r\n   7cb09:       48 29 ef                sub    %rbp,%rdi\r\n   7cb0c:       66 0f 7e 44 24 e8       movd   %xmm0,-0x18(%rsp)\r\n   7cb12:       66 0f 7e 4c 24 ec       movd   %xmm1,-0x14(%rsp)\r\n   7cb18:       66 0f 7e 54 24 f0       movd   %xmm2,-0x10(%rsp)\r\n   7cb1e:       66 0f 7e 5c 24 f4       movd   %xmm3,-0xc(%rsp)\r\n   7cb24:       66 0f 7e c0             movd   %xmm0,%eax\r\n   7cb28:       e8 c7 fa ff ff          callq  7c5f4 <InvMixColumn>\r\n   7cb2d:       66 0f 7e 7c 2f 10       movd   %xmm7,0x10(%rdi,%rbp,1)\r\n\r\nNote the movd instructions reading and writing the memory below %rsp"
    email: ramosian.glider@gmail.com
    modified: "2011-08-28T05:40:19.043335Z"
    number: "8287193"
    number_intvalue: 8287193
    originated: 09-Aug-2010 07:07 PM
    parent_number: '&{NULL_VALUE}'
    product: Mac OS X
    product_version: 'Darwin Kernel Version 10.4.0: Fri Apr 23 18:28:53 PDT 2010; root:xnu-1504.7.4~1/RELEASE_I386'
    reproducible: Always
    resolved: ""
    status: Open
    title: Valgrind reports reads/writes below stack pointer in DKeyHas8Words on OS X 10.6
