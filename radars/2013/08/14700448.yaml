apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "14700448"
    labels:
        datastore_id: "5242093484113920"
data:
    classification: Crash/Hang/Data Loss
    created: "2013-08-09T21:38:05.638161Z"
    description: "09-Aug-2013 02:14 PM Landon Fuller:\r\nSummary:\r\n\r\nWhen running the attached project under a debugger, the kernel will deadlock around proclist-related locks. This looks to be related to exit() being called while a Mach message response has not yet been dispatched.\r\n\r\nSteps to Reproduce:\r\n\r\nRun the attached project under a debugger.\r\n\r\nExpected Results:\r\n\r\nIt doesn't do anything useful, but it also doesn't deadlock your machine.\r\n\r\nActual Results:\r\n\r\nThe process itself will deadlock in the kernel. Any other code that acquires related locks will lock up, too. Rebooting will lock up, for the same reason.\r\n\r\nNotes:\r\n\r\nStack traces from a machine exhibiting this behavior:\r\n\r\ntask                vm_map              ipc_space          #acts   pid  process             io_policy    wq_state   command\r\n0xffffff802dc883a8  0xffffff802f5af220  0xffffff802c5c2ae0     3   280  0xffffff802f92a000                1  0  0   otest\r\n                    thread                thread_id           processor            pri io_policy   state    wait_queue          wait_event\r\n                    0xffffff802fb2c7e8      0x668   0xffffff80270bfc28    31              W      0xffffff80301c6400  0x0\r\n          \r\n                        kernel_stack=0xffffff8074ad8000\r\n                        stacktop=0xffffff8074adb4e0\r\n                        0xffffff8074adb4e0  0xffffff8026a2e8c1 <thread_invoke+1281>\r\n                        0xffffff8074adb560  0xffffff8026a2db8c <thread_block_reason+300>\r\n                        0xffffff8074adb5a0  0xffffff8026a13112 <get_active_thread> // actually ipc_mqueue_receive()\r\n                        0xffffff8074adb5c0  0xffffff8026a20f96 <mach_msg_rpc_from_kernel_body+278>\r\n                        0xffffff8074adb620  0xffffff8026a4da52 <mach_exception_raise+178>\r\n                        0xffffff8074adb6c0  0xffffff8026a1e43b <exception_deliver+523>\r\n                        0xffffff8074adbe70  0xffffff8026a1e6cd <bsd_exception+61>\r\n                        0xffffff8074adbe80  0xffffff8026d680b1 <issignal_locked+977>\r\n                        0xffffff8074adbf10  0xffffff8026d68d9f <bsd_ast+847>\r\n                        0xffffff8074adbf50  0xffffff8026a1b6e1 <ast_taken+209>\r\n                        0xffffff8074adbf90  0xffffff8026ab8c63 <i386_astintr+35>\r\n                        0xffffff8074adbfb0  0xffffff8026ace14c <return_from_trap+156>\r\n                        stackbottom=0xffffff8074adbfb0\r\n                    thread                thread_id           processor            pri io_policy   state    wait_queue          wait_event\r\n                    0xffffff802d16c270[WQ]  0x673   0xffffff80270bfc28    31              W\t    0xffffff802d790bc0  0x0\r\n                        continuation=0xffffff8026d4f9c0 <kqueue_scan_continue>\r\n                    thread                thread_id           processor            pri io_policy   state    wait_queue          wait_event\r\n                    0xffffff802e6fdb58      0x68b   0xffffff80270bfc28    31              W\t    0xffffff80605f4c00  0xffffff802f92a208\t \"unknown\"\r\n          \r\n                        kernel_stack=0xffffff8074a38000\r\n                        stacktop=0xffffff8074a3bce0\r\n                        0xffffff8074a3bce0  0xffffff8026a2e8c1 <thread_invoke+1281>\r\n                        0xffffff8074a3bd60  0xffffff8026a2db8c <thread_block_reason+300>\r\n                        0xffffff8074a3bda0  0xffffff8026a2664e <lck_mtx_sleep+78>\r\n                        0xffffff8074a3bdd0  0xffffff8026d69dd6 <_sleep+246>\r\n                        0xffffff8074a3be50  0xffffff8026d6a1c4 <msleep+116>\r\n                        0xffffff8074a3be90  0xffffff8026d6840d <sig_try_locked+93>\r\n                        0xffffff8074a3bed0  0xffffff8026d565d6 <exit1_internal+310>\r\n                        0xffffff8074a3bf40  0xffffff8026d56479 <exit+25>\r\n                        0xffffff8074a3bf50  0xffffff8026de16aa <unix_syscall64+522>\r\n                        0xffffff8074a3bfb0  0xffffff8026ace9c3 <hndl_unix_scall64+19>\r\n                        stackbottom=0xffffff8074a3bfb0\r\n\r\ntask                vm_map              ipc_space          #acts   pid  process             io_policy    wq_state   command\r\n0xffffff802e4a0af8  0xffffff802e44b570  0xffffff802c5c23f0     5   136  0xffffff802e4b9020                1  0  0   Terminal\r\n                    thread                thread_id           processor            pri io_policy   state    wait_queue          wait_event\r\n                    0xffffff802f4b5d98      0x32e   0xffffff80270bfc28    47              UW            0xffffff80605f4340  0xffffff802f92a15c\t \"proc_signstart\"\r\n          \r\n                        kernel_stack=0xffffff8074a98000\r\n                        stacktop=0xffffff8074a9b5e0\r\n                        0xffffff8074a9b5e0  0xffffff8026a2e8c1 <thread_invoke+1281>\r\n                        0xffffff8074a9b660  0xffffff8026a2db8c <thread_block_reason+300>\r\n                        0xffffff8074a9b6a0  0xffffff8026a2664e <lck_mtx_sleep+78>\r\n                        0xffffff8074a9b6d0  0xffffff8026d69dd6 <_sleep+246>\r\n                        0xffffff8074a9b750  0xffffff8026d6a1c4 <msleep+116>\r\n                        0xffffff8074a9b790  0xffffff8026d606cc <proc_transwait+92>\r\n                        0xffffff8074a9b7d0  0xffffff8026d605d5 <proc_iterate+597>\r\n                        0xffffff8074a9b840  0xffffff8026d6bb62 <sysctl_prochandle+418>\r\n                        0xffffff8074a9bd50  0xffffff8026d6e38f <sysctl_root+543>\r\n                        0xffffff8074a9bdb0  0xffffff8026d6e58b <userland_sysctl+187>\r\n                        0xffffff8074a9be90  0xffffff8026d6a800 <__sysctl+688>\r\n                        0xffffff8074a9bf50  0xffffff8026de16aa <unix_syscall64+522>\r\n                        0xffffff8074a9bfb0  0xffffff8026ace9c3 <hndl_unix_scall64+19>\r\n                        stackbottom=0xffffff8074a9bfb0\r\n                    thread                thread_id           processor            pri io_policy   state    wait_queue          wait_event\r\n                    0xffffff802f4ad4e0[WQ]  0x372   0xffffff80270bfc28    49              W\t    0xffffff802e7348c0  0x0\r\n                        continuation=0xffffff8026d4f9c0 <kqueue_scan_continue>\r\n                    thread                thread_id           processor            pri io_policy   state    wait_queue          wait_event\r\n                    0xffffff802f4a6780      0x38a   0xffffff80270bfc28    47              W\t    0xffffff802e734840  0x0\r\n\t\tThread Name: com.apple.terminal.low-disk-space-handler\r\n                        continuation=0xffffff8026d4f9c0 <kqueue_scan_continue>\r\n                    thread                thread_id           processor            pri io_policy   state    wait_queue          wait_event\r\n                    0xffffff802e3bc4e0      0x3c6   0xffffff80270bfc28    47              W\t    0xffffff80605f4f20  0xffffff802de6dec0\t \"piperd\"\r\n\t\tThread Name: com.apple.terminal.sigchld-handler\r\n          \r\n                        kernel_stack=0xffffff8074ab0000\r\n                        stacktop=0xffffff8074ab3c50\r\n                        0xffffff8074ab3c50  0xffffff8026a2e8c1 <thread_invoke+1281>\r\n                        0xffffff8074ab3cd0  0xffffff8026a2db8c <thread_block_reason+300>\r\n                        0xffffff8074ab3d10  0xffffff8026a2664e <lck_mtx_sleep+78>\r\n                        0xffffff8074ab3d40  0xffffff8026d69dd6 <_sleep+246>\r\n                        0xffffff8074ab3dc0  0xffffff8026d6a1c4 <msleep+116>\r\n                        0xffffff8074ab3e00  0xffffff8026d7a296 <pipe_read+214>\r\n                        0xffffff8074ab3e50  0xffffff8026d7693e <dofileread+174>\r\n                        0xffffff8074ab3ef0  0xffffff8026d76762 <read_nocancel+130>\r\n                        0xffffff8074ab3f50  0xffffff8026de16aa <unix_syscall64+522>\r\n                        0xffffff8074ab3fb0  0xffffff8026ace9c3 <hndl_unix_scall64+19>\r\n                        stackbottom=0xffffff8074ab3fb0\r\n                    thread                thread_id           processor            pri io_policy   state    wait_queue          wait_event\r\n                    0xffffff802f4a1578      0x3c9   0xffffff80270bfc28    44              R\r\n\t\tThread Name: com.apple.terminal.tty-io\r\n                        continuation=0xffffff8026ab23eb <thread_exception_return>"
    email: landon.j.fuller@gmail.com
    modified: "2013-08-09T21:38:05.63836Z"
    number: "14700448"
    number_intvalue: 14700448
    originated: 09-Aug-2013 02:14 PM
    parent_number: '&{NULL_VALUE}'
    product: OS X
    product_version: "12E55"
    reproducible: Always
    resolved: ""
    status: Open
    title: Kernel deadlock in mach exception handling
