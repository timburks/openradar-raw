apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "14056496"
    labels:
        datastore_id: "3064401"
data:
    classification: Crash/Hang/Data Loss
    created: "2013-06-04T08:27:59.672732Z"
    description: "21-Jun-2013 12:03 AM: Duplicate of 13128817 which is currently open.\r\n\r\n\r\n-----------[ original description ]----------\r\nSummary:\r\n\r\nAccessing the .hasProtectedContent property of AVURLAsset may cause a crash in\r\nthe mediaserverd. The Crash happens with a specific music file which is not\r\nDRM-protected, but has invalid id3-information at the beginning (see\r\nattachment Track_01.mp3).\r\n\r\n\r\nSteps to Reproduce:\r\n\r\nImport the sample file (Track_01.mp3) into the iOS media library using iTunes.\r\n\r\nPerform a MPMediaQuery and access the .hasProtectedContent property. I.e.:\r\n\r\n\tMPMediaItem *item = [query.items objectAtIndex: position];\r\n\tNSURL *assetURL = [item valueForProperty: MPMediaItemPropertyAssetURL];\r\n\tAVURLAsset *songAsset = [AVURLAsset URLAssetWithURL:assetURL options:nil];\r\n\r\n\tif (songAsset.hasProtectedContent) /* <-- mediaserverd crashes here */\r\n\t\tNSLog(@\"Item %d: %@ is DRM protected.\", position, assetURL.absoluteString);\r\n\r\n\r\n\r\nExpected Results:\r\n\r\n- mediaserverd must not crash\r\n- as the sample file is not DRM protected, the property should return NO\r\n- the iOS music player App should be able to playback the file\r\n\r\n\r\nActual Results:\r\n\r\n- mediaserverd crashes, see the stacktace below (a full crash report is \r\n  attached)\r\n- The device UI will block for a moment and a crash report of mediaserverd is \r\n  issued (see the device log).  \r\n- Not only my app is affected but the whole iOS UI including springboard.\r\n- The iOS music player app is affected too: Playback is not possible, the ui\r\n  blocks and mediaserverd crashes.\r\n\r\nHere is a stacktrace of the crashing thread in mediaserverd (a full crash report\r\nis attached)\r\n\r\nThread 20 name:  Dispatch queue: URLAssetWorkQueue\r\nThread 20 Crashed:\r\n0   CoreFoundation                  0x33311a42 CFDictionaryGetValue + 10\r\n1   AudioToolbox                    0x32eb1fc0 ID3FileStream::ProcessCommentFrame() + 136\r\n2   AudioToolbox                    0x32eb1924 ID3FileStream::ParseHeader(AudioFileStreamContinuation&) + 2584\r\n3   AudioToolbox                    0x32e4d1e2 AudioFileStreamWrapper::ParseBytes(unsigned long, void const*, unsigned long) + 154\r\n4   AudioToolbox                    0x32e4aa30 AudioFileStreamParseBytes + 132\r\n5   MediaToolbox                    0x3448ba84 PushBytesThroughParser + 392\r\n6   MediaToolbox                    0x3448afa6 FigAudioFileStreamFormatReaderCreateFromStream + 886\r\n7   MediaToolbox                    0x3448e7e6 InstantiateAudioFileStreamFormatReader + 98\r\n8   MediaToolbox                    0x343fd7b0 instantiateFormatReader + 48\r\n9   MediaToolbox                    0x343fcf1a FigFormatReaderCreateForStream + 218\r\n10  MediaToolbox                    0x3456cf80 EnsureFormatReaderCreated + 364\r\n11  MediaToolbox                    0x3456dac8 EnsureTracksArrayCreated + 44\r\n12  MediaToolbox                    0x3456f280 ProduceFormatReaderAssetProperty + 60\r\n13  MediaToolbox                    0x3456ba2c URLAssetPropertyWorkFunction + 232\r\n14  libdispatch.dylib               0x3b696eca _dispatch_queue_drain$VARIANT$mp + 138\r\n15  libdispatch.dylib               0x3b696dbc _dispatch_queue_invoke$VARIANT$mp + 36\r\n16  libdispatch.dylib               0x3b69791a _dispatch_root_queue_drain + 182\r\n17  libdispatch.dylib               0x3b697abc _dispatch_worker_thread2 + 80\r\n18  libsystem_c.dylib               0x3b6c7a0e _pthread_wqthread + 358\r\n19  libsystem_c.dylib               0x3b6c78a0 start_wqthread + 4\r\n\r\n\r\nRegression:\r\n\r\nUnknown.\r\n\r\nNotes:\r\n\r\nThe sample file may be broken and I understand that Apple cannot take care of\r\nall badly encoded music files in the world. But there might be many files out\r\nthere encoded with this buggy software and many users might be affected.\r\n\r\nThe file plays back on Max OS X 10.8.2 without problems (Quicklook, iTunes).\r\n\r\nThe OS X info window (Finder: go to file, cmd-i) displays the comment filed\r\nas \"RCK\". Maybe there is a wrong offset, because this is the id of the next\r\nfield TRCK (see hexdump \"Created by GripTRCK\").\r\n\r\n00000000  49 44 33 04 00 00 00 00  09 06 54 49 54 32 00 00  |ID3.......TIT2..|\r\n00000010  00 0e 00 00 03 54 69 6d  65 20 54 6f 20 52 65 6c  |.....Time To Rel|\r\n00000020  61 78 54 50 45 31 00 00  00 0e 00 00 03 54 68 65  |axTPE1.......The|\r\n00000030  20 4f 66 66 73 70 72 69  6e 67 54 41 4c 42 00 00  | OffspringTALB..|\r\n00000040  00 06 00 00 03 53 6d 61  73 68 54 43 4f 4e 00 00  |.....SmashTCON..|\r\n00000050  00 06 00 00 03 28 31 32  31 29 43 4f 4d 4d 00 00  |.....(121)COMM..|\r\n00000060  00 11 00 00 03 00 43 72  65 61 74 65 64 20 62 79  |......Created by|\r\n00000070  20 47 72 69 70 54 52 43  4b 00 00 00 02 00 00 03  | GripTRCK.......|\r\n00000080  31 54 52 44 43 00 00 00  05 00 00 03 31 39 39 34  |1TRDC.......1994|\r\n00000090  43 4f 4d 4d 00 00 00 68  00 00 00 65 6e 67 69 54  |COMM...h...engiT|\r\n000000a0  75 6e 4e 4f 52 4d 00 20  30 30 30 30 30 30 42 46  |unNORM. 000000BF|\r\n000000b0  20 30 30 30 30 30 30 44  39 20 30 30 30 30 30 37  | 000000D9 000007|\r\n000000c0  31 38 20 30 30 30 30 30  38 35 43 20 30 30 30 30  |18 0000085C 0000|\r\n000000d0  33 43 44 43 20 30 30 30  30 33 43 44 43 20 30 30  |3CDC 00003CDC 00|\r\n000000e0  30 30 34 45 36 31 20 30  30 30 30 35 33 43 41 20  |004E61 000053CA |\r\n000000f0  30 30 30 30 30 32 35 42  20 30 30 30 30 30 32 35  |0000025B 0000025|\r\n00000100  42 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |B...............|\r\n00000110  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|"
    email: thomas.mellenthin@gmail.com
    modified: "2013-06-21T06:04:36.914438Z"
    number: "14056496"
    number_intvalue: 14056496
    originated: 06/04/2013
    parent_number: '&{NULL_VALUE}'
    product: iOS SDK
    product_version: 6.1.3
    reproducible: Always
    resolved: ""
    status: Duplicate
    title: mediaserverd crashes when accessing .hasProtectedContent property
