apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "13244804"
    labels:
        datastore_id: "2731404"
data:
    classification: Other Bug
    created: "2013-02-19T19:10:08.605911Z"
    description: "19-Feb-2013 07:05 PM Robin Miller:\r\nSummary: \r\nWhen partitioning a disk into multiple GPT partitions using /usr/sbin/diskutil's partitionDisk verb, and giving 'R' for the size of a partition other than the last one, the size of the last partition is truncated by almost exactly the number of sectors given to the EFI partition at the beginning of the disk.\r\n\r\nSteps to Reproduce:\r\nUse diskutil partitionDisk to create 2 or more partitions, where the last partition has a specified size, and one of the other partitions has a requested size of 'R' to indicate that it should take up the remaining space. For example:\r\n\r\n# diskutil partitionDisk disk0 GPT jhfs+ 'apple' R jhfs+ 'banana' 3191831S jhfs+ 'pear' 3191831S jhfs+ 'grape' 3191831S\r\n\r\nExpected Results:\r\nOne would expect 5 partitions to be created, including the EFI partition as partition 1, with partitions 3, 4 and 5 having *equal* size (of 3191831 sectors minus the 262144 sectors (128MB) that diskutil gives to free space after each partition as noted in TN2166). Partition 2 would get the remainder of the space on the disk.\r\n\r\n\r\nActual Results:\r\nInstead, the last partition (partition 5) is 409688 sectors smaller than partitions 3 and 4. That number is very similar to the size of the EFI partition at the start of the disk (409600 sectors).\r\n\r\nIt appears as if when diskutil is calculating the size for the partition with size 'R', it takes into account the other partitions specified on the command line, but fails to account for the 200MB EFI partition that it will create as partition 1. The last partition then loses that space, rather than the partition with size 'R', which would be the expected behavior from a user's point of view. \r\n\r\nThis happens irrespective of the units used to specify partition sizes.\r\n\r\nPlease see Notes for the output from diskutil and gpt.\r\n\r\nRegression:\r\n\r\nNotes:\r\n\r\n\r\nlocalhost:Desktop root# diskutil partitionDisk disk0 jhfs+ 'apple' R jhfs+ 'banana' 3191831S jhfs+ 'pear' 3191831S jhfs+ 'grape' 3191831S\r\nStarted partitioning on disk0\r\nUnmounting disk\r\nCreating the partition map\r\nWaiting for the disks to reappear\r\nFormatting disk0s2 as Mac OS Extended (Journaled) with name apple\r\nInitialized /dev/rdisk0s2 as a 694 GB HFS Plus volume with a 57344k journal\r\nMounting disk\r\nFormatting disk0s3 as Mac OS Extended (Journaled) with name banana\r\nInitialized /dev/rdisk0s3 as a 1 GB HFS Plus volume with a 8192k journal\r\nMounting disk\r\nFormatting disk0s4 as Mac OS Extended (Journaled) with name pear\r\nInitialized /dev/rdisk0s4 as a 1 GB HFS Plus volume with a 8192k journal\r\nMounting disk\r\nFormatting disk0s5 as Mac OS Extended (Journaled) with name grape\r\nInitialized /dev/rdisk0s5 as a 1 GB HFS Plus volume with a 8192k journal\r\nMounting disk\r\nFinished partitioning on disk0\r\n/dev/disk0\r\n   #:                       TYPE NAME                    SIZE       IDENTIFIER\r\n   0:      GUID_partition_scheme                        *750.2 GB   disk0\r\n   1:                        EFI                         209.7 MB   disk0s1\r\n   2:                  Apple_HFS apple                   745.1 GB   disk0s2\r\n   3:                  Apple_HFS banana                  1.5 GB     disk0s3\r\n   4:                  Apple_HFS pear                    1.5 GB     disk0s4\r\n   5:                  Apple_HFS grape                   1.3 GB     disk0s5\r\nlocalhost:Desktop root# gpt -r show /dev/disk0\r\n       start        size  index  contents\r\n           0           1         PMBR\r\n           1           1         Pri GPT header\r\n           2          32         Pri GPT table\r\n          34           6        \r\n          40      409600      1  GPT part - C12A7328-F81F-11D2-BA4B-00A0C93EC93B\r\n      409640  1455311536      2  GPT part - 48465300-0000-11AA-AA11-00306543ECAC\r\n  1455721176      262144        \r\n  1455983320     2929688      3  GPT part - 48465300-0000-11AA-AA11-00306543ECAC\r\n  1458913008      262144        \r\n  1459175152     2929688      4  GPT part - 48465300-0000-11AA-AA11-00306543ECAC\r\n  1462104840      262144        \r\n  1462366984     2520000      5  GPT part - 48465300-0000-11AA-AA11-00306543ECAC\r\n  1464886984      262151        \r\n  1465149135          32         Sec GPT table\r\n  1465149167           1         Sec GPT header\r\nlocalhost:Desktop root#"
    email: robincello@gmail.com
    modified: "2013-02-19T19:10:08.60618Z"
    number: "13244804"
    number_intvalue: 13244804
    originated: 19-Feb-2013 07:05 PM
    parent_number: '&{NULL_VALUE}'
    product: Mac OS X
    product_version: 10.8.2
    reproducible: Always
    resolved: ""
    status: Open
    title: diskutil fails to take into account EFI partition size when creating partitions
