apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: FB13278576
    labels:
        datastore_id: "5557137778409472"
data:
    classification: ""
    created: "2023-10-16T16:05:27.232136Z"
    description: "I've encountered an issue with Xcode 15 when using Xcode 14 projects targeting iOS 11 (in IPHONEOS_DEPLOYMENT_TARGET). This issue leads to app crashes on devices running iOS versions older than 17.0, specifically when NW* (Network) APIs are called. The issue might be caused by the improper loading of the Network library and may be related to Xcode 15 requiring iOS 12 as the minimum deployment target (it prints a warning but doesnâ€™t fail the build).\r\n\r\nRepro steps:\r\n1. Create an Xcode 14 project with iOS 11 as the deployment target..\r\n2. Add some code that uses the Network module, like:\r\n```\r\nimport Network\r\n\r\nif #available(iOS 12.0, *) {\r\n    _ = NWEndpoint.Host(\"example.com\")\r\n}\r\n```\r\n3. Run the app on device with iOS 16.5 - no warnings are printed and the app runs OK.\r\n4. Open the project in Xcode 15.0 (15A240d). A warning appears during the build (and doesn't prevent a successful build):\r\n```\r\nThe iOS deployment target 'IPHONEOS_DEPLOYMENT_TARGET' is set to 11.0, but the range of supported deployment target versions is 12.0 to 17.0.99.\r\n```\r\n5. Run the app on a real device with iOS 16.5 or older, and the app crashes on the NWEndpoint.Host call (crash report attached).\r\n\r\nExpected result:\r\n- The app should not crash on iOS 16.5 or older devices.\r\n- Alternatively, Xcode 15 should fail the build if the iOS 11 deployment target is not properly supported.\r\n\r\nActual result:\r\n- The build succeeds, but the app crashes, which is not the expected behavior for most developers.\r\n\r\n\r\n---------------------------------------------------------\r\n\r\nAttached crash report:\r\n\r\n-------------------------------------\r\nTranslated Report (Full Report Below)\r\n-------------------------------------\r\n\r\nIncident Identifier: BB94F2F5-8CA5-457C-B996-1A5944EDAFAD\r\nCrashReporter Key:   462baf0216af8ce11d65c77ed2fa483b8d314d3b\r\nHardware Model:      iPhone14,3\r\nProcess:             X14AppForOS11 [726]\r\nPath:                /private/var/containers/Bundle/Application/DE4EAD8E-CA6B-4335-B57B-28745835CDA2/X14AppForOS11.app/X14AppForOS11\r\nIdentifier:          com.example.X14AppForOS11\r\nVersion:             1.0 (1)\r\nCode Type:           ARM-64 (Native)\r\nRole:                Foreground\r\nParent Process:      launchd [1]\r\nCoalition:           com.example.X14AppForOS11 [579]\r\n\r\nDate/Time:           2023-10-16 15:33:59.2079 +0200\r\nLaunch Time:         2023-10-16 15:33:59.0356 +0200\r\nOS Version:          iPhone OS 16.6 (20G75)\r\nRelease Type:        User\r\nBaseband Version:    2.80.01\r\nReport Version:      104\r\n\r\nException Type:  EXC_BAD_ACCESS (SIGABRT)\r\nException Subtype: KERN_INVALID_ADDRESS at 0x0000000000000000\r\nException Codes: 0x0000000000000001, 0x0000000000000000\r\nVM Region Info: 0 is not in any region.  Bytes before following region: 4309024768\r\n      REGION TYPE                 START - END      [ VSIZE] PRT/MAX SHRMOD  REGION DETAIL\r\n      UNUSED SPACE AT START\r\n--->  \r\n      __TEXT                   100d68000-100d80000 [   96K] r-x/r-x SM=COW  ...X14AppForOS11\r\nTermination Reason: SIGNAL 6 Abort trap: 6\r\nTerminating Process: X14AppForOS11 [726]\r\n\r\nTriggered by Thread:  0\r\n\r\nApplication Specific Information:\r\nabort() called\r\n\r\n\r\nThread 0 name:   Dispatch queue: com.apple.main-thread\r\nThread 0 Crashed:\r\n0   libsystem_kernel.dylib        \t       0x1e7cb1578 __pthread_kill + 8\r\n1   libsystem_pthread.dylib       \t       0x208b2c118 pthread_kill + 267\r\n2   libsystem_c.dylib             \t       0x1b021c178 abort + 179\r\n3   ...g_rt.asan_ios_dynamic.dylib\t       0x101566f14 __sanitizer::Abort() + 68\r\n4   ...g_rt.asan_ios_dynamic.dylib\t       0x101566604 __sanitizer::Die() + 212\r\n5   ...g_rt.asan_ios_dynamic.dylib\t       0x10154b0d0 __asan::ScopedInErrorReport::~ScopedInErrorReport() + 1124\r\n6   ...g_rt.asan_ios_dynamic.dylib\t       0x1015478a0 __asan::ReportDeadlySignal(__sanitizer::SignalContext const&) + 344\r\n7   ...g_rt.asan_ios_dynamic.dylib\t       0x101546c98 __asan::AsanOnDeadlySignal(int, void*, void*) + 100\r\n8   libsystem_platform.dylib      \t       0x208a90214 _sigtramp + 55\r\n9   X14AppForOS11                 \t       0x100d6c550 ViewController.viewDidLoad() + 1360\r\n10  X14AppForOS11                 \t       0x100d6ca4c @objc ViewController.viewDidLoad() + 144\r\n11  UIKitCore                     \t       0x1ab0d78f8 -[UIViewController _sendViewDidLoadWithAppearanceProxyObjectTaggingEnabled] + 83\r\n12  UIKitCore                     \t       0x1aad7414c -[UIViewController loadViewIfRequired] + 711\r\n13  UIKitCore                     \t       0x1aad73e64 -[UIViewController view] + 23\r\n14  UIKitCore                     \t       0x1aaf5bd48 -[UIWindow addRootViewControllerViewIfPossible] + 135\r\n15  UIKitCore                     \t       0x1aaf5bc3c -[UIWindow _updateLayerOrderingAndSetLayerHidden:actionBlock:] + 215\r\n16  UIKitCore                     \t       0x1aaf5b4e0 -[UIWindow _setHidden:forced:] + 255\r\n17  UIKit                         \t       0x233180ab8 -[UIWindowAccessibility _orderFrontWithoutMakingKey] + 91\r\n18  UIKitCore                     \t       0x1ab0aeea8 -[UIWindow _mainQueue_makeKeyAndVisible] + 39\r\n19  UIKitCore                     \t       0x1ab0ae814 -[UIApplication _callInitializationDelegatesWithActions:forCanvas:payload:fromOriginatingProcess:] + 2983\r\n20  UIKitCore                     \t       0x1ab0ad768 -[UIApplication _runWithMainScene:transitionContext:completion:] + 855\r\n21  UIKitCore                     \t       0x1ab0ad3b4 -[_UISceneLifecycleMultiplexer completeApplicationLaunchWithFBSScene:transitionContext:] + 131\r\n22  UIKitCore                     \t       0x1aadf5664 _UIScenePerformActionsWithLifecycleActionMask + 111\r\n23  UIKitCore                     \t       0x1ab133850 __101-[_UISceneLifecycleMultiplexer _evalTransitionToSettings:fromSettings:forceExit:withTransitionStore:]_block_invoke + 215\r\n24  UIKitCore                     \t       0x1aafe5c5c -[_UISceneLifecycleMultiplexer _performBlock:withApplicationOfDeactivationReasons:fromReasons:] + 219\r\n25  UIKitCore                     \t       0x1aafe5a84 -[_UISceneLifecycleMultiplexer _evalTransitionToSettings:fromSettings:forceExit:withTransitionStore:] + 619\r\n26  UIKitCore                     \t       0x1aafe5634 -[_UISceneLifecycleMultiplexer uiScene:transitionedFromState:withTransitionContext:] + 251\r\n27  UIKitCore                     \t       0x1aafe5500 __186-[_UIWindowSceneFBSSceneTransitionContextDrivenLifecycleSettingsDiffAction _performActionsForUIScene:withUpdatedFBSScene:settingsDiff:fromSettings:transitionContext:lifecycleActionType:]_block_invoke + 147\r\n28  UIKitCore                     \t       0x1ab6d2a68 +[BSAnimationSettings(UIKit) tryAnimatingWithSettings:fromCurrentState:actions:completion:] + 735\r\n29  UIKitCore                     \t       0x1ab771074 _UISceneSettingsDiffActionPerformChangesWithTransitionContextAndCompletion + 223\r\n30  UIKitCore                     \t       0x1aae92c70 -[_UIWindowSceneFBSSceneTransitionContextDrivenLifecycleSettingsDiffAction _performActionsForUIScene:withUpdatedFBSScene:settingsDiff:fromSettings:transitionContext:lifecycleActionType:] + 315\r\n31  UIKitCore                     \t       0x1ab3041ac __64-[UIScene scene:didUpdateWithDiff:transitionContext:completion:]_block_invoke.223 + 555\r\n32  UIKitCore                     \t       0x1aaf63c60 -[UIScene _emitSceneSettingsUpdateResponseForCompletion:afterSceneUpdateWork:] + 215\r\n33  UIKitCore                     \t       0x1aaf63ad0 -[UIScene scene:didUpdateWithDiff:transitionContext:completion:] + 243\r\n34  UIKitCore                     \t       0x1aaf63028 -[UIApplication workspace:didCreateScene:withTransitionContext:completion:] + 519\r\n35  UIKitCore                     \t       0x1aaf62db4 -[UIApplicationSceneClientAgent scene:didInitializeWithEvent:completion:] + 287\r\n36  FrontBoardServices            \t       0x1bed702e4 -[FBSScene _callOutQueue_agent_didCreateWithTransitionContext:completion:] + 343\r\n37  FrontBoardServices            \t       0x1bedb0068 __92-[FBSWorkspaceScenesClient createSceneWithIdentity:parameters:transitionContext:completion:]_block_invoke.80 + 119\r\n38  FrontBoardServices            \t       0x1bed74120 -[FBSWorkspace _calloutQueue_executeCalloutFromSource:withBlock:] + 167\r\n39  FrontBoardServices            \t       0x1bedafcc0 __92-[FBSWorkspaceScenesClient createSceneWithIdentity:parameters:transitionContext:completion:]_block_invoke + 359\r\n40  libdispatch.dylib             \t       0x1b01bbeac _dispatch_client_callout + 19\r\n41  libdispatch.dylib             \t       0x1b01bf91c _dispatch_block_invoke_direct + 263\r\n42  FrontBoardServices            \t       0x1bed7e24c __FBSSERIALQUEUE_IS_CALLING_OUT_TO_A_BLOCK__ + 51\r\n43  FrontBoardServices            \t       0x1bed7dde8 -[FBSSerialQueue _targetQueue_performNextIfPossible] + 219\r\n44  FrontBoardServices            \t       0x1bed80694 -[FBSSerialQueue _performNextFromRunLoopSource] + 27\r\n45  CoreFoundation                \t       0x1a8dbe128 __CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__ + 27\r\n46  CoreFoundation                \t       0x1a8dca7b4 __CFRunLoopDoSource0 + 175\r\n47  CoreFoundation                \t       0x1a8d4f648 __CFRunLoopDoSources0 + 339\r\n48  CoreFoundation                \t       0x1a8d650d4 __CFRunLoopRun + 827\r\n49  CoreFoundation                \t       0x1a8d6a3ec CFRunLoopRunSpecific + 611\r\n50  GraphicsServices              \t       0x1e428035c GSEventRunModal + 163\r\n51  UIKitCore                     \t       0x1ab0f6f58 -[UIApplication _run] + 887\r\n52  UIKitCore                     \t       0x1ab0f6bbc UIApplicationMain + 339\r\n53  libswiftUIKit.dylib           \t       0x1b17840b0 UIApplicationMain(_:_:_:_:) + 103\r\n54  X14AppForOS11                 \t       0x100d6f490 static UIApplicationDelegate.main() + 120\r\n55  X14AppForOS11                 \t       0x100d6f3a4 static AppDelegate.$main() + 364\r\n56  X14AppForOS11                 \t       0x100d6f9f4 main + 28\r\n57  dyld                          \t       0x1c829cdec start + 2219\r\n\r\nThread 1:\r\n0   libsystem_pthread.dylib       \t       0x208b25b74 start_wqthread + 0\r\n\r\nThread 2 name:   Dispatch queue: com.apple.root.default-qos\r\nThread 2:\r\n0   libsystem_kernel.dylib        \t       0x1e7cab7dc __ulock_wait + 8\r\n1   libdispatch.dylib             \t       0x1b01bc89c _dlock_wait + 55\r\n2   libdispatch.dylib             \t       0x1b01bc650 _dispatch_thread_event_wait_slow + 55\r\n3   libdispatch.dylib             \t       0x1b01cb714 __DISPATCH_WAIT_FOR_QUEUE__ + 367\r\n4   libdispatch.dylib             \t       0x1b01cb2c0 _dispatch_sync_f_slow + 147\r\n5   AXCoreUtilities               \t       0x1b3e8c554 AXPerformBlockSynchronouslyOnMainThread + 107\r\n6   AccessibilityUtilities        \t       0x1b22e1ad0 ___AXSharedDisplayManager_block_invoke_2 + 39\r\n7   libdispatch.dylib             \t       0x1b01ba320 _dispatch_call_block_and_release + 31\r\n8   libdispatch.dylib             \t       0x1b01bbeac _dispatch_client_callout + 19\r\n9   libdispatch.dylib             \t       0x1b01bef8c _dispatch_queue_override_invoke + 787\r\n10  libdispatch.dylib             \t       0x1b01cd944 _dispatch_root_queue_drain + 395\r\n11  libdispatch.dylib             \t       0x1b01ce158 _dispatch_worker_thread2 + 163\r\n12  libsystem_pthread.dylib       \t       0x208b25da0 _pthread_wqthread + 227\r\n13  libsystem_pthread.dylib       \t       0x208b25b7c start_wqthread + 7\r\n\r\nThread 3:\r\n0   libsystem_pthread.dylib       \t       0x208b25b74 start_wqthread + 0\r\n\r\nThread 4:\r\n0   libsystem_pthread.dylib       \t       0x208b25b74 start_wqthread + 0\r\n\r\nThread 5 name:  com.apple.uikit.eventfetch-thread\r\nThread 5:\r\n0   libsystem_kernel.dylib        \t       0x1e7caaca4 mach_msg2_trap + 8\r\n1   libsystem_kernel.dylib        \t       0x1e7cbdb74 mach_msg2_internal + 79\r\n2   libsystem_kernel.dylib        \t       0x1e7cbde4c mach_msg_overwrite + 539\r\n3   libsystem_kernel.dylib        \t       0x1e7cab1e8 mach_msg + 23\r\n4   CoreFoundation                \t       0x1a8d64024 __CFRunLoopServiceMachPort + 159\r\n5   CoreFoundation                \t       0x1a8d65250 __CFRunLoopRun + 1207\r\n6   CoreFoundation                \t       0x1a8d6a3ec CFRunLoopRunSpecific + 611\r\n7   Foundation                    \t       0x1a2fdefb4 -[NSRunLoop(NSRunLoop) runMode:beforeDate:] + 211\r\n8   Foundation                    \t       0x1a2fdee9c -[NSRunLoop(NSRunLoop) runUntilDate:] + 63\r\n9   UIKitCore                     \t       0x1ab229cc8 -[UIEventFetcher threadMain] + 415\r\n10  Foundation                    \t       0x1a2ff8524 __NSThread__start__ + 715\r\n11  libsystem_pthread.dylib       \t       0x208b266b8 _pthread_start + 147\r\n12  libsystem_pthread.dylib       \t       0x208b25b88 thread_start + 7\r\n\r\nThread 6:\r\n0   libsystem_pthread.dylib       \t       0x208b25b74 start_wqthread + 0\r\n\r\nThread 7 name:   Dispatch queue: com.apple.UIKit.KeyboardManagement\r\nThread 7:\r\n0   libsystem_kernel.dylib        \t       0x1e7cab7dc __ulock_wait + 8\r\n1   libdispatch.dylib             \t       0x1b01bc89c _dlock_wait + 55\r\n2   libdispatch.dylib             \t       0x1b01bc650 _dispatch_thread_event_wait_slow + 55\r\n3   libdispatch.dylib             \t       0x1b01cb714 __DISPATCH_WAIT_FOR_QUEUE__ + 367\r\n4   libdispatch.dylib             \t       0x1b01cb2c0 _dispatch_sync_f_slow + 147\r\n5   UIKitCore                     \t       0x1ab0f722c __37-[_UIRemoteKeyboards startConnection]_block_invoke_3 + 155\r\n6   CoreFoundation                \t       0x1a8d5dc04 __invoking___ + 147\r\n7   CoreFoundation                \t       0x1a8d0bcb4 -[NSInvocation invoke] + 427\r\n8   Foundation                    \t       0x1a303e6f8 __NSXPCCONNECTION_IS_CALLING_OUT_TO_REPLY_BLOCK__ + 15\r\n9   Foundation                    \t       0x1a300fa5c -[NSXPCConnection _decodeAndInvokeReplyBlockWithEvent:sequence:replyInfo:] + 519\r\n10  Foundation                    \t       0x1a3580a00 __88-[NSXPCConnection _sendInvocation:orArguments:count:methodSignature:selector:withProxy:]_block_invoke_5 + 187\r\n11  libxpc.dylib                  \t       0x208b85ee4 _xpc_connection_reply_callout + 123\r\n12  libxpc.dylib                  \t       0x208b78ee8 _xpc_connection_call_reply_async + 87\r\n13  libdispatch.dylib             \t       0x1b01bbf2c _dispatch_client_callout3 + 19\r\n14  libdispatch.dylib             \t       0x1b01d9e38 _dispatch_mach_msg_async_reply_invoke + 343\r\n15  libdispatch.dylib             \t       0x1b01c340c _dispatch_lane_serial_drain + 371\r\n16  libdispatch.dylib             \t       0x1b01c40d8 _dispatch_lane_invoke + 435\r\n17  libdispatch.dylib             \t       0x1b01cecdc _dispatch_workloop_worker_thread + 647\r\n18  libsystem_pthread.dylib       \t       0x208b25ddc _pthread_wqthread + 287\r\n19  libsystem_pthread.dylib       \t       0x208b25b7c start_wqthread + 7\r\n\r\n\r\nThread 0 crashed with ARM Thread State (64-bit):\r\n    x0: 0x0000000000000000   x1: 0x0000000000000000   x2: 0x0000000000000000   x3: 0x0000000000000000\r\n    x4: 0x0000000000000000   x5: 0x0000000000000000   x6: 0x0000000000000000   x7: 0x0000000000000000\r\n    x8: 0xade46dc294ae03df   x9: 0xade46dc36bc78a9f  x10: 0x00000002a020fde5  x11: 0x00000000201efde5\r\n   x12: 0x00000000201efde5  x13: 0x0000000000000000  x14: 0x0000000000000000  x15: 0x0000000101601191\r\n   x16: 0x0000000000000148  x17: 0x00000001ff698940  x18: 0x0000000000000000  x19: 0x0000000000000006\r\n   x20: 0x0000000000000103  x21: 0x00000001ff698a20  x22: 0x00000001015b01b0  x23: 0x00000001015b0000\r\n   x24: 0x10000000000fffff  x25: 0x0000010000000000  x26: 0x00000000000000b8  x27: 0x0000000721000c20\r\n   x28: 0x0000000000000000   fp: 0x0000000100f7ef10   lr: 0x0000000208b2c118\r\n    sp: 0x0000000100f7eef0   pc: 0x00000001e7cb1578 cpsr: 0x40001000\r\n   far: 0xffffffdd9c38c024  esr: 0x56000080  Address size fault\r\n\r\nBinary Images:\r\n       0x100d68000 -        0x100d7ffff X14AppForOS11 arm64  <393b6ff708ed3b96a8f2040a52fe3f11> /private/var/containers/Bundle/Application/DE4EAD8E-CA6B-4335-B57B-28745835CDA2/X14AppForOS11.app/X14AppForOS11\r\n       0x1014f0000 -        0x101597fff libclang_rt.asan_ios_dynamic.dylib arm64e  <acc0b754d88c349f981501925a8500a4> /private/var/containers/Bundle/Application/DE4EAD8E-CA6B-4335-B57B-28745835CDA2/X14AppForOS11.app/Frameworks/libclang_rt.asan_ios_dynamic.dylib\r\n       0x100ec0000 -        0x100ecbfff libobjc-trampolines.dylib arm64e  <7e77fc541c3331c086e81fb7bf12836c> /private/preboot/Cryptexes/OS/usr/lib/libobjc-trampolines.dylib\r\n       0x1e7caa000 -        0x1e7ce1fe7 libsystem_kernel.dylib arm64e  <681b06a07f6b3fa3a2ce063dc1da7b1b> /usr/lib/system/libsystem_kernel.dylib\r\n       0x208b25000 -        0x208b30ff3 libsystem_pthread.dylib arm64e  <aa302f5affe5327aa0033b288b935de1> /usr/lib/system/libsystem_pthread.dylib\r\n       0x1b01ff000 -        0x1b027cff3 libsystem_c.dylib arm64e  <073251d1d4c937748cee75210751a5d8> /usr/lib/system/libsystem_c.dylib\r\n       0x208a8e000 -        0x208a94ff7 libsystem_platform.dylib arm64e  <feae235314a4387184f04f62a365316b> /usr/lib/system/libsystem_platform.dylib\r\n       0x1aad5a000 -        0x1ac57efff UIKitCore arm64e  <7d57a1d1856f338d97db880c4ec8b02e> /System/Library/PrivateFrameworks/UIKitCore.framework/UIKitCore\r\n       0x2330ca000 -        0x2331f1fff UIKit arm64e  <d402ecd6842a34879d2392a0ea9dfbea> /System/Library/AccessibilityBundles/UIKit.axbundle/UIKit\r\n       0x1bed6d000 -        0x1bee14fff FrontBoardServices arm64e  <db727a51b28f330799d30bc671c3c46f> /System/Library/PrivateFrameworks/FrontBoardServices.framework/FrontBoardServices\r\n       0x1b01b8000 -        0x1b01fefff libdispatch.dylib arm64e  <5d16936b4e4c3276ba7a69c9bc760aba> /usr/lib/system/libdispatch.dylib\r\n       0x1a8ceb000 -        0x1a90d2fff CoreFoundation arm64e  <a900b4590127379e9cba0eab9c5d559f> /System/Library/Frameworks/CoreFoundation.framework/CoreFoundation\r\n       0x1e427f000 -        0x1e4287fff GraphicsServices arm64e  <cd8d719514e13c7ca8c950ccea9f2a17> /System/Library/PrivateFrameworks/GraphicsServices.framework/GraphicsServices\r\n       0x1b174f000 -        0x1b17c6fff libswiftUIKit.dylib arm64e  <d24b70db91ea38e9b1e0db9d15f6b17e> /usr/lib/swift/libswiftUIKit.dylib\r\n       0x1c8287000 -        0x1c830ca53 dyld arm64e  <c3fc2ee4367f3086beb8420ad442bf88> /usr/lib/dyld\r\n       0x1b3e8a000 -        0x1b3eadfff AXCoreUtilities arm64e  <774b92bee2953fdc99a45efb55ba70c5> /System/Library/PrivateFrameworks/AXCoreUtilities.framework/AXCoreUtilities\r\n       0x1b2231000 -        0x1b23f4fff AccessibilityUtilities arm64e  <265bea5ec36a3e51a119a3fd42f3db5c> /System/Library/PrivateFrameworks/AccessibilityUtilities.framework/AccessibilityUtilities\r\n       0x1a2f9d000 -        0x1a387afff Foundation arm64e  <1715de5d08933af0b0c0550bb14f91ec> /System/Library/Frameworks/Foundation.framework/Foundation\r\n       0x208b68000 -        0x208ba9fff libxpc.dylib arm64e  <a0d322a3d7723260969071f28737c43c> /usr/lib/system/libxpc.dylib\r\n\r\nEOF"
    email: ncreated@gmail.com
    modified: "2023-10-16T16:05:27.232352Z"
    number: FB13278576
    number_intvalue: 13278576
    originated: 16 Oct 2023
    parent_number: '&{NULL_VALUE}'
    product: Xcode
    product_version: "15"
    reproducible: Always
    resolved: ""
    status: Open
    title: Network APIs crashing on pre-iOS 17.0 when using Xcode 15
