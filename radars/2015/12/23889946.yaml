apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "23889946"
    labels:
        datastore_id: "4935037849960448"
data:
    classification: Crash/Hang/Data Loss
    created: "2015-12-14T23:06:22.36465Z"
    description: "Summary:\r\nIn 9.0 and 9.1, I used the following line to assemble a CNKeyDescriptor array to pass to CNContactFetchRequest(keysToFetch:):\r\nlet keysToFetch = [CNContactGivenNameKey, CNContactFamilyNameKey, CNContactPhoneNumbersKey, CNContactEmailAddressesKey]\r\n\r\nIn 9.2, I need to use this line, instead:\r\nlet keysToFetch = [CNContactPhoneNumbersKey, CNContactEmailAddressesKey, CNContactFormatter.descriptorForRequiredKeysForStyle(.FullName)]\r\n\r\n...otherwise, if I try to use CNContactFormatter.stringFromContact() with a contact I receive from that fetch request, I'll encounter an exception that looks something like the following stacktrace:\r\n\r\nCrowdRise[94077:15843170] *** Terminating app due to uncaught exception 'CNPropertyNotFetchedException', reason: 'A property was not requested when contact was fetched.'\r\n*** First throw call stack:\r\n(\r\n  0   CoreFoundation                      0x00000001092dbe65 __exceptionPreprocess + 165\r\n  1   libobjc.A.dylib                     0x000000010899adeb objc_exception_throw + 48\r\n  2   CoreFoundation                      0x00000001092dbd9d +[NSException raise:format:] + 205\r\n  3   Contacts                            0x0000000109098c15 -[CNContact middleName] + 160\r\n  4   Contacts                            0x00000001090bc5c6 +[CN(CNInternationalSupport) joinNonEmptyContactProperties:onContact:withDelimiter:] + 291\r\n  5   Contacts                            0x00000001090bc09d +[CN(CNInternationalSupport) localizedNameDelimiterForContact:] + 63\r\n  6   Contacts                            0x0000000109084b77 -[CNContactFormatter fullNameForContact:attributes:style:] + 82\r\n\r\nThis is important, because I did not notice any documentation about this behavior change in the 9.2 Release Notes.\r\n\r\nAlso, it seems like the only actual documentation for the method CNContactFormatter.descriptorForRequiredKeysForStyle() is in this high-level documentation for Contacts.framework:\r\nhttps://developer.apple.com/library/watchos/documentation/Contacts/Reference/Contacts_Framework/index.html\r\n\r\nNotably, there's no documentation for descriptorForRequiredKeysForStyle() on its parent class, CNContactFormatter:\r\nhttps://developer.apple.com/library/watchos/documentation/Contacts/Reference/CNContactFormatter_Class/index.html#//apple_ref/occ/cl/CNContactFormatter\r\n\r\nPlease improve this documentation. It may also be worth noting in the 9.2 Release Notes about this change in behavior.\r\n\r\nSteps to Reproduce:\r\n1. Use the following line to assemble a CNKeyDescriptor array to pass to CNContactFetchRequest(keysToFetch:):\r\nlet keysToFetch = [CNContactGivenNameKey, CNContactFamilyNameKey, CNContactPhoneNumbersKey, CNContactEmailAddressesKey]\r\n2. Pass keysToFetch to CNContactFetchRequest(keysToFetch:):.\r\n3. Try to use a CNContact from that fetch request with CNContactFormatter.stringFromContact().\r\n\r\nExpected Results:\r\nA formatted contact string is received\r\n\r\nActual Results:\r\nException crash with the following stacktrace:\r\n\r\nCrowdRise[94077:15843170] *** Terminating app due to uncaught exception 'CNPropertyNotFetchedException', reason: 'A property was not requested when contact was fetched.'\r\n*** First throw call stack:\r\n(\r\n  0   CoreFoundation                      0x00000001092dbe65 __exceptionPreprocess + 165\r\n  1   libobjc.A.dylib                     0x000000010899adeb objc_exception_throw + 48\r\n  2   CoreFoundation                      0x00000001092dbd9d +[NSException raise:format:] + 205\r\n  3   Contacts                            0x0000000109098c15 -[CNContact middleName] + 160\r\n  4   Contacts                            0x00000001090bc5c6 +[CN(CNInternationalSupport) joinNonEmptyContactProperties:onContact:withDelimiter:] + 291\r\n  5   Contacts                            0x00000001090bc09d +[CN(CNInternationalSupport) localizedNameDelimiterForContact:] + 63\r\n  6   Contacts                            0x0000000109084b77 -[CNContactFormatter fullNameForContact:attributes:style:] + 82\r\n\r\nVersion:\r\niOS 9.2\r\n\r\nNotes:\r\n\r\n\r\nConfiguration:\r\niPhone 6S\r\n\r\nAttachments:"
    email: joshavant@gmail.com
    modified: "2015-12-14T23:06:22.36487Z"
    number: "23889946"
    number_intvalue: 23889946
    originated: 14-Dec-2015 03:04 PM
    parent_number: '&{NULL_VALUE}'
    product: iOS SDK
    product_version: iOS 9.2
    reproducible: Always
    resolved: ""
    status: Open
    title: 9.2 does not document Contacts.framework requirements for CNKeyDescriptor arrays
