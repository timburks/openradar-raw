apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "19676587"
    labels:
        datastore_id: "6381910494281728"
data:
    classification: Serious Bug
    created: "2015-01-31T21:16:19.52498Z"
    description: "Summary:\r\nThe WWDC14 video on iOS 8 frameworks recommends single-project, multiple target workflows for app-framework bundles, but that of course isn't possible for so many distributed projects that use multiple internal and external (FOSS/GitHub/etc) repositories. This bug details one of a few problems when trying to replicate framework embed builds using a multi-project workspace.\r\n\r\nThe Xcode build system creates a false/incorrect file reference when attempting to add a framework from one project to an app in another project, but in the same workspace. The result is a series of build failures/warnings.\r\n\r\nSteps to Reproduce:\r\n1. Create a \"Single View App\" iOS template, App.xcodeproj\r\n2. Create a \"Cocoa Touch Framework\" template, Framework.xcodeproj\r\n3. Create a Workspace, e.g. Workspace.xcworkspace\r\n4. Drag the two xcodeproj's into the workspace.\r\n5. Select the App project from the workspace window, and go to the General settings for the App target.\r\n6. Add Framework.framework to Linked Frameworks and Libraries in the App target's General settings. It should appear under \"Workspace\" in the \"Choose frameworks and libraries to add:\" sheet that shows when hitting the + button.\r\n7. In the same General settings for the App target, now go to Embedded Binaries and add the Framework.framework file reference listed under the App project. (This seems a bit roundabout; see rdar://19676555)\r\n8. Build the App scheme (device or simulator, doesn't matter)\r\n\r\nExpected Results:\r\n\r\n\r\nActual Results:\r\nTwo bad/odd things should have happened by now: \r\n\r\nProblem 1: A second reference to the framework is added to Linked Frameworks and Libraries after step 7 (see FrameworkParty.png)\r\n\r\nProblem 2,3: Building the App scheme now fails with an error and a warning that appear to be symptoms of the same problem:\r\n\r\nld: warning: directory not found for option '-F/tmp/WorkspaceTest/Framework/build/Debug-iphoneos'\r\n\r\nerror: /private/tmp/WorkspaceTest/Framework/build/Debug-iphoneos/Framework.framework: No such file or directory\r\n\r\nIt appears the Framework.framework reference in App.xcodeproj is specific/relative to an assumed output of the owning project, Framework.xcodeproj, instead of the workspace (see FrameworkFileReferencePath.png). Changing the \"relative to\" setting on the file reference doesn't change anything (see RelBuildProducts.png) because the presumed path is wrong in the first place.\r\n\r\nInspecting App.xcodeproj/project.pbxproj reveals the following:\r\n\r\n6DFC454D1A7D615400C7779A /* Framework.framework */ = {isa = PBXFileReference; lastKnownFileType = wrapper.framework; name = Framework.framework; path = \"../Framework/build/Debug-iphoneos/Framework.framework\"; sourceTree = \"<group>\"; };\r\n\r\nIn reality, this should be nothing more than Framework.framework under BUILT_PRODUCTS_DIR or similar, e.g. ~/Library/Developer/Xcode/DerivedData/Workspace-bbiclmbeggbudrfjuzweloobycfh/Build/Products/Debug-iphonesimulator/Framework.framework. The only way I have been able to properly fix this is to hand-hack App.xcodeproj/project.pbxproj along those lines (note all the subdirectories removed):\r\n\r\n6DFC454D1A7D615400C7779A /* Framework.framework */ = {isa = PBXFileReference; lastKnownFileType = wrapper.framework; name = Framework.framework; path = \"Framework.framework\"; sourceTree = BUILT_PRODUCTS_DIR; };\r\n\r\nMaking this change in a text editor and reloading the project fixes everything.\r\n\r\nVersion:\r\nXcode 6.2 (6C107a) / OS X 10.10.2 (14C109)\r\n\r\nNotes:\r\nSearching for \"Embedded Binaries\" in the Xcode doc window returns zero results. Searching the internet returns a bunch of misguided Stack Overflow threads that I won't bother linking to here. As far as I can tell, there is zero guidance on how to do this right, so I can't tell if this is a bug(s) or if I'm just Doing It Wrongâ„¢.\r\n\r\nI suppose this is technically two or three different bugs:\r\n\r\n1) Bad framework reference path\r\n2) Duplicate Linked Libraries add\r\n3) Unnecessary append to Framework Search Paths\r\n\r\nbut they are part of the same sequence, so I'm logging them together.\r\n\r\nIt's much better if you perform these steps yourself to see how awkward the flow is, but for technical / state reference, you can download or checkout the WorkspaceEmbed branch of my radars repo on GitHub:\r\n\r\nhttps://github.com/drance/radars/tree/WorkspaceEmbed\r\n\r\nIt has both Broken and Fixed variants for easy diffing of the two App.xcodeproj/project.pbxproj files (the only file that needs to be changed.)"
    email: matt@bookhousesoftware.com
    modified: "2015-01-31T21:16:19.525211Z"
    number: "19676587"
    number_intvalue: 19676587
    originated: 1/31/2015
    parent_number: '&{NULL_VALUE}'
    product: Developer Tools
    product_version: Xcode 6.2 (6C107a) / OS X 10.10.2 (14C109)
    reproducible: Always
    resolved: ""
    status: Open
    title: Workspace-based app/framework embed fails to build
