apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "22720220"
    labels:
        datastore_id: "4957889357676544"
data:
    classification: Serious Bug
    created: "2015-09-16T16:14:55.16875Z"
    description: "Summary:\r\nSorry for the vague title, I'm simply not sure what the ultimate culprit is in this case.\r\n\r\n\r\nThe following code snippet causes the Swift compiler to crash. An example project and crash report are attached.\r\n\r\nstruct Test : TestType {\r\n    var storage: [Int] = []\r\n\r\n    mutating func pop() -> Int? {\r\n        return storage.popLast()\r\n    }\r\n}\r\n\r\npublic protocol TestType : SequenceType {\r\n    mutating func pop() -> Int?\r\n}\r\n\r\nextension TestType {\r\n    func generate() -> TestGenerator<Self> {\r\n        return TestGenerator(self)\r\n    }\r\n}\r\n\r\nstruct TestGenerator<T : TestType> : GeneratorType {\r\n    private var content: T\r\n    \r\n    init(_ content: T) {\r\n        self.content = content\r\n    }\r\n    \r\n    mutating func next() -> Int? {\r\n        return content.pop()\r\n    }\r\n}\r\n\r\nSteps to Reproduce:\r\n1) Download the attached project\r\n2) Build\r\n\r\nExpected Results:\r\nThe compiler should not crash and instead compile the given code successfully.\r\n\r\nActual Results:\r\nThe compiler crashes.\r\n\r\nStacktrace:\r\n\r\nThread 0 Crashed:: Dispatch queue: com.apple.main-thread\r\n0   swift                         \t0x000000010a8dadfd emitNominalMetadataRef(swift::irgen::IRGenFunction&, swift::NominalTypeDecl*, swift::CanType) + 29\r\n1   swift                         \t0x000000010a8d4770 getTypeMetadataAccessFunction(swift::irgen::IRGenModule&, swift::CanType, swift::ForDefinition_t) + 912\r\n2   swift                         \t0x000000010a8ce929 emitCallToTypeMetadataAccessFunction(swift::irgen::IRGenFunction&, swift::CanType, swift::ForDefinition_t) + 73\r\n3   swift                         \t0x000000010a8db0d3 emitNominalMetadataRef(swift::irgen::IRGenFunction&, swift::NominalTypeDecl*, swift::CanType) + 755\r\n4   swift                         \t0x000000010a8d4770 getTypeMetadataAccessFunction(swift::irgen::IRGenModule&, swift::CanType, swift::ForDefinition_t) + 912\r\n5   swift                         \t0x000000010a8ce929 emitCallToTypeMetadataAccessFunction(swift::irgen::IRGenFunction&, swift::CanType, swift::ForDefinition_t) + 73\r\n6   swift                         \t0x000000010a90aa0b swift::irgen::emitPolymorphicArguments(swift::irgen::IRGenFunction&, swift::CanTypeWrapper<swift::SILFunctionType>, swift::CanTypeWrapper<swift::SILFunctionType>, llvm::ArrayRef<swift::Substitution>, swift::irgen::WitnessMetadata*, swift::irgen::Explosion&) + 587\r\n7   swift                         \t0x000000010a956c96 (anonymous namespace)::IRGenSILFunction::visitFullApplySite(swift::FullApplySite) + 2230\r\n8   swift                         \t0x000000010a94877d swift::irgen::IRGenModule::emitSILFunction(swift::SILFunction*) + 10973\r\n9   swift                         \t0x000000010a8b0498 swift::irgen::IRGenModuleDispatcher::emitGlobalTopLevel() + 376\r\n10  swift                         \t0x000000010a92fa99 performIRGeneration(swift::IRGenOptions&, swift::ModuleDecl*, swift::SILModule*, llvm::StringRef, llvm::LLVMContext&, swift::SourceFile*, unsigned int) + 793\r\n11  swift                         \t0x000000010a92ff10 swift::performIRGeneration(swift::IRGenOptions&, swift::SourceFile&, swift::SILModule*, llvm::StringRef, llvm::LLVMContext&, unsigned int) + 64\r\n12  swift                         \t0x000000010a8372e8 performCompile(swift::CompilerInstance&, swift::CompilerInvocation&, llvm::ArrayRef<char const*>, int&) + 13704\r\n13  swift                         \t0x000000010a833b4a frontend_main(llvm::ArrayRef<char const*>, char const*, void*) + 2682\r\n14  swift                         \t0x000000010a8301d7 main + 2247\r\n15  libdyld.dylib                 \t0x00007fff8bb8c5ad start + 1\r\n\r\nVersion:\r\nOS X 10.11 (15A282b)\r\nVersion 7.1 beta (7B60)\r\nApple Swift version 2.0 (swiftlang_PONDEROSA-700.1.100.2 clang-700.1.74)"
    email: janoschhildebrand@gmail.com
    modified: "2015-09-16T16:14:55.169Z"
    number: "22720220"
    number_intvalue: 22720220
    originated: 16-Sep-2015
    parent_number: '&{NULL_VALUE}'
    product: Developer Tools
    product_version: Xcode 7.1b1
    reproducible: Always
    resolved: ""
    status: Open
    title: 'Xcode 7.1b1: [Swift] Compiler crash involving a protocol extension and a generic type'
