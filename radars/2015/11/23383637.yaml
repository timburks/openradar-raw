apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "23383637"
    labels:
        datastore_id: "6618705295310848"
data:
    classification: ""
    created: "2015-11-06T06:24:14.03147Z"
    description: "Summary:\r\nI have a literal closure that I'm passing as a C function pointer to a C API. This is happening inside a the init method of a generic class. The compiler crashes while emitting SIP. It doesn't crash if the class is not generic.\r\n\r\nSteps to Reproduce:\r\n1. Install Xcode Version 7.2 beta (7C46l)\r\n2. Create an OS X command-line project and paste the code in main.swift (14 lines)\r\n3. Compile\r\n\r\nExpected Results:\r\nSuccessful compile\r\n\r\nActual Results:\r\nCompiler crashes with errors attached in errors.txt\r\n\r\nVersion:\r\nXcode Version 7.2 beta (7C46l)\r\nOS X 10.11.1\r\n\r\n\r\n---\r\nmain.swift\r\n---\r\nimport Cocoa\r\n\r\nclass Observer<ElementType> {\r\n  init() {\r\n    var axObserver: AXObserver?\r\n    let _ = AXObserverCreate(0, {(\r\n      axObserver: AXObserver,\r\n      axElement: AXUIElement,\r\n      notification: CFString,\r\n      userData: UnsafeMutablePointer<Void>) in\r\n      // do nothing\r\n      }, &axObserver)\r\n  }\r\n}\r\n\r\n---\r\nerrors.txt\r\n---\r\nCompileSwift normal x86_64 /Users/tyler/code/testcase2/testcase2/main.swift\r\ncd /Users/tyler/code/testcase2\r\n/Applications/Xcode-beta.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/swift -frontend -c -primary-file /Users/tyler/code/testcase2/testcase2/main.swift -target x86_64-apple-macosx10.11 -enable-objc-interop -sdk /Applications/Xcode-beta.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.11.sdk -I /Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Products/Debug -F /Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Products/Debug -enable-testing -g -module-cache-path /Users/tyler/Library/Developer/Xcode/DerivedData/ModuleCache -serialize-debugging-options -Xcc -I/Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Intermediates/testcase2.build/Debug/testcase2.build/swift-overrides.hmap -Xcc -iquote -Xcc /Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Intermediates/testcase2.build/Debug/testcase2.build/testcase2-generated-files.hmap -Xcc -I/Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Intermediates/testcase2.build/Debug/testcase2.build/testcase2-own-target-headers.hmap -Xcc -I/Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Intermediates/testcase2.build/Debug/testcase2.build/testcase2-all-target-headers.hmap -Xcc -iquote -Xcc /Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Intermediates/testcase2.build/Debug/testcase2.build/testcase2-project-headers.hmap -Xcc -I/Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Products/Debug/include -Xcc -I/Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Intermediates/testcase2.build/Debug/testcase2.build/DerivedSources/x86_64 -Xcc -I/Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Intermediates/testcase2.build/Debug/testcase2.build/DerivedSources -Xcc -DDEBUG=1 -Xcc -working-directory/Users/tyler/code/testcase2 -emit-module-doc-path /Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Intermediates/testcase2.build/Debug/testcase2.build/Objects-normal/x86_64/main~partial.swiftdoc -Onone -module-name testcase2 -emit-module-path /Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Intermediates/testcase2.build/Debug/testcase2.build/Objects-normal/x86_64/main~partial.swiftmodule -serialize-diagnostics-path /Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Intermediates/testcase2.build/Debug/testcase2.build/Objects-normal/x86_64/main.dia -emit-dependencies-path /Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Intermediates/testcase2.build/Debug/testcase2.build/Objects-normal/x86_64/main.d -emit-reference-dependencies-path /Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Intermediates/testcase2.build/Debug/testcase2.build/Objects-normal/x86_64/main.swiftdeps -o /Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Intermediates/testcase2.build/Debug/testcase2.build/Objects-normal/x86_64/main.o\r\n\r\n0  swift                    0x0000000110db9f7b llvm::sys::PrintStackTrace(__sFILE*) + 43\r\n1  swift                    0x0000000110dba6bb SignalHandler(int) + 379\r\n2  libsystem_platform.dylib 0x00007fff86b4052a _sigtramp + 26\r\n3  libsystem_platform.dylib 0x0000001d00726573 _sigtramp + 2042519651\r\n4  swift                    0x000000010ef87b7b swift::irgen::emitPolymorphicArguments(swift::irgen::IRGenFunction&, swift::CanTypeWrapper<swift::SILFunctionType>, swift::CanTypeWrapper<swift::SILFunctionType>, llvm::ArrayRef<swift::Substitution>, swift::irgen::WitnessMetadata*, swift::irgen::Explosion&) + 587\r\n5  swift                    0x000000010efd477c (anonymous namespace)::IRGenSILFunction::visitFullApplySite(swift::FullApplySite) + 2172\r\n6  swift                    0x000000010efc627d swift::irgen::IRGenModule::emitSILFunction(swift::SILFunction*) + 10973\r\n7  swift                    0x000000010ef2c923 swift::irgen::IRGenModuleDispatcher::emitLazyDefinitions() + 307\r\n8  swift                    0x000000010efacd6a performIRGeneration(swift::IRGenOptions&, swift::ModuleDecl*, swift::SILModule*, llvm::StringRef, llvm::LLVMContext&, swift::SourceFile*, unsigned int) + 1034\r\n9  swift                    0x000000010efad100 swift::performIRGeneration(swift::IRGenOptions&, swift::SourceFile&, swift::SILModule*, llvm::StringRef, llvm::LLVMContext&, unsigned int) + 64\r\n10 swift                    0x000000010eeabb35 performCompile(swift::CompilerInstance&, swift::CompilerInvocation&, llvm::ArrayRef<char const*>, int&) + 13701\r\n11 swift                    0x000000010eea83a3 frontend_main(llvm::ArrayRef<char const*>, char const*, void*) + 2691\r\n12 swift                    0x000000010eea4a24 main + 2324\r\n13 libdyld.dylib            0x00007fff927d95ad start + 1\r\n14 libdyld.dylib            0x000000000000003a start + 1837263502\r\nStack dump:\r\n0.\tProgram arguments: /Applications/Xcode-beta.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/swift -frontend -c -primary-file /Users/tyler/code/testcase2/testcase2/main.swift -target x86_64-apple-macosx10.11 -enable-objc-interop -sdk /Applications/Xcode-beta.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.11.sdk -I /Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Products/Debug -F /Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Products/Debug -enable-testing -g -module-cache-path /Users/tyler/Library/Developer/Xcode/DerivedData/ModuleCache -serialize-debugging-options -Xcc -I/Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Intermediates/testcase2.build/Debug/testcase2.build/swift-overrides.hmap -Xcc -iquote -Xcc /Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Intermediates/testcase2.build/Debug/testcase2.build/testcase2-generated-files.hmap -Xcc -I/Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Intermediates/testcase2.build/Debug/testcase2.build/testcase2-own-target-headers.hmap -Xcc -I/Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Intermediates/testcase2.build/Debug/testcase2.build/testcase2-all-target-headers.hmap -Xcc -iquote -Xcc /Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Intermediates/testcase2.build/Debug/testcase2.build/testcase2-project-headers.hmap -Xcc -I/Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Products/Debug/include -Xcc -I/Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Intermediates/testcase2.build/Debug/testcase2.build/DerivedSources/x86_64 -Xcc -I/Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Intermediates/testcase2.build/Debug/testcase2.build/DerivedSources -Xcc -DDEBUG=1 -Xcc -working-directory/Users/tyler/code/testcase2 -emit-module-doc-path /Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Intermediates/testcase2.build/Debug/testcase2.build/Objects-normal/x86_64/main~partial.swiftdoc -Onone -module-name testcase2 -emit-module-path /Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Intermediates/testcase2.build/Debug/testcase2.build/Objects-normal/x86_64/main~partial.swiftmodule -serialize-diagnostics-path /Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Intermediates/testcase2.build/Debug/testcase2.build/Objects-normal/x86_64/main.dia -emit-dependencies-path /Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Intermediates/testcase2.build/Debug/testcase2.build/Objects-normal/x86_64/main.d -emit-reference-dependencies-path /Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Intermediates/testcase2.build/Debug/testcase2.build/Objects-normal/x86_64/main.swiftdeps -o /Users/tyler/Library/Developer/Xcode/DerivedData/testcase2-gujsabtuvlwakmakyxkeygwreirz/Build/Intermediates/testcase2.build/Debug/testcase2.build/Objects-normal/x86_64/main.o\r\n1.\tWhile emitting IR SIL function @_TToFFC9testcase28ObservercurFMGS0_q__FT_GS0_q__U_FTCSo10AXObserverCSo11AXUIElementCSo8CFStringGVSs20UnsafeMutablePointerT___T_ for expression at [/Users/tyler/code/testcase2/testcase2/main.swift:6:33 - line:12:7] RangeText=\"{(\r\naxObserver: AXObserver,\r\naxElement: AXUIElement,\r\nnotification: CFString,\r\nuserData: UnsafeMutablePointer<Void>) in\r\n// do nothing\r\n}\""
    email: tmandry@gmail.com
    modified: "2015-11-06T06:24:14.03185Z"
    number: "23383637"
    number_intvalue: 23383637
    originated: Nov 3, 2015
    parent_number: '&{NULL_VALUE}'
    product: Developer Tools
    product_version: Xcode Version 7.2 beta (7C46l)
    reproducible: Always
    resolved: ""
    status: Open
    title: Swift compiler crashes emitting SIP for closure literal inside a generic class
