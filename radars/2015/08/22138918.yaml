apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "22138918"
    labels:
        datastore_id: "6175505506107392"
data:
    classification: Crash/Hang/Data Loss
    created: "2015-08-04T20:20:57.54258Z"
    description: "Summary:\nProvide a descriptive summary of the issue.\n\nSteps to Reproduce:\nThis code:\nfunc s() {\n\tvar f: () -> () = {}\n\tlet _: (() -> ()) -> () = { g in\n\t\tlet _f = f\n\t\tf = {\n\t\t\t_f()\n\t\t\tg()\n\t\t}\n\t}\n}\n\nExpected Results:\nshouldnâ€™t crash swiftc\n\nActual Results:\nbut totally does:\nrob@Resonance ~/Desktop> swiftc boom.swift; and ./boom\nargument type mismatch!\n  argument:   %1 = argument of bb0 : $@box @callee_owned () -> () // user: %13\n  expected: $@box (() -> ())\nSIL verification failed: entry point argument types do not match function type: std::equal(entry->bbarg_begin(), entry->bbarg_end(), ti->getParameterSILTypes().begin(), [&](SILArgument *bbarg, SILType ty) { auto mappedTy = F.mapTypeIntoContext(ty); if (bbarg->getType() != mappedTy) { llvm::errs() << \"argument type mismatch!\\n\"; llvm::errs() << \"  argument: \"; bbarg->dump(); llvm::errs() << \"  expected: \"; mappedTy.dump(); return false; } return true; })\nIn function:\n// boom.(s () -> ()).(closure #2)\nsil shared @_TFF4boom1sFT_T_U0_FFT_T_T_ : $@convention(thin) (@owned @callee_owned () -> (), @owned @box (() -> ()), @inout @callee_owned () -> ()) -> () {\nbb0(%0 : $@callee_owned () -> (), %1 : $@box @callee_owned () -> (), %2 : $*@callee_owned () -> ()):\n  debug_value %0 : $@callee_owned () -> ()  // let g // id: %3\n  %4 = load %2 : $*@callee_owned () -> ()         // users: %5, %6, %8, %10, %12\n  strong_retain %4 : $@callee_owned () -> ()      // id: %5\n  debug_value %4 : $@callee_owned () -> ()  // let _f // id: %6\n  // function_ref boom.(s () -> ()).(closure #2).(closure #1)\n  %7 = function_ref @_TFFF4boom1sFT_T_U0_FFT_T_T_U_FT_T_ : $@convention(thin) (@owned @callee_owned () -> (), @owned @callee_owned () -> ()) -> () // user: %10\n  strong_retain %4 : $@callee_owned () -> ()      // id: %8\n  strong_retain %0 : $@callee_owned () -> ()      // id: %9\n  %10 = partial_apply %7(%4, %0) : $@convention(thin) (@owned @callee_owned () -> (), @owned @callee_owned () -> ()) -> () // user: %11\n  assign %10 to %2 : $*@callee_owned () -> ()     // id: %11\n  strong_release %4 : $@callee_owned () -> ()     // id: %12\n  strong_release %1 : $@box @callee_owned () -> () // id: %13\n  strong_release %0 : $@callee_owned () -> ()     // id: %14\n  %15 = tuple ()                                  // user: %16\n  return %15 : $()                                // id: %16\n}\n\n0  swift                    0x000000010ebbeb8b llvm::sys::PrintStackTrace(__sFILE*) + 43\n1  swift                    0x000000010ebbf2cb SignalHandler(int) + 379\n2  libsystem_platform.dylib 0x00007fff85ef3eaa _sigtramp + 26\n3  swift                    0x000000010f1bda87 FirstTarget + 61919\n4  swift                    0x000000010ebbf0c6 abort + 22\n5  swift                    0x000000010cd6b239 (anonymous namespace)::SILVerifier::_require(bool, llvm::Twine const&, std::__1::function<void ()> const&) + 425\n6  swift                    0x000000010cd682d0 swift::SILFunction::verify() const + 2336\n7  swift                    0x000000010cda9c70 swift::Lowering::SILGenModule::emitClosure(swift::AbstractClosureExpr*) + 256\n8  swift                    0x000000010ce000eb (anonymous namespace)::RValueEmitter::visitAbstractClosureExpr(swift::AbstractClosureExpr*, swift::Lowering::SGFContext) + 107\n9  swift                    0x000000010cdf5f47 swift::ASTVisitor<(anonymous namespace)::RValueEmitter, swift::Lowering::RValue, void, void, void, void, void, swift::Lowering::SGFContext>::visit(swift::Expr*, swift::Lowering::SGFContext) + 151\n10 swift                    0x000000010cdef66f swift::Lowering::SILGenFunction::emitExprInto(swift::Expr*, swift::Lowering::Initialization*) + 303\n11 swift                    0x000000010cddfd08 swift::Lowering::SILGenFunction::visitPatternBindingDecl(swift::PatternBindingDecl*) + 232\n12 swift                    0x000000010ce4326a swift::ASTVisitor<(anonymous namespace)::StmtEmitter, void, void, void, void, void, void>::visit(swift::Stmt*) + 362\n13 swift                    0x000000010ce430f5 swift::Lowering::SILGenFunction::emitStmt(swift::Stmt*) + 21\n14 swift                    0x000000010ce0a496 swift::Lowering::SILGenFunction::emitFunction(swift::FuncDecl*) + 390\n15 swift                    0x000000010cda8131 swift::Lowering::SILGenModule::emitFunction(swift::FuncDecl*) + 513\n16 swift                    0x000000010cdb001f swift::ASTVisitor<swift::Lowering::SILGenModule, void, void, void, void, void, void>::visit(swift::Decl*) + 255\n17 swift                    0x000000010cdac14b swift::Lowering::SILGenModule::emitSourceFile(swift::SourceFile*, unsigned int) + 587\n18 swift                    0x000000010cdacfdf swift::SILModule::constructSIL(swift::ModuleDecl*, swift::SILOptions&, swift::FileUnit*, llvm::Optional<unsigned int>, bool, bool) + 975\n19 swift                    0x000000010cdad43b swift::performSILGeneration(swift::FileUnit&, swift::SILOptions&, llvm::Optional<unsigned int>, bool) + 123\n20 swift                    0x000000010cba4c61 performCompile(swift::CompilerInstance&, swift::CompilerInvocation&, llvm::ArrayRef<char const*>, int&) + 9569\n21 swift                    0x000000010cba24e3 frontend_main(llvm::ArrayRef<char const*>, char const*, void*) + 2627\n22 swift                    0x000000010cb9e5af main + 2015\n23 libdyld.dylib            0x00007fff942115ad start + 1\nStack dump:\n0.\tProgram arguments: /Applications/Xcode-beta.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/swift -frontend -c -primary-file boom.swift -target x86_64-apple-darwin15.0.0 -enable-objc-interop -sdk /Applications/Xcode-beta.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.11.sdk -color-diagnostics -module-name boom -o /var/folders/9y/f7n4rvx901nctm_5d16c1wm40000gn/T/boom-6bb0c8.o \n1.\tWhile emitting SIL for 's' at boom.swift:1:1\n2.\tWhile silgen closureexpr SIL function @_TFF4boom1sFT_T_U0_FFT_T_T_ for expression at [boom.swift:3:28 - line:9:2] RangeText=\"{ g in\n\t\tlet _f = f\n\t\tf = {\n\t\t\t_f()\n\t\t\tg()\n\t\t}\n\t}\"\n3.\tWhile verifying SIL function @_TFF4boom1sFT_T_U0_FFT_T_T_ for expression at [boom.swift:3:28 - line:9:2] RangeText=\"{ g in\n\t\tlet _f = f\n\t\tf = {\n\t\t\t_f()\n\t\t\tg()\n\t\t}\n\t}\"\n<unknown>:0: error: unable to execute command: Illegal instruction: 4\n<unknown>:0: error: swift frontend command failed due to signal (use -v to see invocation)\n\n\nRegression:\nN/A\n\nNotes:\nN/A"
    email: rix.rob@gmail.com
    modified: "2015-08-04T20:20:57.54294Z"
    number: "22138918"
    number_intvalue: 22138918
    originated: 04-Aug-2015 04:20 PM
    parent_number: '&{NULL_VALUE}'
    product: Developer Tools
    product_version: Xcode-beta (7A165t)
    reproducible: Always
    resolved: ""
    status: Open
    title: 'Swift 2.0b4: swiftc crashes compiling function taking function & closing over function it (re)assigns'
