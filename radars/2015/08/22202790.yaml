apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "22202790"
    labels:
        datastore_id: "5589097884155904"
data:
    classification: Crash/Hang/Data Loss
    created: "2015-08-08T17:13:25.42148Z"
    description: "Summary:\nAnother case where an untypable program crashes swiftc.\n\n\nSteps to Reproduce:\n1. This ill-formed program:\nenum E<R> {\n\tcase U\n\n\tstatic func f(t: R, _ f: R -> R) -> E {\n\t\treturn .U\n\t}\n}\n\nenum D {\n\tcase C\n\tcase A(() -> E<D>, E<D> -> D)\n\n\tvar v: E<D> {\n\t\tswitch self {\n\t\tcase .C:\n\t\t\treturn .U\n\t\tcase let .A(x, c):\n\t\t\treturn E.f(x) { a in c(a.v) }\n\t\t}\n\t}\n}\n\n\nExpected Results:\nshould not crash swiftc\n\n\nActual Results:\nbut totally does:\nrob@Resonance ~/Desktop> swiftc boom.swift; and ./boom\nUnresolvedDotExpr should not survive to SILGen\nUNREACHABLE executed at /Library/Caches/com.apple.xbs/Sources/swiftlang/swiftlang-700.0.52.2/src/swift/include/swift/AST/ExprNodes.def:78!\n0  swift                    0x000000010f1abbbb llvm::sys::PrintStackTrace(__sFILE*) + 43\n1  swift                    0x000000010f1ac2fb SignalHandler(int) + 379\n2  libsystem_platform.dylib 0x00007fff9644deaa _sigtramp + 26\n3  swift                    0x000000010f791ab7 FirstTarget + 63567\n4  swift                    0x000000010f1ac0f6 abort + 22\n5  swift                    0x000000010f165931 llvm::llvm_unreachable_internal(char const*, char const*, unsigned int) + 481\n6  swift                    0x000000010d3912bd swift::ASTVisitor<(anonymous namespace)::SILGenApply, void, void, void, void, void, void>::visit(swift::Expr*) + 6061\n7  swift                    0x000000010d39562c (anonymous namespace)::SILGenApply::visitApplyExpr(swift::ApplyExpr*) + 4668\n8  swift                    0x000000010d38618f prepareApplyExpr(swift::Lowering::SILGenFunction&, swift::Expr*) + 175\n9  swift                    0x000000010d38609f swift::Lowering::SILGenFunction::emitApplyExpr(swift::Expr*, swift::Lowering::SGFContext) + 47\n10 swift                    0x000000010d3c6e67 swift::ASTVisitor<(anonymous namespace)::RValueEmitter, swift::Lowering::RValue, void, void, void, void, void, swift::Lowering::SGFContext>::visit(swift::Expr*, swift::Lowering::SGFContext) + 87\n11 swift                    0x000000010d3c0723 swift::Lowering::SILGenFunction::emitRValue(swift::Expr*, swift::Lowering::SGFContext) + 35\n12 swift                    0x000000010d416a7a swift::Lowering::SILGenFunction::emitReturnExpr(swift::SILLocation, swift::Expr*) + 362\n13 swift                    0x000000010d413c73 swift::ASTVisitor<(anonymous namespace)::StmtEmitter, void, void, void, void, void, void>::visit(swift::Stmt*) + 707\n14 swift                    0x000000010d413b61 swift::ASTVisitor<(anonymous namespace)::StmtEmitter, void, void, void, void, void, void>::visit(swift::Stmt*) + 433\n15 swift                    0x000000010d4139a5 swift::Lowering::SILGenFunction::emitStmt(swift::Stmt*) + 21\n16 swift                    0x000000010d3fe792 void llvm::function_ref<void ((anonymous namespace)::PatternMatchEmission&, (anonymous namespace)::ClauseRow&)>::callback_fn<swift::Lowering::SILGenFunction::emitSwitchStmt(swift::SwitchStmt*)::$_0>(long, (anonymous namespace)::PatternMatchEmission&, (anonymous namespace)::ClauseRow&) + 226\n17 swift                    0x000000010d3f5bae (anonymous namespace)::PatternMatchEmission::emitDispatch((anonymous namespace)::ClauseMatrix&, llvm::ArrayRef<swift::Lowering::ConsumableManagedValue>, std::__1::function<void (swift::SILLocation)> const&) + 2238\n18 swift                    0x000000010d3fd199 std::__1::__function::__func<(anonymous namespace)::PatternMatchEmission::emitSpecializedDispatch((anonymous namespace)::ClauseMatrix&, llvm::ArrayRef<swift::Lowering::ConsumableManagedValue>, unsigned int&, unsigned int, std::__1::function<void (swift::SILLocation)> const&)::$_7, std::__1::allocator<(anonymous namespace)::PatternMatchEmission::emitSpecializedDispatch((anonymous namespace)::ClauseMatrix&, llvm::ArrayRef<swift::Lowering::ConsumableManagedValue>, unsigned int&, unsigned int, std::__1::function<void (swift::SILLocation)> const&)::$_7>, void (llvm::ArrayRef<swift::Lowering::ConsumableManagedValue>, llvm::ArrayRef<(anonymous namespace)::SpecializedRow>, std::__1::function<void (swift::SILLocation)> const&)>::operator()(llvm::ArrayRef<swift::Lowering::ConsumableManagedValue>&&, llvm::ArrayRef<(anonymous namespace)::SpecializedRow>&&, std::__1::function<void (swift::SILLocation)> const&) + 1929\n19 swift                    0x000000010d3f961c (anonymous namespace)::PatternMatchEmission::emitSpecializedDispatch((anonymous namespace)::ClauseMatrix&, llvm::ArrayRef<swift::Lowering::ConsumableManagedValue>, unsigned int&, unsigned int, std::__1::function<void (swift::SILLocation)> const&) + 8476\n20 swift                    0x000000010d3f56f1 (anonymous namespace)::PatternMatchEmission::emitDispatch((anonymous namespace)::ClauseMatrix&, llvm::ArrayRef<swift::Lowering::ConsumableManagedValue>, std::__1::function<void (swift::SILLocation)> const&) + 1025\n21 swift                    0x000000010d3fd199 std::__1::__function::__func<(anonymous namespace)::PatternMatchEmission::emitSpecializedDispatch((anonymous namespace)::ClauseMatrix&, llvm::ArrayRef<swift::Lowering::ConsumableManagedValue>, unsigned int&, unsigned int, std::__1::function<void (swift::SILLocation)> const&)::$_7, std::__1::allocator<(anonymous namespace)::PatternMatchEmission::emitSpecializedDispatch((anonymous namespace)::ClauseMatrix&, llvm::ArrayRef<swift::Lowering::ConsumableManagedValue>, unsigned int&, unsigned int, std::__1::function<void (swift::SILLocation)> const&)::$_7>, void (llvm::ArrayRef<swift::Lowering::ConsumableManagedValue>, llvm::ArrayRef<(anonymous namespace)::SpecializedRow>, std::__1::function<void (swift::SILLocation)> const&)>::operator()(llvm::ArrayRef<swift::Lowering::ConsumableManagedValue>&&, llvm::ArrayRef<(anonymous namespace)::SpecializedRow>&&, std::__1::function<void (swift::SILLocation)> const&) + 1929\n22 swift                    0x000000010d3fabb1 (anonymous namespace)::PatternMatchEmission::emitSpecializedDispatch((anonymous namespace)::ClauseMatrix&, llvm::ArrayRef<swift::Lowering::ConsumableManagedValue>, unsigned int&, unsigned int, std::__1::function<void (swift::SILLocation)> const&) + 14001\n23 swift                    0x000000010d3f56f1 (anonymous namespace)::PatternMatchEmission::emitDispatch((anonymous namespace)::ClauseMatrix&, llvm::ArrayRef<swift::Lowering::ConsumableManagedValue>, std::__1::function<void (swift::SILLocation)> const&) + 1025\n24 swift                    0x000000010d3f4db8 swift::Lowering::SILGenFunction::emitSwitchStmt(swift::SwitchStmt*) + 2216\n25 swift                    0x000000010d413b61 swift::ASTVisitor<(anonymous namespace)::StmtEmitter, void, void, void, void, void, void>::visit(swift::Stmt*) + 433\n26 swift                    0x000000010d4139a5 swift::Lowering::SILGenFunction::emitStmt(swift::Stmt*) + 21\n27 swift                    0x000000010d3dada6 swift::Lowering::SILGenFunction::emitFunction(swift::FuncDecl*) + 390\n28 swift                    0x000000010d378601 swift::Lowering::SILGenModule::emitFunction(swift::FuncDecl*) + 513\n29 swift                    0x000000010d41987c (anonymous namespace)::SILGenType::emitType() + 1132\n30 swift                    0x000000010d41936e swift::Lowering::SILGenModule::visitNominalTypeDecl(swift::NominalTypeDecl*) + 30\n31 swift                    0x000000010d37c60b swift::Lowering::SILGenModule::emitSourceFile(swift::SourceFile*, unsigned int) + 587\n32 swift                    0x000000010d37d4af swift::SILModule::constructSIL(swift::ModuleDecl*, swift::SILOptions&, swift::FileUnit*, llvm::Optional<unsigned int>, bool, bool) + 991\n33 swift                    0x000000010d37d90b swift::performSILGeneration(swift::FileUnit&, swift::SILOptions&, llvm::Optional<unsigned int>, bool) + 123\n34 swift                    0x000000010d16f36e performCompile(swift::CompilerInstance&, swift::CompilerInvocation&, llvm::ArrayRef<char const*>, int&) + 12622\n35 swift                    0x000000010d16bfc8 frontend_main(llvm::ArrayRef<char const*>, char const*, void*) + 2728\n36 swift                    0x000000010d16802f main + 2015\n37 libdyld.dylib            0x00007fff94b775ad start + 1\nStack dump:\n0.\tProgram arguments: /Applications/Xcode-beta.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/swift -frontend -c -primary-file boom.swift -target x86_64-apple-darwin15.0.0 -enable-objc-interop -sdk /Applications/Xcode-beta.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.11.sdk -color-diagnostics -module-name boom -o /var/folders/9y/f7n4rvx901nctm_5d16c1wm40000gn/T/boom-d296d8.o \n1.\tWhile emitting SIL for getter for v at boom.swift:13:14\n<unknown>:0: error: unable to execute command: Illegal instruction: 4\n<unknown>:0: error: swift frontend command failed due to signal (use -v to see invocation)\n\n\nRegression:\nIt doesnâ€™t crash if you add a `return .U` before the switch.\n\n\nNotes:\nN/A"
    email: rix.rob@gmail.com
    modified: "2015-08-08T17:13:25.42174Z"
    number: "22202790"
    number_intvalue: 22202790
    originated: 08-Aug-2015 01:13 PM
    parent_number: '&{NULL_VALUE}'
    product: Developer Tools
    product_version: Xcode-beta (7A176x)
    reproducible: Always
    resolved: ""
    status: Open
    title: 'Swift 2b5: swiftc crash in malformed program unifying function with enum'
