apiVersion: openapi/v1alpha1
kind: Radar
metadata:
    name: "12155059"
    labels:
        datastore_id: "1880404"
data:
    classification: Crash/Hang/Data Loss
    created: "2012-08-24T13:30:08.367212Z"
    description: "I use -[NSString(UIStringDrawing) sizeWithFont:constrainedToSize:lineBreakMode:] in a background thread. As far as I understand the rules, this should be OK since this doesn't draw on the screen.\r\n\r\nNevertheless, it just crashed with EXC_BAD_ACCESS in the background thread.\r\n\r\nI found that simultaneously a similar operation was going on in the main thread. Is this perhaps not re-entrant?\r\n\r\n\r\nBack traces:\r\n\r\n(lldb) bt\r\n* thread #20: tid = 0x3603, 0x0ba781e0, stop reason = EXC_BAD_ACCESS (code=2, address=0xba781e0)\r\n    frame #0: 0x0ba781e0\r\n    frame #1: 0x05c9c42e WebCore`WebCore::Font::Font(WebCore::FontPlatformData const&, WTF::PassRefPtr<WebCore::FontSelector>) + 142\r\n    frame #2: 0x0583ef3a WebKit`_ZL15rendererForFontP8__GSFont + 218\r\n    frame #3: 0x0583faf8 WebKit`-[NSString(WebStringDrawing) __web_drawInRect:withFont:ellipsis:alignment:letterSpacing:lineSpacing:includeEmoji:truncationRect:measureOnly:renderedStringOut:drawUnderline:] + 152\r\n    frame #4: 0x05841a68 WebKit`-[NSString(WebStringDrawing) __web_drawInRect:withFont:ellipsis:alignment:letterSpacing:lineSpacing:includeEmoji:truncationRect:measureOnly:renderedStringOut:] + 136\r\n    frame #5: 0x05841af1 WebKit`-[NSString(WebStringDrawing) __web_drawInRect:withFont:ellipsis:alignment:letterSpacing:lineSpacing:includeEmoji:truncationRect:measureOnly:] + 129\r\n    frame #6: 0x058421a6 WebKit`-[NSString(WebStringDrawing) _web_drawInRect:withFont:ellipsis:alignment:lineSpacing:includeEmoji:truncationRect:measureOnly:] + 118\r\n    frame #7: 0x0584237c WebKit`-[NSString(WebStringDrawing) _web_sizeInRect:withFont:ellipsis:lineSpacing:] + 108\r\n    frame #8: 0x01bfe39c UIKit`-[NSString(UIStringDrawing) sizeWithFont:constrainedToSize:lineBreakMode:lineSpacing:] + 183\r\n    frame #9: 0x01bfe2e0 UIKit`-[NSString(UIStringDrawing) sizeWithFont:constrainedToSize:lineBreakMode:] + 77\r\n    frame #10: 0x000863e8 WhereToHD`-[NSString(Additions) stringByTruncatingStringWithFont:size:lineBreakMode:truncateReplacementString:appendString:] + 968 at NSString+Additions.m:272\r\n    frame #11: 0x00085eb7 WhereToHD`-[NSString(Additions) stringByTruncatingStringWithFont:width:lineBreakMode:truncateReplacementString:] + 231 at NSString+Additions.m:240\r\n    frame #12: 0x00085d08 WhereToHD`-[NSString(Additions) stringByTruncatingStringWithFont:width:lineBreakMode:truncateReplacementString:alwaysTruncateRegex:] + 120 at NSString+Additions.m:231\r\n    frame #13: 0x0003545d WhereToHD`+[GoogleReviewsDataSource reviewsFromResponse:] + 1677 at GoogleReviewsDataSource.m:148\r\n    frame #14: 0x000311de WhereToHD`-[GoogleDetailDataSource startInThread] + 13454 at GoogleDetailDataSource.m:252\r\n    frame #15: 0x000278f3 WhereToHD`-[FTBackgroundOperation startInThreadWrapper] + 99 at FTBackgroundOperation.m:41\r\n    frame #16: 0x026d1145 Foundation`-[NSThread main] + 76\r\n    frame #17: 0x026d10a4 Foundation`__NSThread__main__ + 1304\r\n    frame #18: 0x90b36ed9 libsystem_c.dylib`_pthread_start + 335\r\n\r\n\r\nMain Thread:\r\n\r\n(lldb) bt\r\n* thread #1: tid = 0x1f03, 0x0ba781e0, stop reason = EXC_BAD_ACCESS (code=2, address=0xba781e0)\r\n    frame #0: 0x0ba781e0\r\n    frame #1: 0x05c9c42e WebCore`WebCore::Font::Font(WebCore::FontPlatformData const&, WTF::PassRefPtr<WebCore::FontSelector>) + 142\r\n    frame #2: 0x0583ef3a WebKit`_ZL15rendererForFontP8__GSFont + 218\r\n    frame #3: 0x0583e9ac WebKit`-[NSString(WebStringDrawing) __web_drawAtPoint:forWidth:withFont:ellipsis:letterSpacing:includeEmoji:measureOnly:renderedStringOut:drawUnderline:] + 108\r\n    frame #4: 0x0583f9d9 WebKit`-[NSString(WebStringDrawing) __web_drawAtPoint:forWidth:withFont:ellipsis:letterSpacing:includeEmoji:measureOnly:renderedStringOut:] + 121\r\n    frame #5: 0x0583fa52 WebKit`-[NSString(WebStringDrawing) __web_drawAtPoint:forWidth:withFont:ellipsis:letterSpacing:includeEmoji:measureOnly:] + 114\r\n    frame #6: 0x0584212a WebKit`-[NSString(WebStringDrawing) _web_drawAtPoint:forWidth:withFont:ellipsis:letterSpacing:includeEmoji:] + 106\r\n    frame #7: 0x01bfdf1b UIKit`-[NSString(UIStringDrawing) drawAtPoint:forWidth:withFont:lineBreakMode:letterSpacing:includeEmoji:] + 179\r\n    frame #8: 0x01d3052b UIKit`-[UILabel _legacy_drawTextInRect:baselineCalculationOnly:] + 2577\r\n    frame #9: 0x01d30986 UIKit`-[UILabel _drawTextInRect:baselineCalculationOnly:] + 160\r\n    frame #10: 0x01d2f6e9 UIKit`-[UILabel drawTextInRect:] + 548\r\n    frame #11: 0x01d31aa8 UIKit`-[UILabel drawRect:] + 98\r\n    frame #12: 0x01c23ea8 UIKit`-[UIView(CALayerDelegate) drawLayer:inContext:] + 504\r\n    frame #13: 0x01aedb59 QuartzCore`-[CALayer drawInContext:] + 128\r\n    frame #14: 0x01aeda85 QuartzCore`_ZL16backing_callbackP9CGContextPv + 96\r\n    frame #15: 0x019ff843 QuartzCore`CABackingStoreUpdate_ + 2703\r\n    frame #16: 0x01aed956 QuartzCore`CA::Layer::display_() + 1406\r\n    frame #17: 0x01aedad4 QuartzCore`-[CALayer _display] + 33\r\n    frame #18: 0x01aed3d0 QuartzCore`CA::Layer::display() + 152\r\n    frame #19: 0x01aedaae QuartzCore`-[CALayer display] + 33\r\n    frame #20: 0x01ae2216 QuartzCore`CA::Layer::display_if_needed(CA::Transaction*) + 328\r\n    frame #21: 0x01ae2290 QuartzCore`CA::Layer::layout_and_display_if_needed(CA::Transaction*) + 38\r\n    frame #22: 0x01a60268 QuartzCore`CA::Context::commit_transaction(CA::Transaction*) + 324\r\n    frame #23: 0x01a613d3 QuartzCore`CA::Transaction::commit() + 395\r\n    frame #24: 0x01a61a8e QuartzCore`CA::Transaction::observer_callback(__CFRunLoopObserver*, unsigned long, void*) + 96\r\n    frame #25: 0x032110de CoreFoundation`__CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__ + 30\r\n    frame #26: 0x0321101d CoreFoundation`__CFRunLoopDoObservers + 381\r\n    frame #27: 0x031eed82 CoreFoundation`__CFRunLoopRun + 1106\r\n    frame #28: 0x031ee504 CoreFoundation`CFRunLoopRunSpecific + 276\r\n    frame #29: 0x031ee3db CoreFoundation`CFRunLoopRunInMode + 123\r\n    frame #30: 0x03605823 GraphicsServices`GSEventRunModal + 88\r\n    frame #31: 0x036056a8 GraphicsServices`GSEventRun + 104\r\n    frame #32: 0x01bd418c UIKit`UIApplicationMain + 1211\r\n    frame #33: 0x000024c4 WhereToHD`main + 84 at main.m:17"
    email: futuretap@googlemail.com
    modified: "2018-02-22T15:14:26.88661Z"
    number: "12155059"
    number_intvalue: 12155059
    originated: 23-Aug-2012 12:37 AM
    parent_number: '&{NULL_VALUE}'
    product: iPhone SDK
    product_version: 6.0 beta 4
    reproducible: Unable
    resolved: ""
    status: Duplicate/9961221/Closed
    title: 'Race condition crash in -sizeWithFont:constrainedToSize:lineBreakMode:'
